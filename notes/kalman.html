
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.29.1" theme-name="Stellar" theme-version="1.29.1">
  
  <meta name="generator" content="Hexo 7.3.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  
  <title>notesÔºöFundamentals of  Kalman Filter and Inertia Navigation(EN) - Maxwell's Blog</title>

  
    <meta name="description" content="Basic Requirement  Formulate an filtering problem. Build a state space model of a system. Solve linear state estimation problems with Kalman filter. Learn the principles of inertial navigation. Learn&#x2F;">
<meta property="og:type" content="website">
<meta property="og:title" content="Fundamentals of  Kalman Filter and Inertia Navigation(EN)">
<meta property="og:url" content="https://maxwell0339.github.io/notes/kalman.html">
<meta property="og:site_name" content="Maxwell&#39;s Blog">
<meta property="og:description" content="Basic Requirement  Formulate an filtering problem. Build a state space model of a system. Solve linear state estimation problems with Kalman filter. Learn the principles of inertial navigation. Learn&#x2F;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img.dexbug.com/i/2025/04/12/zalnhq.png">
<meta property="og:image" content="https://img.dexbug.com/i/2025/04/12/zauqbp.png">
<meta property="og:image" content="https://img.dexbug.com/i/2025/04/12/zj1sky.png">
<meta property="article:published_time" content="2025-04-16T13:45:04.693Z">
<meta property="article:modified_time" content="2025-04-16T13:45:04.693Z">
<meta property="article:author" content="Maxwell">
<meta property="article:tag" content="Robotics, Embedding system">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.dexbug.com/i/2025/04/12/zalnhq.png">
  
  
  
  <meta name="keywords" content="Robotics, Embedding system">

  <!-- feed -->
  

  <link rel="stylesheet" href="/css/main.css?v=1.29.1">

  
    <link rel="shortcut icon" href="https://img.dexbug.com/i/2025/03/25/pksh2k.png">
  

  

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>



<div class="l_body s:aa content tech" id="start" layout="page" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="https://img.dexbug.com/i/2025/03/24/112d8hl.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">Maxwell's Blog</div><div class="sub normal cap">Never Stop Learning</div><div class="sub hover cap" style="opacity:0"> Designed by Maxwell</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="Âú® notes ‰∏≠ÊêúÁ¥¢"></form><div id="search-result"></div><div class="search-no-result">Ê≤°ÊúâÊâæÂà∞ÂÜÖÂÆπÔºÅ</div></div>


<nav class="menu dis-select"><a class="nav-item" title="ÂçöÂÆ¢" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="ÊñáÊ°£" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item active" title="Á¨îËÆ∞" href="/notes/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a></nav>
</div>
<div class="widgets">

<widget class="widget-wrapper post-list"><div class="widget-body fs14"><a class="link" href="/notes/index.html#start"><span class="toc-text">Forehead</span></a><a class="link" href="/notes/robotics.html"><span class="toc-text">Robotics(EN)</span></a><a class="link" href="/notes/autocontrol.html"><span class="toc-text">ME Control(EN)</span></a><a class="link" href="/notes/sensors.html"><span class="toc-text">Sensors and Measurement System(EN)</span></a><a class="link" href="/notes/dc.html"><span class="toc-text">Digital Circuit(EN)</span></a><a class="link active" href="/notes/kalman.html"><span class="toc-text">Fundamentals of  Kalman Filter and Inertia Navigation(EN)</span><svg class="active-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M21 11.098v4.993c0 3.096 0 4.645-.734 5.321c-.35.323-.792.526-1.263.58c-.987.113-2.14-.907-4.445-2.946c-1.02-.901-1.529-1.352-2.118-1.47a2.225 2.225 0 0 0-.88 0c-.59.118-1.099.569-2.118 1.47c-2.305 2.039-3.458 3.059-4.445 2.945a2.238 2.238 0 0 1-1.263-.579C3 20.736 3 19.188 3 16.091v-4.994C3 6.81 3 4.666 4.318 3.333C5.636 2 7.758 2 12 2c4.243 0 6.364 0 7.682 1.332C21 4.665 21 6.81 21 11.098" opacity=".5"/><path fill="currentColor" d="M9 5.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5z"/></svg></a></div></widget>



<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">ÊúÄËøëÊõ¥Êñ∞</span></div><div class="widget-body fs14"><a class="item title" href="/2025/04/07/20250407/"><span class="title">Â¶Ç‰Ωï‰ªé0Êê≠Âª∫‰Ω†ÁöÑPythonÁéØÂ¢É</span></a><a class="item title" href="/2025/03/25/20250325/"><span class="title">Â¶Ç‰Ωï‰ΩøÁî®LaTexÂÜôÊñáÁ´†Ôºü</span></a><a class="item title" href="/2025/03/23/20250324/"><span class="title">‰∏∫‰ªÄ‰πàÊàëÊÉ≥Âª∫Á´ãËá™Â∑±ÁöÑÂçöÂÆ¢ÁΩëÁ´ô</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" title="GitHub" href="https://github.com/Maxwell0339" target="_blank" rel="external nofollow noopener noreferrer"><i class="fa-solid fa-github fa-brands fa-bounce"></i></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top"></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>Fundamentals of  Kalman Filter and Inertia Navigation(EN)</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><p><strong>Basic Requirement</strong></p>
<ol>
<li>Formulate an filtering problem.</li>
<li>Build a state space model of a system.</li>
<li>Solve linear state estimation problems with Kalman filter.</li>
<li>Learn the principles of inertial navigation.</li>
<li>Learn/implement  basic INS-GNSS integrated navigation system.</li>
</ol>
<h2 id="Lesson-1"><a href="#Lesson-1" class="headerlink" title="Lesson 1"></a>Lesson <em>1</em></h2><p>Why is Kalman filter so popular?</p>
<p>Kalman filter is BULE (Best Linear Unbiased Estimator)</p>
<ul>
<li>Powerful</li>
<li>Convenient to use</li>
</ul>
<h3 id="Example1-Measure-the-center-temperature-of-a-rocket-flame"><a href="#Example1-Measure-the-center-temperature-of-a-rocket-flame" class="headerlink" title="Example1 - Measure the center temperature of a rocket flame"></a>Example1 - Measure the center temperature of a rocket flame</h3><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://img.dexbug.com/i/2025/04/12/zalnhq.png" alt=""></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://img.dexbug.com/i/2025/04/12/zauqbp.png" /></p>
<h3 id="Example2-Data-Merging"><a href="#Example2-Data-Merging" class="headerlink" title="Example2 - Data Merging"></a>Example2 - Data Merging</h3><blockquote>
<p><strong>Notation</strong></p>
<p>$e_{EST}$  ‚Äî‚Äî state estimation error</p>
<p>$e_{MEA}$  ‚Äî measurement error</p>
<p>$K$  ‚Äî Kalman gain</p>
<p>$X$  ‚Äî true state</p>
<p>$\hat{X}$  ‚Äî estimated state</p>
<p>$y$  ‚Äî measurement</p>
<p>$K = \frac{e_{EST}}{e_{EST} + e_{MEA}}$</p>
<p>$\hat{X}_k = \hat{X}_{k-1} + K(y - \hat{y})$</p>
<p>$e_{EST} = (1 - K)e_{EST}$</p>
</blockquote>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://img.dexbug.com/i/2025/04/12/zj1sky.png" /></p>
<h3 id="Example3-A-simple-0-order-Kalman-filter"><a href="#Example3-A-simple-0-order-Kalman-filter" class="headerlink" title="Example3 - A simple 0-order Kalman filter"></a>Example3 - A simple 0-order Kalman filter</h3><ul>
<li>$K = \frac{E_{\hat{X}}}{E_{\hat{X}} + E_y}$</li>
<li>$\hat{X}_t = \hat{X}_{t-1} + K (y - \hat{X}_{t-1})$</li>
<li>$E_{\hat{X}_{t}} = (1 - K)E_{\hat{X}_{t-1}}$</li>
</ul>
<h2 id="Lesson-2"><a href="#Lesson-2" class="headerlink" title="Lesson 2"></a>Lesson <em>2</em></h2><h3 id="Numerical-integration-of-differential-equations"><a href="#Numerical-integration-of-differential-equations" class="headerlink" title="Numerical integration of differential equations"></a>Numerical integration of differential equations</h3><ul>
<li>Euler integration</li>
</ul>
<p>Consider a first-order differential equation of the form:</p>
<script type="math/tex; mode=display">\dot{x} = f(x, t)</script><p>We know from calculus that the definition of a derivative of a function can be approximated by</p>
<script type="math/tex; mode=display">\dot{x} = f(x, t) = \frac{x(t + h) - x(t)}{h} = \frac{x_k - x_{k-1}}{h}</script><p>for small  $ h $ . Rearranging terms yields</p>
<script type="math/tex; mode=display">x_k = x_{k-1} + hf(x, t)</script><p>The preceding equation is known as Euler integration.</p>
<ul>
<li>Second-order Runge‚ÄìKutta</li>
</ul>
<p>The second-order Runge‚ÄìKutta numerical integration procedure is easy to state. Given a first-order differential equation of the form:</p>
<script type="math/tex; mode=display">\dot{x} = f(x, t)</script><p>where  $ t $  is time, we seek to find a recursive relationship for  $ x $  as a function of time. With the second-order Runge‚ÄìKutta numerical technique the value of  $ x $  at the next integration interval  $ h $  is given by</p>
<script type="math/tex; mode=display">x_k = x_{k-1} + 0.5h[f(x, t) + f(x, t + h)]</script><p>Finding the area under a curve using trapezoids is equivalent to second-order Runge‚ÄìKutta integration.</p>
<h3 id="Noise-and-random-variables"><a href="#Noise-and-random-variables" class="headerlink" title="Noise and random variables"></a>Noise and random variables</h3><ul>
<li>The mean squared value of  $x$  is defined as:  $E(x^2) = \int_{-\infty}^{\infty} x^2 p(x) dx$ </li>
<li>The root mean square or <em>rms</em> of  $x$  is defined as:  $rms = \sqrt{E(x^2)}$</li>
<li>The variance of  $x$  is defined as:  $\sigma^2 = E[x - E(x)]^2 = E(x^2) - E^2(x)$ </li>
<li>If we have independent random variables  $x_1, x_2 ‚Ä¶ x_n$ , then the variance of the sum can be shown to be the sum of the variances,  $\sigma^2 = \sigma_1^2 + \sigma_2^2 + \cdots + \sigma_n^2$</li>
</ul>
<h3 id="State-space-notation"><a href="#State-space-notation" class="headerlink" title="State space notation"></a>State space notation</h3><p>Often in this text we will put linear differential equations into state space form because this will be required for setting up a Kalman-filtering problem. With state-space notation we are saying that any set of linear differential equations can be put in the form of the first-order matrix differential equation</p>
<script type="math/tex; mode=display">\dot{x} = Fx + Gu + w</script><blockquote>
<p><strong>Example</strong>: Consider the second-order differential equation without any random inputs.</p>
<script type="math/tex; mode=display">\ddot{y} + 2\dot{y} + 3y = 4</script><p>rewrite</p>
<script type="math/tex; mode=display">\dot{y} = -2\dot{y} - 3y + 4</script><script type="math/tex; mode=display">\begin{bmatrix} \dot{y} \\ \dot{y} \end{bmatrix} = \begin{bmatrix} 0 & 1 \\ -3 & -2 \end{bmatrix} \begin{bmatrix} y \\ \dot{y} \end{bmatrix} + \begin{bmatrix} 0 \\ 4 \end{bmatrix}</script><script type="math/tex; mode=display">x = \begin{bmatrix} y \\ \dot{y} \end{bmatrix}, F = \begin{bmatrix} 0 & 1 \\ -3 & -2 \end{bmatrix}, G = \begin{bmatrix} 0 \\ 1 \end{bmatrix}, u = 4, w = \begin{bmatrix} 0 \\ 0 \end{bmatrix}</script></blockquote>
<h3 id="Fundamental-matrix"><a href="#Fundamental-matrix" class="headerlink" title="Fundamental matrix"></a>Fundamental matrix</h3><p>If the state-space form is:</p>
<script type="math/tex; mode=display">\dot{x} = Fx</script><p>where the systems dynamics matrix $F$ is time invariant, then we can say that there is a transition or fundamental matrix  $\Phi$  that can be used to exactly propagate the state forward from any time $t_0$ to time $t$ according to</p>
<script type="math/tex; mode=display">x(t) = \Phi(t - t_0)x(t_0)</script><p>Two simple ways of finding the fundamental matrix for time-invariant systems are by Laplace transforms and by Taylor-series expansion:</p>
<blockquote>
<p>Laplace transform technique:  $\Phi(t) = \mathcal{L}^{-1} [(sI - F)^{-1}]$ </p>
<p>Taylor-series expansion:  $\Phi(t) = e^{Ft} = I + Ft + \frac{(Ft)^2}{2}{2!} + \cdots + \frac{(Ft)^n}{n!} + \cdots$ </p>
</blockquote>
<h2 id="Lesson-3"><a href="#Lesson-3" class="headerlink" title="Lesson 3"></a>Lesson <em>3</em></h2><h3 id="Least-squares-method"><a href="#Least-squares-method" class="headerlink" title="Least squares method"></a>Least squares method</h3><p>We will normally follow a three-step procedure for extracting information or estimating the characteristics of the signal based upon noisy measurement</p>
<ol>
<li><p>Assume a polynomial model to represent the actual signal. </p>
</li>
<li><p>Try to estimate the coefficients of the selected polynomial by choosing a goodness of fit criterion. This is where Gauss comes in. The least squares criterion is the sum of the squares of the individual discrepancies between the estimated polynomial and measurement values of the actual signal contaminated by noise.</p>
</li>
<li><p>Use calculus to minimize the sum of the squares of the individual discrepancies in order to obtain the best coefficients for the selected polynomial.</p>
</li>
</ol>
<h3 id="Zero-order-of-one-state-filter"><a href="#Zero-order-of-one-state-filter" class="headerlink" title="Zero order of one-state filter"></a>Zero order of one-state filter</h3><p><img src = "https://img.dexbug.com/i/2025/04/15/xidchx.png"></p>
<p>For the zeroth-order case in which the best estimate is supposed to be a constant $a_0$:</p>
<script type="math/tex; mode=display">\hat{x}_k = a_0</script><p>Suppose we sample $n$ measurements $x^*_k$ of the data every $T_s$ seconds (i.e., $k$ goes from $1$ to $n$).</p>
<script type="math/tex; mode=display">R = \sum_{k = 1}^{n}(\hat{x}_k - x^*_k)^2 = \sum_{k = 1}^{n}(a_0 - x^*_k)^2</script><p>where $R$ is the square of the summation of all the residuals or differences between the estimate and the measurement. </p>
<p>Because we are only estimating one constant, this is also sometimes called a one-state system. From calculus we know that a function can be minimized by taking its derivative and setting the result equal to zero.</p>
<script type="math/tex; mode=display">R = \sum_{k = 1}^{n}(\hat{x}_k - x^*_k)^2 = (a_0 - x^*_1)^2 + (a_0 - x^*_2)^2 + \cdots + (a_0 - x^*_n)^2</script><p>To minimize $R$</p>
<script type="math/tex; mode=display">\frac{\partial R}{\partial a_0} = 0 = 2(a_0 - x^*_1) + 2(a_0 - x^*_2) + \cdots 2(a_0 - x^*_n)</script><script type="math/tex; mode=display">-x^*_1 - x^*_2 - \cdots - x^*_n = -\sum_{k = 1}^{n}x^*_k, \quad a_0 + a_0 + \cdots + a_0 = na_0</script><script type="math/tex; mode=display">0 = na_0 - \sum_{k = 1}^{n}x^*_k</script><script type="math/tex; mode=display">a_0 = \frac{\sum_{k = 1}^{n}x^*_k}{n}</script><p>The preceding formula shows us that the best constant fit to a set of measurement data in the least squares sense is simply the average value of the measurements. </p>
<h3 id="First-order-or-two-state-filter"><a href="#First-order-or-two-state-filter" class="headerlink" title="First order or two-state filter"></a>First order or two-state filter</h3><p>Suppose we want to fit the measurement data with the best <strong>straight line</strong> (i.e., rather than a constant) in the least squares sense. This means we are seeking estimates to fit the <strong>first-order polynomial</strong></p>
<script type="math/tex; mode=display">\hat{x} = a_0 + a_1t, \quad \hat{\dot{x}} = a_1</script><p>in discrete notation</p>
<script type="math/tex; mode=display">\hat{x}_k = a_0 + a_1(k - 1)T_s, \quad \hat{\dot{x}}_k = a_1</script><p>where $k$ is the number of measurements taken and $T_s$ is the sampling time. </p>
<p>As before, the quantity to be minimized is still given by the summation of the square of the difference between the estimates and measurements or</p>
<script type="math/tex; mode=display">\begin{align*}
    R =& \sum_{k = 1}^{n}(\hat{x}_k - x^*_k)^2 = \sum_{k = 1}^{n}[a_0 + a_1(k - 1)T_s - x^*_k]^2 \\ =& (a_0 - x^*_1)^2 + (a_0 + a_1T_s - x^*_2)^2 + \cdots + [a_0 + a_1(n - 1)T_s - x^*_n]^2
\end{align*}</script><p>Again, according to calculus, we can minimize $R$ by setting its derivative with respect to $a_0$ and $a_1$ to zero or</p>
<script type="math/tex; mode=display">\begin{align*}
    \frac{\partial R}{\partial a_0} &= 0 \\=& 2(a_0 - x^*_1) + 2(a_0 + a_1T_s - x^*_2) + \cdots + 2[a_0 + a_1(n - 1)T_s - x^*_n]
\end{align*}</script><script type="math/tex; mode=display">\begin{align*}
    \frac{\partial R}{\partial a_1} &= 0\\ =& 2(a_0 + a_1T_s - x^*_2)T_s + \cdots + 2(n - 1)T_s[a_0 + a_1(n - 1)T_s - x^*_n]
\end{align*}</script><p>Simplify:</p>
<script type="math/tex; mode=display">na_0 + a_1\sum_{k = 1}^{n}(k - 1)T_s = \sum_{k = 1}^{n}x^*_k</script><script type="math/tex; mode=display">a_0\sum_{k = 1}^{n}(k - 1)T_s + a_1\sum_{k = 1}^{n}[(k - 1)T_s]^2 = \sum_{k = 1}^{n}(k - 1)T_sx^*_k</script><p><strong>matrix form</strong>:</p>
<script type="math/tex; mode=display">
\begin{bmatrix}
n & \sum_{k = 1}^{n}(k - 1)T_s \\
\sum_{k = 1}^{n}(k - 1)T_s & \sum_{k = 1}^{n}[(k - 1)T_s]^2
\end{bmatrix}
\begin{bmatrix}
a_0 \\
a_1
\end{bmatrix}
=
\begin{bmatrix}
\sum_{k = 1}^{n}x^*_k \\
\sum_{k = 1}^{n}(k - 1)T_sx^*_k
\end{bmatrix}</script><p><img src = "https://img.dexbug.com/i/2025/04/15/xsnkwr.png"></p>
<h2 id="Lesson-4-may-not-in-the-exam"><a href="#Lesson-4-may-not-in-the-exam" class="headerlink" title="Lesson 4(may not in the exam)"></a>Lesson <em>4</em>(may not in the exam)</h2><h3 id="Second-order-LS-filter"><a href="#Second-order-LS-filter" class="headerlink" title="Second order LS filter*"></a>Second order LS filter*</h3><p>Second order polynomial model</p>
<script type="math/tex; mode=display">
\hat{x} = a_0 + a_1t + a_2t^2</script><script type="math/tex; mode=display">
\hat{\dot{x}} = a_1 + 2a_2t</script><script type="math/tex; mode=display">
\hat{\ddot{x}} = 2a_2</script><p>Discrete form</p>
<script type="math/tex; mode=display">
\hat{x}_k = a_0 + a_1(k - 1)T_s + a_2[(k - 1)T_s]^2</script><p>matrix form:</p>
<script type="math/tex; mode=display">
\begin{align*}
    & \begin{bmatrix}
    n & \sum_{k = 1}^{n}(k - 1)T_s & \sum_{k = 1}^{n}[(k - 1)T_s]^2 \\
    \sum_{k = 1}^{n}(k - 1)T_s & \sum_{k = 1}^{n}[(k - 1)T_s]^2 & \sum_{k = 1}^{n}[(k - 1)T_s]^3 \\
    \sum_{k = 1}^{n}[(k - 1)T_s]^2 & \sum_{k = 1}^{n}[(k - 1)T_s]^3 & \sum_{k = 1}^{n}[(k - 1)T_s]^4
    \end{bmatrix}
    \begin{bmatrix}
    a_0 \\
    a_1 \\
    a_2
    \end{bmatrix}
    \\&=
     \begin{bmatrix}
    \sum_{k = 1}^{n}x^*_k \\
    \sum_{k = 1}^{n}(k - 1)T_sx^*_k \\
    \sum_{k = 1}^{n}[(k - 1)T_s]^2x^*_k
    \end{bmatrix}
\end{align*}</script><p><img src = "https://img.dexbug.com/i/2025/04/15/xxvcvr.png"></p>
<h3 id="Third-order-LS-filter"><a href="#Third-order-LS-filter" class="headerlink" title="Third order LS filter*"></a>Third order LS filter*</h3><p>We can also fit the measurement data with the best cubic or third - order curve in the least squares sense. This means we are seeking estimates to fit the formula for the cubic</p>
<script type="math/tex; mode=display">\hat{x} = a_0 + a_1t + a_2t^2 + a_3t^3</script><p>or</p>
<script type="math/tex; mode=display">\hat{x}_k = a_0 + a_1(k - 1)T_s + a_2[(k - 1)T_s]^2 + a_3[(k - 1)T_s]^3</script><p><img src = "https://img.dexbug.com/i/2025/04/15/xzlumw.png"></p>
<h2 id="Lesson-5"><a href="#Lesson-5" class="headerlink" title="Lesson 5"></a>Lesson <em>5</em></h2><h3 id="Accelerometer-testing-example"><a href="#Accelerometer-testing-example" class="headerlink" title="Accelerometer testing example"></a>Accelerometer testing example</h3><p>Accelerometer measurements are taken for different accelerometer orientation angles. where $\theta_ùëò$ is the angle the accelerometer makes with the vertical for the $k$th measurement, $g$ is gravity.<br><img src = "https://img.dexbug.com/i/2025/04/15/z8s3s8.png"></p>
<script type="math/tex; mode=display">
\text{Theory} = g \cos\theta_k</script><p>Actually, the accelerometer output will also consist of additional terms caused by imperfections in the accelerometer.</p>
<script type="math/tex; mode=display">
\text{Output} = g \cos\theta_k + B + SFg \cos\theta_k + K(g \cos\theta_k)^2</script><p>Therefore, the accelerometer error is simply the difference between the actual output and theory($\theta_k$ is the actual angle and $\theta^*_k$ is the measured angle):</p>
<p><strong>Error = Accelerometer Output ‚Äì Theory</strong></p>
<script type="math/tex; mode=display">= g\cos\theta_k + B + SF \ g\cos\theta_k + K(g\cos\theta_k)^2 - g\cos\theta^*_k</script><p>Initially, the simulation is set up so there is no noise on the angle $\theta^*_k$. The error or measurement equation for the first example will be given by:</p>
<script type="math/tex; mode=display">\theta^*_k = \theta_k, \quad x_k = g\cos\theta_k, \quad y^*_k = B + SF \ g\cos\theta_k + K(g\cos\theta_k)^2</script><p>Let $x_k = g\cos\theta_k$</p>
<p>then $y^*_k = B + SFx_k + K(x_k)^2$ </p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Term</th>
<th>Scientific value</th>
<th>English units</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bias error $B$</td>
<td>$10 \ \mu g$</td>
<td>$10\times 10^{-6} \times32.2 = 0.000322 \ \text{ft}/\text{s}^2$</td>
</tr>
<tr>
<td>Scale factor error $SF$</td>
<td>$5 \ \text{ppm}$</td>
<td>$5\times10^{-6}$</td>
</tr>
<tr>
<td>$g$-squared sensitive drift $K$</td>
<td>$1 \ \mu g/\text{g}^2$</td>
<td>$1\times 10^{-6}/32.2 = 3.106 \times10^{-8} \ \text{s}^2/\text{ft}$</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p><strong>No angle noise</strong><br><img src = "https://img.dexbug.com/i/2025/04/15/zj4vzi.png"></p>
<p><strong>1 $\mu r$ of angle noise on the vertical angle</strong><br><img src = "https://img.dexbug.com/i/2025/04/15/zlguqs.png"></p>
</blockquote>
<h3 id="Making-Least-Squares-filter-recursive"><a href="#Making-Least-Squares-filter-recursive" class="headerlink" title="Making Least-Squares filter recursive"></a>Making Least-Squares filter recursive</h3><p>If we were trying to fit a zeroth - order polynomial or constant to a set of measurement data the best estimate can be expressed as</p>
<script type="math/tex; mode=display">\hat{x}_k = a_0 = \frac{\sum_{i = 1}^{k}x^*_i}{k}</script><p>By changing subscripts we can rewrite the preceding expression as</p>
<script type="math/tex; mode=display">\hat{x}_{k + 1} = \frac{\sum_{i = 1}^{k + 1}x^*_i}{k + 1} = \frac{\sum_{i = 1}^{k}x^*_i + x^*_{k + 1}}{k + 1}</script><script type="math/tex; mode=display">\sum_{i = 1}^{k}x^*_i = k\hat{x}_k</script><script type="math/tex; mode=display">\hat{x}_{k + 1} = \frac{k\hat{x}_k + x^*_{k + 1}}{k + 1}</script><script type="math/tex; mode=display">\begin{align*}
    \hat{x}_{k + 1} = \frac{k\hat{x}_k + \hat{x}_k + x^*_{k + 1} - \hat{x}_k}{k + 1} \\= \frac{(k + 1)\hat{x}_k + x^*_{k + 1} - \hat{x}_k}{k + 1} \\= \hat{x}_k + \frac{1}{k + 1}(x^*_{k + 1} - \hat{x}_k)
\end{align*}</script><h3 id="Recursive-properties-of-One-State-filters"><a href="#Recursive-properties-of-One-State-filters" class="headerlink" title="Recursive properties of One-State filters"></a>Recursive properties of One-State filters</h3><p>The form of the zeroth - order or one - state recursive least - squares filter is given by</p>
<script type="math/tex; mode=display">\hat{x}_k = \hat{x}_{k - 1} + K_{1k}Res_k</script><p>gain: $K_{1k} = \frac{1}{k} \quad k = 1,2,\cdots,n$</p>
<p>residual: $Res_k = x^*_k - \hat{x}_{k - 1}$</p>
<p>We can see that the filter gain for the zeroth - order recursive least - squares filter is unity for the first measurement (i.e., $k = 1$) and eventually goes to zero as more measurements are taken. </p>
<p>The batch-processing least squares estimates are only available after all of the measurements are taken ,whereas the recursive least-squares estimates are available as the measurements are being taken.</p>
<h3 id="Recursive-properties-of-One-State-filters-1"><a href="#Recursive-properties-of-One-State-filters-1" class="headerlink" title="Recursive properties of One-State filters"></a>Recursive properties of One-State filters</h3><p>If the actual measurement data are simply a constant plus noise (i.e., zeroth - order signal plus noise) where the measurement noise is a zero - mean Gaussian process with variance $\sigma^2_n$.</p>
<script type="math/tex; mode=display">x^*_k = x_k + v_k</script><script type="math/tex; mode=display">\begin{align*}
    x_k - \hat{x}_k =& x_k - \hat{x}_{k - 1} - \frac{1}{k}(x^*_k - \hat{x}_{k - 1}) \\=& x_k - \hat{x}_{k - 1} - \frac{1}{k}(x_k + v_k - \hat{x}_{k - 1})
\end{align*}</script><p>However, because the signal is a constant for the zeroth - order system, we can also say that $x_k = x_{k - 1}$</p>
<script type="math/tex; mode=display">x_k - \hat{x}_k = (x_{k - 1} - \hat{x}_{k - 1})\left(1 - \frac{1}{k}\right) - \frac{1}{k}v_k</script><script type="math/tex; mode=display">\begin{align*}
    (x_k - \hat{x}_k)^2 =& (x_{k - 1} - \hat{x}_{k - 1})^2\left(1 - \frac{1}{k}\right)^2 \\-& 2\left(1 - \frac{1}{k}\right)(x_{k - 1} - \hat{x}_{k - 1})\frac{v_k}{k} + \left(\frac{1}{k}v_k\right)^2
\end{align*}</script><script type="math/tex; mode=display">\begin{align*}
    E[(x_k - \hat{x}_k)^2] =& E[(x_{k - 1} - \hat{x}_{k - 1})^2]\left(1 - \frac{1}{k}\right)^2 \\-& 2\left(1 - \frac{1}{k}\right)E[(x_{k - 1} - \hat{x}_{k - 1})v_k]\frac{1}{k} + E\left[\left(\frac{1}{k}v_k\right)^2\right]
\end{align*}</script><p>If we define the variance of the error in the estimate to be $P_k$ and the variance of the measurement noise to be $\sigma^2_n$ and also assume that the noise is uncorrelated with the state or the estimate of the state, we can say that</p>
<script type="math/tex; mode=display">E[(x_k - \hat{x}_k)^2] = P_k</script><script type="math/tex; mode=display">E[v^2_k] = \sigma^2_n</script><script type="math/tex; mode=display">E[(x_{k - 1} - \hat{x}_{k - 1})v_k] = 0</script><p>Substitution of the preceding three equations into the expectation equation yields the difference equation for the variance of the error in the estimate or</p>
<script type="math/tex; mode=display">P_k = P_{k - 1}\left(1 - \frac{1}{k}\right)^2 + \frac{\sigma^2_n}{k^2}</script><script type="math/tex; mode=display">P_1 = P_0\left(1 - \frac{1}{1}\right)^2 + \frac{\sigma^2_n}{1^2} = \sigma^2_n</script><script type="math/tex; mode=display">P_2 = P_1\left(1 - \frac{1}{2}\right)^2 + \frac{\sigma^2_n}{2^2} = \sigma^2_n\frac{1}{4} + \frac{\sigma^2_n}{4} = \frac{\sigma^2_n}{2}</script><script type="math/tex; mode=display">P_3 = P_2\left(1 - \frac{1}{3}\right)^2 + \frac{\sigma^2_n}{3^2} = \frac{\sigma^2_n}{2}\frac{4}{9} + \frac{\sigma^2_n}{9} = \frac{\sigma^2_n}{3}</script><script type="math/tex; mode=display">P_4 = P_3\left(1 - \frac{1}{4}\right)^2 + \frac{\sigma^2_n}{4^2} = \frac{\sigma^2_n}{3}\frac{9}{16} + \frac{\sigma^2_n}{16} = \frac{\sigma^2_n}{4}</script><p>The trend in the preceding four equations is now obvious, and we can summarize these results by saying in general for the zeroth - order recursive least - squares filter that the variance of the error in the estimate is simply</p>
<script type="math/tex; mode=display">P_k = \frac{\sigma^2_n}{k}</script><p>If the real signal is a first - order:</p>
<script type="math/tex; mode=display">x_k = a_0 + a_1t = a_0 + a_1(k - 1)T_s</script><p>The filter will not be able to track the signal. The resulting error in the estimate is known as <strong>truncation error</strong>:</p>
<script type="math/tex; mode=display">\varepsilon_k = x_k - \hat{x}_k</script><p>In the noise - free case:</p>
<script type="math/tex; mode=display">
\begin{align*}
\hat{x}_k&=\frac{\sum_{i = 1}^{k}x_i}{k}=\frac{\sum_{i = 1}^{k}[a_0 + a_1(i - 1)T_s]}{k} \\&= \frac{a_0\sum_{i = 1}^{k}1 + a_1T_s\sum_{i = 1}^{k}i - a_1T_s\sum_{i = 1}^{k}1}{k}\\
&=\frac{a_0k + a_1T_s[k(k + 1)/2] - a_1T_sk}{k}\\&=a_0+\frac{a_1T_s}{2}(k - 1)
\end{align*}</script><p>The <strong>truncation error</strong> of the zeroth - order recursive least - squares filter:</p>
<script type="math/tex; mode=display">\begin{align*}
    \varepsilon_k = x_k - \hat{x}_k &= a_0 + a_1T_s(k - 1) - a_0 - \frac{a_1T_s}{2}(k - 1)\\&=\frac{a_1T_s}{2}(k - 1)
\end{align*}</script><p>As already noted, as more measurements are taken k gets larger, and the error in the estimate caused by the measurement noise decreases while the error in the estimate caused by truncation error increases. In principle, for any particular numerical example there is an optimal value of k that will minimize the errors in the estimates caused by both measurement noise and truncation error.</p>
<h2 id="Lesson-6"><a href="#Lesson-6" class="headerlink" title="Lesson 6"></a>Lesson <em>6</em></h2><h3 id="Filters-properties-of-Two-State-filters"><a href="#Filters-properties-of-Two-State-filters" class="headerlink" title="Filters properties of Two-State filters"></a>Filters properties of Two-State filters</h3><p>The two gains of a first - order or two - state recursive least - squares filter can be shown to be:</p>
<script type="math/tex; mode=display">K_{1k} = \frac{2(2k - 1)}{k(k + 1)} \quad k = 1,2,\cdots,n</script><script type="math/tex; mode=display">K_{2k} = \frac{6}{k(k + 1)T_s}</script><p>If we think of the measurement as a position, position is the first state, whereas the velocity is the second state.</p>
<p>residual: $Res_k = x^*_k - \hat{x}_{k - 1} - \dot{\hat{x}}_{k - 1}T_s$</p>
<p>the new filter estimates:</p>
<script type="math/tex; mode=display">\hat{x}_k = \hat{x}_{k - 1} + \dot{\hat{x}}_{k - 1}T_s + K_{1k}Res_k</script><script type="math/tex; mode=display">\dot{\hat{x}}_k = \dot{\hat{x}}_{k - 1} + K_{2k}Res_k</script><p>Describing the variance of the error in the estimates in both states (i.e., $P_{11}$ and $P_{22}$) of the first - order filter:</p>
<script type="math/tex; mode=display">P_{11k} = \frac{2(2k - 1)\sigma^2_n}{k(k + 1)}</script><script type="math/tex; mode=display">P_{22k} = \frac{12\sigma^2_n}{k(k^2 - 1)T_s^2}</script><p>where $\sigma^2_n$ is the variance of the measurement noise, $k$ is the number of measurements taken, and $T_s$ is the sample time or time between measurements. </p>
<p>The real signal is a second - order polynomial (one degree higher than the first - order filter) or</p>
<script type="math/tex; mode=display">x^*_k = a_0 + a_1t + a_2t^2 = a_0 + a_1(k - 1)T_s + a_2(k - 1)^2T_s^2</script><p>The resulting error buildup caused by this lack of tracking ability is known as <strong>truncation error $\varepsilon_k$</strong></p>
<script type="math/tex; mode=display">\varepsilon_k = \frac{1}{6}a_2T_s^2(k - 1)(k - 2)</script><script type="math/tex; mode=display">\dot{\varepsilon}_k = a_2T_s(k - 1)</script><h3 id="Properties-of-Second-Order-or-Three-State-filter"><a href="#Properties-of-Second-Order-or-Three-State-filter" class="headerlink" title="Properties of Second-Order or Three-State filter"></a>Properties of Second-Order or Three-State filter</h3><p>The three gains of a second - order or three - state recursive least - squares filter can be shown to be:</p>
<script type="math/tex; mode=display">K_{1k} = \frac{3(3k^2 - 3k + 2)}{k(k + 1)(k + 2)}, k = 1,2,\cdots,n</script><script type="math/tex; mode=display">K_{2k} = \frac{18(2k - 1)}{k(k + 1)(k + 2)T_s}</script><script type="math/tex; mode=display">K_{3k} = \frac{60}{k(k + 1)(k + 2)T_s^2}</script><p>If we think of the measurement as a position, then the estimates from this three - state filter will be position, velocity, and acceleration.</p>
<p>For this filter a residual is also formed, which is the difference between the present measurement and a projection of the preceding estimate to the current time or</p>
<script type="math/tex; mode=display">Res_k = x^*_k - \hat{x}_{k - 1} - \dot{\hat{x}}_{k - 1}T_s - 0.5\ddot{\hat{x}}_{k - 1}T_s^2</script><p>The new filter estimates are a combination of the preceding state estimates projected forward to the current time plus a gain multiplied by the residual or</p>
<script type="math/tex; mode=display">\hat{x}_k = \hat{x}_{k - 1} + \dot{\hat{x}}_{k - 1}T_s + 0.5\ddot{\hat{x}}_{k - 1}T_s^2 + K_{1k}Res_k</script><script type="math/tex; mode=display">\dot{\hat{x}}_k = \dot{\hat{x}}_{k - 1} + \ddot{\hat{x}}_{k - 1}T_s^2 + K_{2k}Res_k</script><script type="math/tex; mode=display">\ddot{\hat{x}}_k = \ddot{\hat{x}}_{k - 1} + K_{3k}Res_k</script><p>If the measurement data are a second - order polynomial corrupted by noise and the measurement noise statistics are known, then formulas can be derived, describing the variance of the error in the estimates of all three states of the second - order filter.</p>
<script type="math/tex; mode=display">P_{11k} = \frac{3(3k^2 - 3k + 2)\sigma^2_n}{k(k + 1)(k + 2)}</script><script type="math/tex; mode=display">P_{22k} = \frac{12(16k^2 - 30k + 11)\sigma^2_n}{k(k^2 - 1)(k^2 - 4)T_s^2}</script><script type="math/tex; mode=display">P_{33k} = \frac{720\sigma^2_n}{k(k^2 - 1)(k^2 - 4)T_s^4}</script><p>If the real signal is a third - order polynomial (one degree higher than the second - order filter) or</p>
<script type="math/tex; mode=display">
\begin{align*}
x^*_k&=a_0 + a_1t + a_2t^2 + a_3t^3\\
&=a_0 + a_1(k - 1)T_s + a_2(k - 1)^2T_s^2 + a_3(k - 1)^3T_s^3
\end{align*}</script><p>The resulting error buildup caused by this lack of tracking ability is known as truncation error $\varepsilon_k$</p>
<script type="math/tex; mode=display">\varepsilon_k = \frac{1}{20}a_3T_s^3(k - 1)(k - 2)(k - 3)</script><script type="math/tex; mode=display">\dot{\varepsilon}_k = \frac{1}{10}a_3T_s^2(6k^2 - 15k + 11)</script><script type="math/tex; mode=display">\ddot{\varepsilon}_k = 3a_3T_s(k - 1)</script><h3 id="Recursive-filter-summary"><a href="#Recursive-filter-summary" class="headerlink" title="Recursive filter summary"></a>Recursive filter summary</h3><p><img src = "https://img.dexbug.com/i/2025/04/16/xdpgy2.png"></p>
<blockquote>
<p>From a measurement noise reduction point of view, it is best to use as low an order filter as possible because that will tend to reduce the error in the estimate caused by measurement noise. </p>
<p>However, we also know that if we make the order of the filter too low there might be excessive truncation error.</p>
<p>In each case the best-order filter to use will depend on the number of measurements to be taken and the actual order of the signal.</p>
</blockquote>
<h2 id="Lesson-7"><a href="#Lesson-7" class="headerlink" title="Lesson 7"></a>Lesson <em>7</em></h2><h3 id="Polynomial-Kalman-Filters"><a href="#Polynomial-Kalman-Filters" class="headerlink" title="Polynomial Kalman Filters"></a>Polynomial Kalman Filters</h3><h3 id="General-Equations"><a href="#General-Equations" class="headerlink" title="General Equations"></a>General Equations</h3><p>To apply Kalman - filtering theory, our model of the real world must be described by a set of differential equations.</p>
<script type="math/tex; mode=display">\dot{\mathbf{x}} = \mathbf{F}\mathbf{x} + \mathbf{G}\mathbf{u} + \mathbf{w}</script><script type="math/tex; mode=display">\mathbf{z} = \mathbf{H}\mathbf{x} + \mathbf{v}</script><blockquote>
<p>$\mathbf{x}$ is a column vector with the states of the system</p>
<p>$\mathbf{F}$ the system dynamics matrix, $\mathbf{u}$ is a known vector, which is sometimes called the control vector</p>
<p>$\mathbf{w}$ is a white - noise process, which is also expressed as a vector</p>
<p>$\mathbf{z}$ is the measurement vector</p>
<p>$\mathbf{H}$ is the measurement matrix</p>
<p>$\mathbf{v}$ is white measurement noise</p>
</blockquote>
<p>process noise matrix:</p>
<script type="math/tex; mode=display">\mathbf{Q} = E[\mathbf{w}\mathbf{w}^T]</script><p>measurement noise matrix:</p>
<script type="math/tex; mode=display">\mathbf{R} = E[\mathbf{v}\mathbf{v}^T]</script><h3 id="Kalman-Filter-in-Discrete-Form"><a href="#Kalman-Filter-in-Discrete-Form" class="headerlink" title="Kalman Filter in Discrete Form"></a>Kalman Filter in Discrete Form</h3><p><strong>Time UpdateÔºàState prediction</strong></p>
<p><strong>(1) State prediction</strong> </p>
<script type="math/tex; mode=display">\hat{\mathbf{x}}_k = \boldsymbol{\Phi}_k\hat{\mathbf{x}}_{k - 1}+\mathbf{G}_k\mathbf{u}_{k - 1}, \quad \mathbf{G}_k=\int_{0}^{T_s}\boldsymbol{\Phi}(\tau)\mathbf{G} \mathrm{d}\tau</script><p><strong>(2) Covariance prediction</strong> </p>
<script type="math/tex; mode=display">\mathbf{M}_k = \boldsymbol{\Phi}_k\mathbf{P}_{k - 1}\boldsymbol{\Phi}_k^T+\mathbf{Q}_k</script><p><strong>Measure Update</strong></p>
<p><strong>(1) Kalman gain update</strong> </p>
<script type="math/tex; mode=display">\mathbf{K}_k=\mathbf{M}_k\mathbf{H}^T(\mathbf{H}\mathbf{M}_k\mathbf{H}^T+\mathbf{R}_k)^{-1}</script><p><strong>(2) State Update</strong> </p>
<script type="math/tex; mode=display">\hat{\mathbf{x}}_k = \boldsymbol{\Phi}_k\hat{\mathbf{x}}_{k - 1}+\mathbf{G}_k\mathbf{u}_{k - 1}+\mathbf{K}_k(\mathbf{z}_k-\mathbf{H}\boldsymbol{\Phi}_k\hat{\mathbf{x}}_{k - 1}-\mathbf{H}\mathbf{G}_k\mathbf{u}_{k - 1})</script><p><strong>(3) Covariance Update</strong> </p>
<script type="math/tex; mode=display">\mathbf{P}_k = (\mathbf{I}-\mathbf{K}_k\mathbf{H})\mathbf{M}_k</script><h3 id="Derivation-of-Scalar-Riccati-Equations-may-not-in-the-exam"><a href="#Derivation-of-Scalar-Riccati-Equations-may-not-in-the-exam" class="headerlink" title="Derivation of Scalar Riccati Equations (may not in the exam)"></a>Derivation of Scalar Riccati Equations (may not in the exam)</h3><p>If there is no deterministic disturbance or control scalar, our discrete model of the real world is given by:</p>
<script type="math/tex; mode=display">x_k = \Phi_kx_{k - 1} + w_k</script><p>The scalar Kalman - filtering equation:</p>
<script type="math/tex; mode=display">\hat{x}_k = \Phi_k\hat{x}_{k - 1}+K_k(z_k - H\Phi\hat{x}_{k - 1})</script><p>Measurement equation:</p>
<script type="math/tex; mode=display">z_k = Hx_k + v_k</script><p>Error:</p>
<script type="math/tex; mode=display">\tilde{x}_k=(1 - K_kH)\tilde{x}_{k - 1}\Phi_k+(1 - K_kH)w_k - K_kv_k</script><p>Covariance: </p>
<script type="math/tex; mode=display">P_k = E(\tilde{x}^2_k) \quad Q_k = E(w^2_k) \quad R_k = E(v^2_k)</script><p>we can square and take expectations of both sides of the error in the estimate equation to obtain:</p>
<script type="math/tex; mode=display">P_k=(1 - K_kH)^2(P_{k - 1}\Phi^2_k + Q_k)+K^2_kR_k</script><p>define: </p>
<script type="math/tex; mode=display">M_k = P_{k - 1}\Phi^2_k + Q_k</script><script type="math/tex; mode=display">P_k=(1 - K_kH)^2M_k + K^2_kR_k</script><p>Finding the gain that will minimize the variance of the error in the estimate:</p>
<script type="math/tex; mode=display">\frac{\partial P_k}{\partial K_k}=0 = 2(1 - K_kH)M_k(-H)+2K_kR_k</script><script type="math/tex; mode=display">K_k=\frac{M_kH}{H^2M_k + R_k}=M_kH(H^2M_k + R_k)^{-1}</script><p>Substitution of the optimal gain into the covariance equation and simplification:</p>
<script type="math/tex; mode=display">P_k=(1 - K_kH)M_k</script><blockquote>
<p><strong>The gain of the Kalman filter is chosen to minimize the variance of the error in the estimate.</strong></p>
</blockquote>
<h3 id="Polynomial-Kalman-Filter-Zero-Process-Noise"><a href="#Polynomial-Kalman-Filter-Zero-Process-Noise" class="headerlink" title="Polynomial Kalman Filter (Zero Process Noise)"></a>Polynomial Kalman Filter (Zero Process Noise)</h3><p><img src = "https://img.dexbug.com/i/2025/04/16/y0f1mn.png"></p>
<h3 id="Comparing-Zeroth-Order-Recursive-Least-Squares-and-Kalman-Filters"><a href="#Comparing-Zeroth-Order-Recursive-Least-Squares-and-Kalman-Filters" class="headerlink" title="Comparing Zeroth-Order Recursive Least-Squares and Kalman Filters"></a>Comparing Zeroth-Order Recursive Least-Squares and Kalman Filters</h3><p>Substitution of the fundamental and measurement matrices of table into</p>
<script type="math/tex; mode=display">\hat{x}_k = \Phi_k\hat{x}_{k - 1}+K_k(z_k - H\Phi_k\hat{x}_{k - 1})</script><p>the scalar equation: </p>
<script type="math/tex; mode=display">\hat{x}_k = \hat{x}_{k - 1}+K_{1k}(x^*_k - \hat{x}_{k - 1})</script><p>define: </p>
<script type="math/tex; mode=display">Res_k = x^*_k - \hat{x}_{k - 1}</script><p>The zeroth - order or one - state polynomial Kalman - filter equation simplifies to</p>
<script type="math/tex; mode=display">\hat{x}_k = \hat{x}_{k - 1}+K_{1k}Res_k</script><p>which is the same as the equation for the zeroth - order recursive least - squares filter.</p>
<p>If we assume that the initial covariance matrix is infinite (i.e., this means that we have no a priori information on how to initialize the filter state)</p>
<script type="math/tex; mode=display">P_0 = \infty</script><p>the Riccati equation</p>
<script type="math/tex; mode=display">M_1 = \Phi_1P_0\Phi_1^T = 1\times \infty\times 1=\infty</script><script type="math/tex; mode=display">K_1 = M_1H^T(HM_1H^T + R_1)^{-1}=\frac{M_1}{M_1+\sigma^2_n}=\frac{\infty}{\infty+\sigma^2_n}=1</script><script type="math/tex; mode=display">P_1=(I - K_1H)M_1=\left(1 - \frac{M_1}{M_1+\sigma^2_n}\right)M_1=\frac{\sigma^2_nM_1}{M_1+\sigma^2_n}=\sigma^2_n</script><p>When the zeroth-order polynomial Kalman filter has zero process noise and infinite initial covariance matrix, it has the same gains and variance predictions as the zeroth-order recursive least-squares filter</p>
<blockquote>
<p>The zeroth-order, first-order, and second order polynomial Kalman and recursive least-squares filters are identical in every way when the Kalman filter has zero process noise and infinite initial covariance matrix. </p>
</blockquote>
<h2 id="Lesson-8"><a href="#Lesson-8" class="headerlink" title="Lesson 8"></a>Lesson <em>8</em></h2>
<div class="article-footer fs14"></div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">ÂõûÈ°æ‰∏ä‰∏ÄÁØá</div><a href="/notes/dc.html">Digital Circuit(EN)</a></div><div class="item" id="next"></div></section></div>




<footer class="page-footer footnote"><hr><div class="sitemap"><div class="sitemap-group"><span class="fs15">ÂçöÂÆ¢</span><a href="/">ËøëÊúü</a><a href="/categories/">ÂàÜÁ±ª</a><a href="/tags">Ê†áÁ≠æ</a><a href="/archives">ÂΩíÊ°£</a></div><div class="sitemap-group"><span class="fs15">È°πÁõÆ</span><a href="/wiki/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">Â≠¶‰π†Á¨îËÆ∞</a></div><div class="sitemap-group"><span class="fs15">Êõ¥Â§ö</span><a target="_blank" rel="noopener" href="https://github.com/">GitHub</a></div></div><div class="text"><center>
<span>
¬© 2024
<a style="font-weight: bold;  auto;" target="_blank" rel="noopener" href="https://github.com/Maxwell0339">Maxwell</a>
‰ΩøÁî® <a style="font-weight: bold;  auto;" target="_blank" rel="noopener" href="https://github.com/FelicxFoster/hexo-theme-stellar">Stellar</a>
ÂàõÂª∫
</span>
<br>
<!--‰∏çËíúÂ≠êËÆ°Êï∞Âô®-->
<script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!--Ê∑ªÂä†‰∏Ä‰∏™ËÆøÈóÆÈáè-->
<span>ÊÄªËÆøÈóÆ <span id="busuanzi_value_site_pv" style="font-weight: bold;"></span> Ê¨° | Êú¨È°µËÆøÈóÆ <span id="busuanzi_value_page_pv" style="font-weight: bold;"></span> Ê¨°</span>
</br>
<span id="runtime_span"></span>

<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    var runtime_span = document.getElementById('runtime_span');

    function show_runtime() {
      // Ë∞ÉÁî®ÂÆöÊó∂Âô®
      setTimeout(show_runtime, 1000);

      var seconds = 1000;
      var minutes = seconds * 60;
      var hours = minutes * 60;
      var days = hours * 24;
      var years = days * 365;

      var today = new Date();
      var todayYear = today.getFullYear();
      var todayMonth = today.getMonth();
      var todayDate = today.getDate();
      var todayHour = today.getHours();
      var todayMinute = today.getMinutes();
      var todaySecond = today.getSeconds();

      var t1 = Date.UTC(2025, 2, 23, 0, 0, 0); // UTCÊó∂Èó¥ÔºåÊúà‰ªΩ‰ªé0ÂºÄÂßã
      var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
      var diff = t2 - t1;

      var diffYears = Math.floor(diff / years);
      var diffDays = Math.floor((diff / days) - diffYears * 365);
      var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
      var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
      var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);

      // Êõ¥Êñ∞ÊòæÁ§∫Êó∂Èó¥ÁöÑspanÂÖÉÁ¥†ÂÜÖÂÆπ
      runtime_span.innerHTML = "ü¶âËê•‰∏öÔºö" + diffYears + " Âπ¥ " + diffDays + " Â§© " + diffHours + " Â∞èÊó∂ " + diffMinutes + " ÂàÜÈíü " + diffSeconds + " Áßíü¶â";
    }

    show_runtime(); // ÂàùÊ¨°Ë∞ÉÁî®ÂáΩÊï∞‰ª•ÂêØÂä®ÂÆöÊó∂Âô®
  });
</script>
</center>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">Êú¨ÊñáÁõÆÂΩï</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Lesson-1"><span class="toc-text">Lesson 1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Example1-Measure-the-center-temperature-of-a-rocket-flame"><span class="toc-text">Example1 - Measure the center temperature of a rocket flame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Example2-Data-Merging"><span class="toc-text">Example2 - Data Merging</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Example3-A-simple-0-order-Kalman-filter"><span class="toc-text">Example3 - A simple 0-order Kalman filter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lesson-2"><span class="toc-text">Lesson 2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Numerical-integration-of-differential-equations"><span class="toc-text">Numerical integration of differential equations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Noise-and-random-variables"><span class="toc-text">Noise and random variables</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#State-space-notation"><span class="toc-text">State space notation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fundamental-matrix"><span class="toc-text">Fundamental matrix</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lesson-3"><span class="toc-text">Lesson 3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Least-squares-method"><span class="toc-text">Least squares method</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zero-order-of-one-state-filter"><span class="toc-text">Zero order of one-state filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#First-order-or-two-state-filter"><span class="toc-text">First order or two-state filter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lesson-4-may-not-in-the-exam"><span class="toc-text">Lesson 4(may not in the exam)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Second-order-LS-filter"><span class="toc-text">Second order LS filter*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Third-order-LS-filter"><span class="toc-text">Third order LS filter*</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lesson-5"><span class="toc-text">Lesson 5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Accelerometer-testing-example"><span class="toc-text">Accelerometer testing example</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Making-Least-Squares-filter-recursive"><span class="toc-text">Making Least-Squares filter recursive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recursive-properties-of-One-State-filters"><span class="toc-text">Recursive properties of One-State filters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recursive-properties-of-One-State-filters-1"><span class="toc-text">Recursive properties of One-State filters</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lesson-6"><span class="toc-text">Lesson 6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Filters-properties-of-Two-State-filters"><span class="toc-text">Filters properties of Two-State filters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Properties-of-Second-Order-or-Three-State-filter"><span class="toc-text">Properties of Second-Order or Three-State filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recursive-filter-summary"><span class="toc-text">Recursive filter summary</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lesson-7"><span class="toc-text">Lesson 7</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Polynomial-Kalman-Filters"><span class="toc-text">Polynomial Kalman Filters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#General-Equations"><span class="toc-text">General Equations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kalman-Filter-in-Discrete-Form"><span class="toc-text">Kalman Filter in Discrete Form</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Derivation-of-Scalar-Riccati-Equations-may-not-in-the-exam"><span class="toc-text">Derivation of Scalar Riccati Equations (may not in the exam)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Polynomial-Kalman-Filter-Zero-Process-Noise"><span class="toc-text">Polynomial Kalman Filter (Zero Process Noise)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Comparing-Zeroth-Order-Recursive-Least-Squares-and-Kalman-Filters"><span class="toc-text">Comparing Zeroth-Order Recursive Least-Squares and Kalman Filters</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lesson-8"><span class="toc-text">Lesson 8</span></a></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>ÂõûÂà∞È°∂ÈÉ®</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `ÂàöÂàö`,
      min: `ÂàÜÈíüÂâç`,
      hour: `Â∞èÊó∂Ââç`,
      day: `Â§©Ââç`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js`,
    marked: `https://cdn.jsdelivr.net/npm/marked@13.0.1/lib/marked.umd.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // ÊáíÂä†ËΩΩ css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // ÈªòËÆ§ÂºÇÊ≠•ÔºåÂ¶ÇÊûúÈúÄË¶ÅÂêåÊ≠•ÔºåÁ¨¨‰∫å‰∏™ÂèÇÊï∞‰º†ÂÖ• {} Âç≥ÂèØ
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 Á≠âÂæÖ 1 ÂÆåÊàê 2 Ë∂ÖÊó∂
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('ËØ∑Ê±ÇË∂ÖÊó∂');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>


<!-- required -->
<script src="/js/main.js?v=1.29.1" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    applyThemeToGiscus(theme)
  }

  const applyThemeToGiscus = (theme) => {
    theme = theme === 'auto' ? 'preferred_color_scheme' : theme

    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)

    const messages = {
      light: `ÂàáÊç¢Âà∞ÊµÖËâ≤Ê®°Âºè`,
      dark: `ÂàáÊç¢Âà∞Ê∑±Ëâ≤Ê®°Âºè`,
      auto: `ÂàáÊç¢Âà∞Ë∑üÈöèÁ≥ªÁªüÈÖçËâ≤`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    }
  })()
</script>


<!-- optional -->



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css`,
    js: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    processEscapes: true
  }
});
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});
MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for(i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `Â§çÂà∂ÊàêÂäü`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
