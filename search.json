[{"title":"如何从0搭建你的Python环境","path":"/2025/04/07/20250407/","content":"这篇文章将介绍如何在你的电脑上配置Python环境，并使用Anaconda管理你的python环境。使用这篇文章介绍的方法，从0开始配置。 Anaconda安装Anaconda 是一个开源的 Python 和 R 语言的发行版本，主要用于数据科学、机器学习和科学计算。它提供了一个方便的环境管理工具，使得用户可以轻松地创建、管理和切换不同的 Python 环境。 为何是虚拟环境？ Anaconda提供的是Python的虚拟环境，使每个环境之间尽可能互不干涉。因为Python的第三方库十分丰富，在安装库的过程中，如果一直使用一个环境，可能会导致一些包互相冲突，十分麻烦。隔离出不同的环境有助于我们管理Python项目。 如何下载？ 下载地址 这是清华大学开源软件镜像站，可以避免网速太慢下载太慢的问题。 进入镜像站后，我们选择合适的Anaconda版本进行下载（注意操作系统，这里我们是windows系统） 下载，打开进入安装界面。点击Next。注意在选择安装位置时，建议安装在除C盘外其他的盘，以免过度占用C盘空间。 注意需要将这三个都勾上，然后安装（图片来源：(https://blog.csdn.net/qq_44000789/article/details/142214660)） 等待安装结束。 安装结束后，打开Anaconda Prompt，输入1conda --version 如果能显示conda版本，说明安装成功 Anaconda更改默认环境保存路径和更改下载源更改保存路径一般来说，conda下载保存的环境都会存储在C盘，很容易造成C盘爆满，我们需要更改conda的默认安装路径。 新建一个文件夹用来存放虚拟环境和相应的包 使用命令1conda config --add envs_dirs D:\\conda\\envs1conda config --add pkgs_dirs D:\\conda\\pkgs即可更改环境。注意后面的路径名称需要更换成你自己创建的路径名称。 更改下载源因为conda很多下载的东西在国外，默认的下载速度往往会很慢。一般推荐清华源，使用以下命令更改你的下载源123conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/ 如果这里误装了不可用的镜像源可以输入以下指令删除1conda config --remove-key channels 这样，我们的conda就基本配置好了。 创建Python虚拟环境配置好conda后，我们就可以创建python虚拟环境了。 打开Prompt，输入1conda create -n env_name python=3.9env_name是你的环境名称，python=3.9是你需要的python版本。 等待安装。安装好后，我们使用下面的命令来激活虚拟环境：1conda activate env_name这样，你的python就可以正常使用了。 另外，提供一些常用的conda指令 12345678910111213&gt;conda env list #查看存在的虚拟环境&gt;conda list #激活环境后，查看当前环境下安装的库&gt;conda search package_name #查询是否有想要安装的库&gt;conda install package_name #在当前环境中安装库&gt;pip install package_name #在当前环境中安装库&gt;conda update package_name #更新环境中的某个库&gt;conda uninstall package_name #卸载环境中的库 使用Python一般来说，我们并不使用Python自带的IDE去进行编程。这里我推荐的IDE是Vscode(下载地址) Vscode的下载可以参照一些其他的网站，这里就不再赘述了。安装完Vscode后，打开Vscode，先安装简体中文插件。 安装成功后，会重启Vscode。 接着，搜索code runner，Python插件并安装 安装好后，在上方搜索栏选择“显示并运行命令” 输入Python，选择“选择解释器”，再选择你创建的python环境。就大功告成了。 这样，你就可以创建python文件进行编程了。 后记这篇博客简单介绍了如何创建Python的虚拟环境并进行Python编程。如果问题，可以在互联网上搜索一些Python虚拟环境安装的疑难杂症贴，这里就不一一说明可能会出现的问题了。后续也会收集一些疑难杂症解决方案贴在文后，帮助大家完成环境的搭建！","tags":["Python"],"categories":["学习"]},{"title":"如何使用LaTex写文章？","path":"/2025/03/25/20250325/","content":"前言 个人不是特别推荐使用vscode或者Texstudio去搭建Latex书写环境。使用 overleaf在线编辑 是一个不错的选择，虽然有时候编译的时间会比较慢。 什么是 LaTeX？LaTeX 是基于 TeX 语法体系的排版工具，通过代码实现内容与样式的分离式写作。 相较于Word，我更为青睐LaTeX的主要原因在于其卓越的排版表现，尤其在数学公式处理方面优势显著。尽管Word可通过MathType等插件实现公式编辑，但LaTeX凭借其原生支持的公式排版系统，在数学符号的精确定位、公式结构的专业呈现以及整体视觉协调性方面始终保持着明显优势。这种由代码驱动的排版机制，使得最终输出的文档在学术严谨性和版式美观度上都更胜一筹。 本文将以日常实践为例，分享 LaTeX 的常用指令与排版技巧。 开始如何开始你的LaTex写作之旅？ 首先先确定你的文章类型。这是至关重要的基础工作，不同文档类型对应不同的排版规范。我比较喜欢去使用大佬们配置好的写作模板，能大大节省我去设置写作环境（例如字体，行间距等）的时间。当然如果你是第一次使用别人的模板的话，我建议认真去看模板项目的README文件。 那么接下来就正式开始你的写作环节了！ 打开Overleaf官方网站，注册账号，登录，创建新项目，就可以去创建LaTex项目了。 语法环境在项目主文件.tex中，我们的文章内容都会包含在： 123\\begin&#123;document&#125;\\end&#123;document&#125; 一般来说，\\begin&#123;document&#125;前面还会设置文档属性以及会用到的宏包。 宏包是用来扩展/增强LaTeX的功能，宏包与LaTeX的关系和浏览器插件与浏览器的关系类似，通过安装不同的宏包可以实现一些复杂排版功能，例如插入复杂的列表表格、插入公式和特殊符号、插入代码、设置文档版式等。 使用\\usepackage&#123;&#125;来添加你想要的宏包。常见的宏包有: 123456789101112131415161718192021\\usepackage&#123;graphicx&#125; %这个宏包引入了插图命令 \\includegraphics，我们的文档如果需要插图都将用到它。\\usepackage&#123;amsmath&#125;\\usepackage&#123;mathtools&#125;%这是两个常见的数学扩展包,提供更多的数学符号等\\usepackage&#123;geometry&#125;%修改页面尺寸、页边距、页眉页脚等参数\\usepackage&#123;float&#125;%为浮动体提供不浮动的 H 模式；提供自定义浮动体结构的功能\\usepackage&#123;tikz&#125;%tikz绘图神器,可以用于绘制一些流程图等\\usepackage&#123;ctex&#125;%面向中文的排版框架，如果文章内容为中文请添加该宏包。\\usepackage&#123;cite&#125;%交叉引用的宏包 除了宏包指令以及一些文档配置指令外，剩下我们所有的内容都需要在\\begin&#123;document&#125;和\\end&#123;document&#125;中。 由于Latex不支持中文，需要使用ctex宏包。还需要在左上角的菜单中将编译方式改成XeLaTex。 标题设置LaTex可以设置不同级别的标题，基本的格式为 123\\section&#123;一级标题&#125;\\subsection&#123;二级标题&#125;\\subsubsection&#123;三级标题&#125; Latex最多支持七级结构：part、chapter、section、subsection、subsubsection、paragraph、subparagraph。 我们一般使用上面列出的三种结构。如果需要生成目录，在第一个标题前使用\\teblaofcontents即可生成目录。 有序列表和无序列表使用\\begin&#123;enumerate&#125;创建有序列表 1234\\begin&#123;enumerate&#125; \\item 你的内容1 \\item 你的内容2\\end&#123;enumerate&#125; 使用\\begin&#123;itemize&#125;创建无序列表 1234\\begin&#123;itemize&#125; \\item 你的内容1 \\item 你的内容2\\end&#123;itemize&#125; 正文分段一般来说，LaTeX默认的第一段不是首行缩进的, 这不符合我们的中文习惯。要实现首行缩进也很简单。请使用\\setlength&#123;\\parindent&#125;&#123;2em&#125; 设置全局首行缩进两个字符（需要使用宏包\\usepackage&#123;indentfirst&#125;）。 如果需要取消某个段落的首行缩进，请在该段落前使用 oindent。如果需要全局取消首行缩进，请使用\\setlength&#123;\\parindent&#125;&#123;0pt&#125; LaTex是如何区分段落的呢？只需要在两段文字之间增加一行空白段落即可！例如 12345\\begin&#123;document&#125; 这是一段文字。 这是另一段文字。\\end&#123;document&#125; 图片添加使用\\usepackage&#123;graphicx&#125;宏包后，就可以在LaTex正文添加图片了。基本的语法规则为： 123456\\begin&#123;figure&#125;[htbp] \\centering \\includegraphics[scale=0.2]&#123;example.png&#125; \\caption&#123;figure title&#125; \\label&#123;figure&#125;\\end&#123;figure&#125; 解释： \\begin&#123;figure&#125;和\\end&#123;figure&#125;是固定的用法，用于插入图片。 \\centering表示将图片置中。 \\caption&#123;图片标题&#125;用来设置图片标题 \\label&#123;标签&#125;用来设置标签，可以让图片在正文中被引用。使用\\cite&#123;label&#125;指令在正文中生成引用角标。 记得要将添加的图片添加到项目文件夹内，可以新建一个文件夹用来存放图片，也可以将图片和.tex文件放在同目录内。\\includegraphics[]&#123;&#125;的第二个参数就是图片的文件地址。 图片的位置也可以通过参数控制。\\begin&#123;figure&#125;[htbp]中的htbp就可以控制图片位置。具体意义如下： h：表示当前位置（here），也就是说图片将放在你设置的当前位置，但是如果这一页的空间不足以放下这个图片，此时图片会转到下一页； t：顶端（top），此时优先将图片放置在页面的顶部； b：底部（bottom）此时优先将图片放置在页面底部； p：将图片设置为浮动状态，系统会自动排版图片的位置。 表格添加首先，绘制一张表格需要创建table 和 tabular 环境。在文章开头还需要加上宏包\\usepackage&#123;array&#125;。一个简单的表格绘制代码如下所示： 12345678910111213\\begin&#123;table&#125;[!htp] \\centering \\caption&#123;Start with a simple form&#125; \\label&#123;one&#125; \\begin&#123;tabular&#125;&#123;l|c|r&#125; \\hline 1 &amp; 2 &amp; 3 \\\\ \\hline 01 &amp; 02 &amp; 03 \\\\ \\hline 001 &amp; 002 &amp; 003 \\\\ \\hline \\end&#123;tabular&#125; \\end&#123;table&#125; 效果： 表格的具体内容位于\\begin&#123;tabular&#125;和\\end&#123;tabular&#125; 之间，修改其中的内容就可以修改表格了。 &#123;l|c|r&#125;是来约定表格的每列属性的。用|分割和添加列 \\hline绘制一条横线用来分隔表格每一行 \\\\是换行标志 &amp;是列分隔符，用来区分没列的元素 所以一个基本的表格内容构造是由以上元素的构成。如果需要进行高阶操作例如单元格合并，后续会开一个专栏去讲解一些图片和表格的一些更高阶的操作。 数学公式我最欣赏LaTex的一点就是它的数学公式编辑功能了。如果你想在你的文字段落中添加数学公式，使用一个美元符号$来包含这个公式。 123\\begin&#123;document&#125; 这是你的内容，我们的数学公式是$y=x$。这是一个正比例函数。\\end&#123;document&#125; 效果为： 如果说，你想让你的数学公式另起一段，在新的一行添加需要的数学公式，请使用两个美元$$$$符号来包含这个公式。 1234\\begin&#123;document&#125; 这是你的内容，我们的数学公式是: $$y=2x$$\\end&#123;document&#125; 效果为： 或者，你需要用序号来编号你文章中的数学公式，使用\\begin&#123;equation&#125;和\\end&#123;equation&#125;，在这两段命令之间添加公式，注意不要使用美元符号了！ 123456\\begin&#123;document&#125; 这是你的内容，我们的数学公式是: \\begin&#123;equation&#125; y=3x \\end&#123;equation&#125;\\end&#123;document&#125; 数学公式内容的编写也有相应的语法，下面给大家列一些常见的符号，更多的可以使用Latex公式编辑器去编辑公式。 描述 语法 效果 分数 \\frac&#123;a&#125;&#123;b&#125; $\\frac{a}{b}$ 点乘 A \\Cdot B $A\\cdot B$ 叉乘 A \\times B $A \\times B$ 下标 A_&#123;b&#125; $A_{b}$ 上标 A^&#123;b&#125; $A^{b}$ 三角函数 \\sin a \\cos a \\tan a $\\sin a\\cos a\\tan a$ 根号 \\sqrt&#123;A&#125; $\\sqrt{A}$ 向量 \\overrightarrow&#123;a&#125; $\\overrightarrow{a}$ 积分 \\int_&#123;a&#125;^&#123;b&#125; $\\int_{a}^{b}$ 微分 \\frac&#123;\\mathrm&#123;d&#125; y&#125;&#123;\\mathrm&#123;d&#125; x&#125; $\\frac{\\mathrm{d} y}{\\mathrm{d} x}$ 参考文献在进行学术相关的创作时，我们需要添加必要的参考文献。这部分我们将介绍如何使用BibTex添加你需要的参考文献。 什么是BibTex？BibTeX 是最为流行的参考文献数据组织格式之一。BibTeX 使用数据库的的方式来管理参考文献. BibTeX 文件的后缀名为 .bib。.bib文件中参考文献的基本格式为： 123456789@article&#123;name1,author = &#123;作者, 多个作者用 and 连接&#125;,title = &#123;标题&#125;,journal = &#123;期刊名&#125;,volume = &#123;卷20&#125;,number = &#123;页码&#125;,year = &#123;年份&#125;,abstract = &#123;摘要, 这个主要是引用的时候自己参考的, 这一行不是必须的&#125;&#125; 解释： @article 是文献类型，还有其它格式, 例如 article, book, booklet, conference, inbook, incollection, inproceedings，manual, misc, mastersthesis, phdthesis, proceedings, techreport, unpublished 等等。使用大括号{}来包含文献的属性。 name1是这篇文章的名称标签，在正文中引用时会用到。例如引用时，使用\\cite&#123;name1&#125;指令。 一般情况下，我们需要自己去创建自己的bib文件。在overleaf的项目界面中，在左上角的新建文件去创建新文件，要将文件的后缀改成.bib。 大多时候，我们不需要自己去手写BibTex文献内容，我们可以在谷歌学术中找到需要文献的BibTex。 打开谷歌学术)（需要科学上网，可以自行搜索一些镜像网站），搜索文献标题或者关键词，例如，对于这篇文献，选择“引用” 再选择“BibTex”： 将出现的内容复制的你的bib文件中，就成功构建你的文献数据库了。 在创建完bib文件后，在\\begin&#123;document&#125;中，我们在正文的最后使用一些指令： 12\\bibliographystyle&#123;plain&#125;\\bibliography&#123;ref&#125; 其中\\bibliographystyle&#123;plain&#125;表示参考文献的类型。一般来说，plain样式基本就满足了大部分要求。Bibtex 参考文献样式_bibtex style-CSDN博客介绍了一些参考文件样式以及对应的效果。 \\bibliography&#123;ref&#125;表示了参考文献数据库来源。“ref”是你的bib文件名。你可以设置不同的bib文件名。 需要在你的正文中使用\\cite&#123;&#125;指令。如果一个文章中没有\\cite 命令，BibTex 就不知道哪一个bibliography是需要插入的。所以必须在你文章引用的地方加入\\cite。 结语Latex的基础教程到这里就差不多结束了，后续会将一些高阶的LaTe使用方法更新到LaTex学习专栏里，敬请期待！","tags":["LaTex"],"categories":["学习"]},{"title":"为什么我想建立自己的博客网站","path":"/2025/03/23/20250324/","content":"距离我上一次接触”博客”这个概念，已过去十余年。彼时新浪博客正风靡一时，我按照信息技术课本上的指导注册了人生第一个博客账号。如今那个网站似乎已停止维护，昔日的账号也早已遗忘在时光里。 这个博客诞生的动力 本质上是一种记录生活的方式！ 如今人们记录生活的方式层出不穷，主流社交平台几乎都具备分享与记录的功能。但对我而言，这些平台始终缺少某种难以言喻的归属感。 偶然间在互联网上看到技术大佬的个人博客——优雅的界面设计、清晰的文档分类、流畅的交互体验，还有着他们独特的生活感悟。着实令人心向往之。 那何不搭建自己的博客网站？虽说是临时起意，但这个想法一旦萌生便挥之不去。 从零开始的搭建历程对于毫无前端经验的新手而言，独立建站谈何容易。经过大量资料查阅，最终选择Hexo静态博客框架搭配Stellar主题。从环境配置到主题调试，历经整个通宵的摸索，这个博客的雏形终于初现。 内容与展望本博客主要存放个人学习笔记与技术心得，内容难免存在纰漏，恳请读者不吝指正！目前网站功能尚显单薄，计划后续逐步添加如下组件： 全局搜索功能 访客评论系统 内容交互式演示模块 技术探索永无止境，让我们共同见证这个博客的成长轨迹。","tags":["博客"],"categories":["杂谈"]},{"title":"Fluid Mechanics(EN)","path":"/notes/fm.html","content":"Chap.1 The EssentialsFluid: A fluid is defined as a substance that continually deforms (flows) under an applied shear stress regardless of the magnitude of the applied stress. Applications of fluid mechanics Biomechanics Households Meteorology and Ocean Engineering Mechanical Engineering Civil Engineering Chemical Engineering Classification of fluid flows Viscous vs Inviscid Internal vs External Compressible vs Incompressible Laminar vs Turbulent Natural vs Forced Steady vs Unsteady Properties of fluids Specific weight $\\gamma$ The ratio between the weight of a fluid to its volume \\gamma = \\rho g Specific gravity $S$ The ratio of the density of a substance to the density of water (or gas) S = \\frac{\\rho}{\\rho_{\\text{water}}} Viscosity (coefficient of dynamic viscosity) Dimension \\tau = \\mu \\frac{du}{dy} \\mu = \\frac{\\tau dy}{du} \\quad \\text{Pa} \\cdot \\text{s} Kinetic viscosity $ u$ $ u$ represents how a fluid behaves when it flows (while $\\mu$ represents how sticky a fluid is) u = \\frac{\\mu}{\\rho} Newtonian fluid vs Non-Newtonian fluid Newtonian Non - Newtonian $\\mu$ constant not constant $\\tau$ $f(du/dy)$ $f(\\mu, du/dy)$ graph linear non - linear Variation of viscosity with temperature As temperature increases: Viscosity of liquid decreases Viscosity of gas increases Surface tensionThe intensity of the molecular attraction per unit length along any line of the surface CapillarityThe phenomenon of rise or fall of a liquid surface in a small tube\\dots \\begin{align*} F_{\\sigma}&=\\sigma\\cos\\theta\\cdot2\\pi R=\\pi d\\sigma\\cos\\theta\\\\ F_{w}&=mg=\\rho Vg=\\rho\\frac{1}{4}\\pi d^{2}hg\\\\ F_{\\sigma}&=F_{w}\\Rightarrow\\pi d\\sigma\\cos\\theta=\\frac{1}{4}\\rho g\\pi d^{2}h\\\\ h&=\\frac{4\\sigma\\cos\\theta}{\\rho gd} \\end{align*} $\\theta$ is called contact angle (CA) $\\theta &lt; 90^\\circ$ : rising; adhesion &gt; cohesion; liquid wets the surface $\\theta &gt; 90^\\circ$ : falling; adhesion &lt; cohesion; Liquid does not wet the surface Chap.2 Fluid StaticsHydrostatics No relative motion between fluid particles No velocity gradient -&gt; no shear stress The only stress on this body is the normal stress, the pressure. Pressure P = \\frac{F}{A} Atmospheric pressure: the pressure within the atmosphere of Earth Absolute pressure: actual pressure at a given position Gauge pressure: measured pressure by devices Vacuum pressure: pressure below atmospheric pressure Gauge pressure from $P_{atm}$ $P_{gauge} = P_{abs} - P_{atm}$ Lower than $P_{atm}$, it is vacuum pressure. $P_{vac} = P_{atm} - P_{abs}$ Pressure is scalar, not a vector. Pascal’s Law A pressure change at any point in a confined incompressible fluid is transmitted throughout the fluid such that the same change occurs everywhere. 产生压力增值后，压强增值瞬时间传至静止流体各点 Variation of pressurePressure in a fluid increases with depth because more fluid rests on deeper layers. \\Delta P = P_1 - P_2 = \\rho g \\Delta z Key properties Pressure is independent of the shape of the container. Pressure is the same at all points on the same level. Pressure is dependent on height and density. ManometerA device to measure pressure by elevation change of a fluid. $P_2 = P_3$ $P_1 +\\rho_wgh = P_4 + \\rho_mgh$ Forces on plane and curved surfacesPrerequisite: Ignore the atmospheric pressure \\begin{align*} F&=\\int p\\mathrm{d}A=\\int(p_a + \\gamma h)\\mathrm{d}A=p_aA+\\gamma\\int h\\mathrm{d}A\\\\ h&=\\xi\\sin\\theta\\\\ F&=p_aA+\\gamma\\sin\\theta\\int\\xi\\mathrm{d}A=p_aA+\\gamma\\sin\\theta\\xi_{\\mathrm{CG}}A \\end{align*}Omitting the $p_a$ F = \\gamma h_{CG}A = \\rho g h_{CG}A EX ANS. \\begin{align*} A &= \\frac{1}{2}\\times 12 \\times 16 = 36 \\text{m}^2\\\\ h_{CG} &= 4 + 5 = 9 \\text{m}\\\\ p &= \\rho g h_{CG}A = 2.54 \\times 10^6 \\text{N} \\end{align*}Resultant force on a curved surface The horizontal component of force on a curved surface equals the force on the plane area formed by the projection of the curved surface onto a vertical plane normal to the component. The vertical component of pressure force on a curved surface equals in magnitude and direction the weight of the entire column of fluid, both liquid and atmosphere, above the curved surface Buoyancy Buoyancy force acting on the plate is equal to the weight of the liquid displaced by the plate Buoyancy force is independent of distance of the body from the free surface and density of the body Stability of immersed and floating body Stability is very important in design of ships and submarines When displaced, a body can be stable or unstable Stability of submerged bodyWhen completely submerged, a body is in stable equilibrium if the center of gravity falls below the center of buoyancy. Stability of floating body A floating body is stable if the center of gravity G is below the center of buoyancy B. A floating body is stable if the metacenter M is above G. M is intersection point of vertical lines of original B and new B. A linearly accelerating container (horizontal) In rigid-body motion, all particles are in combined translation and rotation. \\begin{align*} \\theta&=\\tan^{-1}\\frac{a_x}{g + a_z}\\\\ \\frac{dp}{ds}&=\\rho G\\quad\\text{where }G = [a_x^2+(g + a_z)^2]^{1/2} \\end{align*} EX ANS: a) \\theta =\\tan^{-1}\\frac{a_x}{g} =\\tan^{-1}\\frac{7}{9.81} = 35.5^\\circ \\Delta z =3 \\times \\tan 35.5^\\circ = 2.14\\text{cm} < 3\\text{cm}\\quad \\text{no spilling}b) When at rest p_A = \\rho g h = 694\\text{Pa}When moving \\begin{align*} p_A &= \\rho G \\Delta s= 1010 \\times \\sqrt{9.81^2+7.0^2}\\times (0.07+0.00214)\\cos35.5^\\circ \\\\ &=906\\text{Pa} \\end{align*}Chap.3 Fluid in MotionEulerian description The region of interest is referred to as a flow field The velocity in the flow field is referred to as velocity field Steady flow: physical quantities does not change with time \\frac{\\partial \\boldsymbol{V}}{\\partial t} = 0, \\quad \\frac{\\partial \\rho}{\\partial t} = 0, \\quad \\frac{\\partial p}{\\partial t} = 0 Unsteady flow: physical quantities change with time Description of fluid flow Pathline: the actual path traversed by a given fluid particle Streakline: the locus of particles that have earlier passed through a prescribed point; the path to be followed by next particles Streamline: a line everywhere tangent to the velocity vector at a given instant. In steady flow: Pathline = Streakline = Streamline Uniform flow: Flow velocity has same magnitude and direction at every point of a flow \\frac{\\partial \\boldsymbol{V}}{\\partial s} = 0, \\quad \\frac{\\partial \\rho}{\\partial s} = 0, \\quad \\frac{\\partial p}{\\partial s} = 0 Non-uniform flow: The velocity is not the same at every point at a given instant Dimension of a flow\\boldsymbol{V}=\\boldsymbol{V}(x,y,z,t)=u(x,y,z,t)\\boldsymbol{i}+v(x,y,z,t)\\boldsymbol{j}+w(x,y,z,t)\\boldsymbol{k} If some velocity components are negligible, the velocity field can be simplified as $\\boldsymbol{V}=u(x,y,t)\\boldsymbol{i}+v(x,y,t)\\boldsymbol{j}$: two - dimensional flow $\\boldsymbol{V}=u(x,t)\\boldsymbol{i}$: one - dimensional flow One dimension flow: $\\frac{\\partial F}{\\partial x} e 0$ Two dimension flow: $\\frac{\\partial F}{\\partial x} e 0$, $\\frac{\\partial F}{\\partial y} e 0$ Three dimension flow: $\\frac{\\partial F}{\\partial x} e 0$, $\\frac{\\partial F}{\\partial y} e 0$, $\\frac{\\partial F}{\\partial z} e 0$ Streamline Equation \\boldsymbol{V} \\times \\text{d}\\boldsymbol{s} = \\boldsymbol{0} \\frac{dx}{u} = \\frac{dy}{v} = \\frac{dz}{w}Acceleration field\\begin{align*} \\mathbf{a}&=u\\frac{\\partial\\mathbf{V}}{\\partial x}+v\\frac{\\partial\\mathbf{V}}{\\partial y}+w\\frac{\\partial\\mathbf{V}}{\\partial z}+\\frac{\\partial\\mathbf{V}}{\\partial t}\\\\ a_x&=u\\frac{\\partial u}{\\partial x}+v\\frac{\\partial u}{\\partial y}+w\\frac{\\partial u}{\\partial z}+\\frac{\\partial u}{\\partial t}\\\\ a_y&=u\\frac{\\partial v}{\\partial x}+v\\frac{\\partial v}{\\partial y}+w\\frac{\\partial v}{\\partial z}+\\frac{\\partial v}{\\partial t}\\\\ a_z&=u\\frac{\\partial w}{\\partial x}+v\\frac{\\partial w}{\\partial y}+w\\frac{\\partial w}{\\partial z}+\\frac{\\partial w}{\\partial t} \\end{align*}Laminar and turbulent flowWhether a flow is laminar or not depends on Reynolds number (Re). $Re = \\frac{\\rho UD}{\\mu}$ ($\\rho$: density, $U$: average velocity, $D$: diameter of a pipe, $\\mu$: viscosity) Pipe flow $Re &lt; 2000$: laminar flow $2000 &lt; Re &lt; 4000$: transitional flow $Re &gt; 4000$: turbulent flow Continuity equation abla\\cdot(\\rho\\boldsymbol{V})=-\\frac{\\partial\\rho}{\\partial t} If steady flow, $\\frac{\\partial\\rho}{\\partial t}=0$, $ abla\\cdot(\\rho\\boldsymbol{V}) = 0$ If stead flow &amp; incompressible flow, $\\rho = constant\\rightarrow abla\\cdot\\boldsymbol{V}=0$ \\frac{\\partial u}{\\partial x}+\\frac{\\partial v}{\\partial y}+\\frac{\\partial w}{\\partial z}=0Euler’s equation of motion\\frac{dP}{\\rho}+\\boldsymbol{V}d\\boldsymbol{V}+gdz = 0Assumptions: Fluid particles move along a streamline No viscosity: inviscid flow Steady flow Bernoulli’s Equation\\frac{P}{\\gamma}+\\frac{ u^2}{2g}+Z = H Each term represents energy per unit weight The total energy head is constant along a streamline The value of a constant may differ in different streamlines Assumptions: Assumptions for Euler’s equation Incompressible flow Venturi tube $\\frac{P_1}{\\gamma}+\\frac{ u_1^2}{2g}+Z_1=\\frac{P_2}{\\gamma}+\\frac{ u_2^2}{2g}+Z_2$ $Z_1 = Z_2$ (same level) $\\frac{(P_1 - P_2)}{\\gamma}=\\frac{ u_2^2- u_1^2}{2g}=\\frac{ u_2^2}{2g}\\left(1 - \\left(\\frac{ u_1}{ u_2}\\right)^2\\right)\\rightarrow u_2=\\frac{1}{\\sqrt{1-\\left(\\frac{ u_1}{ u_2}\\right)^2}}\\sqrt{2g\\frac{(P_1 - P_2)}{\\gamma}}$ From $Q = A_1 u_1=A_2 u_2\\rightarrow\\frac{ u_1}{ u_2}=\\frac{A_2}{A_1}=\\left(\\frac{D_2}{D_1}\\right)^2$ $\\frac{(P_1 - P_2)}{\\gamma}=\\frac{(\\gamma_0-\\gamma)h}{\\gamma}=\\left(\\frac{\\gamma_0}{\\gamma}-1\\right)h$ $ u_2=\\frac{1}{\\sqrt{1-\\left(\\frac{D_2}{D_1}\\right)^4}}\\sqrt{2gh\\left(\\frac{\\gamma_0}{\\gamma}-1\\right)}$ Orifice $\\frac{P_1}{\\gamma}+\\frac{v_1^2}{2g}+Z_1=\\frac{P_2}{\\gamma}+\\frac{v_2^2}{2g}+Z_2$ $P_1 = P_2 = P_{atm}=0$ $A_1\\gg A_2\\rightarrow v_1\\ll v_2$ $\\frac{v_2^2}{2g}=Z_1 - Z_2 = h$ $v_2^2 = 2gh$ $v = v_2=\\sqrt{2gh}$ $Q = A_2v_2=\\frac{\\pi d^2}{4}\\sqrt{2gh}$ Chap.4 The Integral EquationsBernoulli Interpreted as an Energy Relation If no friction: $\\frac{P_1}{\\gamma}+\\frac{v_1^2}{2g}+z_1=\\frac{P_2}{\\gamma_2}+\\frac{v_2^2}{2g}+z_2$ Connect all the points of $\\frac{P}{\\gamma}+\\frac{v^2}{2g}+z$ Energy grade line (EGL) or Energy line (EL) Connect all the points of $\\frac{P}{\\gamma}+z$ Hydraulic grade line (HGL) EGL = HGL + velocity head ($\\frac{v^2}{2g}$) If there is friction: Gradually slower EGL drop slowly $H_L$ head loss $\\frac{P_1}{\\gamma_1}+\\frac{v_1^2}{2g}+z_1=\\frac{P_2}{\\gamma_2}+\\frac{v_2^2}{2g}+z_2 + H_L$ Energy Equation \\Delta E = E_{in} - E_{out}The energy can be changed by Heat transfer Q Work transfer W The conservation of energy for a fixed mass can be expressed in rate form as \\dot{Q}_{net}+\\dot{W}_{net}=\\frac{dE_{sys}}{dt} $\\dot{Q}_{net}=\\dot{Q}_{in}-\\dot{Q}_{out}$ $\\dot{W}_{net}=\\dot{W}_{in}-\\dot{W}_{out}$ $\\frac{dE_{sys}}{dt}$ is the change rate of total energy content of the system Energy efficiency a ratio that describes the relationship between energy input to a device into energy generated by the device $\\eta=\\frac{E_{out}}{E_{in}}=\\frac{\\dot{E}_{out}}{\\dot{E}_{in}}=\\frac{Power_{out}}{Power_{in}}$ $Power = \\gamma QH = PQ = \\dot{m}gH$ unit: 1 kW = 1000 W, 1 PS = 735.5 W, 1Hp = 746 W Pump: $\\eta_p=\\frac{\\gamma QH}{Power}\\rightarrow Power=\\frac{\\gamma QH}{\\eta_p}=\\frac{PQ}{\\eta_p}$ Turbine: $\\eta_t=\\frac{Power}{\\gamma QH}\\rightarrow Power = \\gamma QH\\cdot\\eta_t=PQ\\cdot\\eta_t$ Momentum in fluid $\\dot{m}=\\frac{m}{\\Delta t}=\\rho Av=\\rho Q$ $d\\dot{m}=\\frac{dm}{dt}=\\rho dQ$ In x - direction: $\\sum F_x=\\rho Q(v_{x2}-v_{x1})=\\rho Q(v_2\\cos\\theta_2 - v_1\\cos\\theta_1)$ In y - direction: $\\sum F_y=\\rho Q(v_{y2}-v_{y1})=\\rho Q(v_2\\sin\\theta_2 - v_1\\sin\\theta_1)$ Single fixed vane Assume the diameter of the jet is the same $v = v_1 = v_2$ Equation of momentum: $F_x = P_1A_1\\cos\\theta_1 - P_2A_2\\cos\\theta_2+\\rho Q(v_1\\cos\\theta_1 - v_2\\cos\\theta_2)$ $-F_y = P_1A_1\\sin\\theta_1 - P_2A_2\\sin\\theta_2+\\rho Q(v_1\\sin\\theta_1 - v_2\\sin\\theta_2)$ $P_1 = P_2 = P_{atm}$ ignore pressure effect $F_x=\\rho Q(v - v\\cos\\theta)=\\rho Qv(1 - \\cos\\theta)=\\rho Av^2(1 - \\cos\\theta)$ $F_y=\\rho Q(v\\sin\\theta)=\\rho Av^2\\sin\\theta$ Fixed flat plate Equation of momentum $F_x = P_1A_1\\cos\\theta_1 - P_2A_2\\cos\\theta_2+\\rho Q(v_1\\cos\\theta_1 - v_2\\cos\\theta_2)$ $P_1 = P_2 = P_{atm}$ $F_x = F=\\rho Q(v - 0)=\\rho Qv=\\rho Av^2$ Moving flat plate Equation of momentum $F_x = P_1A_1\\cos\\theta_1 - P_2A_2\\cos\\theta_2+\\rho Q(v_1\\cos\\theta_1 - v_2\\cos\\theta_2)$ $P_1 = P_2 = P_{atm}$ $F_x = F=\\rho Q(v - u - 0)=\\rho Q(v - u)=\\rho A(v - u)^2$ $Power = F_xu\\ (W)$ Driving force by nozzle $F_x = P_1A_1\\cos\\theta_1 - P_2A_2\\cos\\theta_2+\\rho Q(v_1\\cos\\theta_1 - v_2\\cos\\theta_2)=\\rho Q(0 - v)=-\\rho Qv$ $F=\\rho Qv=\\rho Av^2=\\rho A(\\sqrt{2gh})^2=\\rho A2gh=2\\gamma Ah$ EX ANS: Control volume: \\dot{m}_{in} = \\dot{m}_{out}Then, \\rho_1 A_1 V_1 + \\rho_2 A_2 V_2 = \\rho_j A_j (V_j - V_c)Since the incompressible water, we have $\\rho_1 = \\rho_2=\\rho_j$, $A_1=A_2=\\frac{1}{2}A_j$ And because of the symmetry, V_1 =V_2 = V_j - V_c = 20-15 = 5\\text{m/s}So: R_x = \\sum F_x = \\dot{m_1}u_1 + \\dot{m_2}u_2 - \\dot{m_j}u_jSince $u_1 = u_2 = 0$, $\\dot{m_1} = \\dot{m_2} = \\frac{1}{2}\\dot{m_j}= \\rho_j A_j(V_j - V_c)$ R_x = -\\rho_j A_j(V_j -V_c)^2 = -7.5 \\text{N}Similarly, since $V_1 = V_2$, R_y = 0Rocket no inlet only outlet F=\\dot{m}vChap5. The Differential EquationAnalysis of fluid motion Control volume Differential analysis Differential equation of linear momentum\\sum F=\\frac{\\partial}{\\partial t}\\left(\\int_{CV} \\boldsymbol{V}\\rho dV\\right)+\\sum(\\dot{m}_i\\boldsymbol{V}_i)_{out}-\\sum(\\dot{m}_i\\boldsymbol{V}_i)_{in}Navier-Stokes equation \\begin{align*} \\rho\\boldsymbol{g}- abla\\boldsymbol{P}+\\mu abla^2\\boldsymbol{V}&=\\rho\\frac{D\\boldsymbol{V}}{Dt} \\end{align*}Frictionless flowBernoulli’s equation: \\frac{P}{\\rho} +\\frac{1}{2}V^2+gz = HAssumptions: Steady flow Frictionless flow Incompressible flow Along a streamline Couette flow Assumptions: Steady flow Incompressible flow 2D flow No velocity in y-direction No pressure gradient Continuity equation and momentum equation: \\frac{\\partial^2 u }{\\partial y^2} = 0Boundary condition: $y = -h\\rightarrow u = 0$ $y = h\\rightarrow u = U$ u=\\frac{U}{2h}y+\\frac{U}{2},\\ -h\\leq y\\leq +hStreamline Lines tangent to the instantaneous velocity vectors at every point Streamline can be expressed by stream function $\\Psi$ Stream function Allows for simplification of basic two-dimensional flows using single variable$\\Psi(x,y,t)$ 2D steady incompressible flow Stream function is defined based on the continuity equation \\frac{\\partial^2 \\Psi}{\\partial x \\partial y} - \\frac{\\partial^2 \\Psi}{\\partial y \\partial x} = 0Velocity potential functionIrrotational flow abla \\times \\boldsymbol{V} = \\textbf{0}Velocity field is expressed as the gradient of scalar function $\\Phi$ \\boldsymbol{V} = abla\\Phi Incompressible flow: $ abla\\cdot\\boldsymbol{V}=0$ $ abla^2\\Phi=\\frac{\\partial^2\\Phi}{\\partial x^2}+\\frac{\\partial^2\\Phi}{\\partial y^2}+\\frac{\\partial^2\\Phi}{\\partial z^2}=0$ \\frac{\\partial^2\\Phi}{\\partial x^2}+\\frac{\\partial^2\\Phi}{\\partial y^2}+\\frac{\\partial^2\\Phi}{\\partial z^2}=0 Equipotential line: lines along the same value of $\\Phi$ The velocity (streamline $\\Psi$) is orthogonal to the line of constant velocity potential The velocity profile of a potential flow can be estimated by velocity potential Potential flow Inviscid, incompressible, and irrotational flow fields Real flow Real fluids include regions of negligible shearing stress and regions of significant shearing stress (boundary layer) Potential flow Irrotational Vorticity is zero Chap6. Dimensional AnalysisBuckingham $\\Pi$ theoremForce acting on a cylinder F_D = f(v,\\, \\rho, \\, \\mu , \\, D)How to find the dimensionless number? Steps: Select related parameters variables n Write the functional relation 5 variables $F_D = f(v,\\, \\rho, \\, \\mu , \\, D)$ Select repeating variables Quantity Dimensional formula Force $[ML/T^2]$ Velocity $[L/T]$ Density $[M/L^3]$ Viscosity $[M/LT]$ D $[L]$ we choose repeating variables: $v$, $\\rho$, $D$ The number of $\\Pi$ parameters are $n − m$ $5-3=2$ 2 dimensionless numbers will characterize this problem Write the $\\Pi$-terms by combining the repeating variables with each of the remaining variables \\begin{align*} \\Pi_1&=\\rho^{a} u^{b}D^{c}F_D\\\\ \\Pi_2&=\\rho^{a} u^{b}D^{c}\\mu \\end{align*} Solve the equation from last step \\begin{align*} \\Pi_1&=\\rho^{a} u^{b}D^{c}F_D\\\\ &=\\left[\\frac{M}{L^3}\\right]^{a}\\left[\\frac{L}{T}\\right]^{b}[L]^{c}\\left[\\frac{ML}{T^2}\\right]\\\\ \\end{align*}For the exponents of $M$: \\begin{align*} a + 1&=0\\\\ a&=- 1 \\end{align*}For the exponents of $T$: \\begin{align*} -b - 2&=0\\\\ b&=-2 \\end{align*}For the exponents of $L$: \\begin{align*} -3a + b + c + 1&=0\\\\ -3\\times(-1)+(-2)+c + 1&=0\\\\ 3 - 2 + c + 1&=0\\\\ c&=-2 \\end{align*} \\Pi_1=\\frac{F_D}{\\rho u^{2}D^{2}} \\begin{align*} \\Pi_2&=\\rho^{a} u^{b}D^{c}\\mu\\\\ &=\\left[\\frac{M}{L^3}\\right]^{a}\\left[\\frac{L}{T}\\right]^{b}[L]^{c}\\left[\\frac{M}{LT}\\right] \\end{align*}For the exponents of $M$: \\begin{align*} a + 1&=0\\\\ a&=-1 \\end{align*}For the exponents of $T$: \\begin{align*} -b - 1&=0\\\\ b&=-1 \\end{align*}For the exponents of $L$: \\begin{align*} -3a + b + c - 1&=0\\\\ -3\\times(-1)+(-1)+c - 1&=0\\\\ 3 - 1 + c - 1&=0\\\\ c&=-1 \\end{align*} \\Pi_2 = \\frac{\\mu}{\\rho u D} Application of Dimensional AnalysisThe Reynolds number of both bodies is based on diameter: C_D= \\begin{cases} \\frac{\\text{drag}}{\\frac{1}{2}\\rho U^{2}Ld}&\\text{cylinder}\\\\ \\frac{\\text{drag}}{\\frac{1}{2}\\rho U^{2}\\frac{1}{4}\\pi d^{2}}&\\text{sphere} \\end{cases} C_D=\\frac{\\text{drag}}{\\frac{1}{2}\\rho U^{2}(\\text{projected area})} Example a) \\text{Re} = \\frac{\\rho Ud}{\\mu} = \\frac{1.2\\times 45 \\times 0.01}{1.8\\times 10^{-5}} = 30000 C_D = \\frac{F}{(1/2)\\rho U^2Ld} = \\frac{2.2}{(1/2)1.2\\times 45 \\times 0.2 \\times 0.01} = 0.905Yes, it is close. b) The Reynolds number meets the range of 10^4 < \\frac{1.2\\times 1 \\cdot U}{1.8\\times 10^{-5}} < 10^5 0.15 \\, \\text{m/s} < U < 1.5 \\, \\text{m/s}So the drag force F_{\\text{min}} = C_d \\frac{2}{\\rho}U_{\\text{min}}^2Ld = 0.91\\times (\\frac{1.2}{2}) \\times 0.15^2 \\times 20 \\times 1 = 0.25 \\text{N} F_{\\text{max}} = C_d \\frac{2}{\\rho}U_{\\text{max}}^2Ld = 0.91\\times (\\frac{1.2}{2}) \\times 1.5^2 \\times 20 \\times 1 = 25 \\text{N}c) The answer is always $F_{\\text{min}} = 0.25 \\text{N}$ Similarity For compressible flow, the model and prototype Reynolds number and Mach number and specific heat ratio are correspondingly equal. For incompressible flow: With no free surface: model and prototype Reynolds numbers are equal. With a free surface: model and prototype Reynolds number, Froude number, and (if necessary) Weber number and cavitation number are correspondingly equal. Chap7. Internal FlowsInternal flows: Flows completely bounded by solid surface The flow regime is primarily a function of $\\mathrm{Re}$ Reynolds numberThe transition from laminar to turbulent flow depends on: geometry surface roughness flow velocity surface temperature type of fluid \\mathrm{Re} = \\frac{\\text{inertial force}}{\\text{viscous force}} = \\frac{\\rho v_{\\text{avg}D}}{\\mu} $v_{\\text{avg}}$: average velocity $D$: characteristic length of the geometry The meaning of characteristic size is the geometric dimension that affects the flow state of the fluid Critical Reynolds number $\\mathrm{Re}_{\\text{cr}}$ flow becomes turbulent internal flow in a circular pipe: $\\mathrm{Re}_{\\text{cr}} = 2300$ Hydraulic diameter $D_h$ D_h = \\frac{4A_c}{p} $A_c$ is the cross-sectional area of the pipe $p$ is wetted perimeter For flow in circular pipes: Laminar flow: $\\mathrm{Re}\\leq2300$ Transitional flow: $2300\\leq\\mathrm{Re}\\leq4000$ Turbulent flow: $\\mathrm{Re}\\geq4000$ The entrance regionThe region of the flow where the viscous shearing forces (friction) affect the flow is called boundary layer. Boundary surface divides the flow in a pipe into two regions: Boundary layer region: viscous effect and the velocity changes Irrotational flow region: frictional effects are negligible and velocity remains constant in the radial direction Hydrodynamic entrance region: From the pipe inlet to the point where the boundary layer merges atthe centerline Hydrodynamic entry length $L_e$: The length of the region \\frac{L_e}{d} \\approx 1.6 \\mathrm{Re}_d^{\\frac{1}{4}} Hydrodynamically developing flow: Flow at the entrance region hydrodynamically fully developed region: Beyond the entrance region In the developed region, velocity profile is fully developed and remains unchanged. (parabolic in laminar flow) Laminar flow in pipes \\tau=-\\frac{r}{2}\\frac{dP}{dl} Distribution of shear stress If $r = 0\\rightarrow\\tau=0$ If $r$ increases, $\\tau$ linearly increases ($\\tau\\propto r$) If $r = R\\rightarrow\\tau_{max}=\\frac{\\Delta PD}{4L}$ Integral both sides, we can get the velocity: \\begin{align*} u(r)&=-\\frac{1}{4\\mu}\\frac{dP}{dl}(R^{2}-r^{2})\\\\ \\text{if }r = 0\\quad u_{max}&=-\\frac{R^{2}}{4\\mu}\\frac{dP}{dl} \\end{align*} \\frac{u}{u_{max}} = 1-\\left(\\frac{r}{R}\\right)^{2}Poiseuille’s flow: We consider the flowrate Q from the cross section of the pipe: Q=\\frac{\\pi R^{4}}{8\\mu}\\frac{dP}{dl} For whole length, $\\frac{dP}{dl}\\Rightarrow\\frac{\\Delta P}{L}$ Q=\\frac{\\Delta P\\pi D^{4}}{128\\mu L} Flow velocity in a pipe Not uniform Zero at the surface (no-slip condition) Maximum at center $v_{avg}$ is defined as the average speed through a cross section From the $Q = Av_{avg}$ v_{avg} = \\frac{1}{2}u_{max}Inclined pipes \\begin{align*} u(r)&=\\frac{1}{4\\mu}\\left(\\frac{dP}{dl}-\\rho g\\sin\\theta\\right)(R^{2}-r^{2})\\\\ u(r)&=\\frac{1}{4\\mu}\\left(\\frac{\\Delta P}{L}-\\rho g\\sin\\theta\\right)(R^{2}-r^{2}) \\end{align*} \\begin{align*} u_{max}&=\\frac{R^{2}}{4\\mu}\\left(\\frac{\\Delta P}{L}-\\rho g\\sin\\theta\\right)=\\frac{D^{2}}{16\\mu}\\left(\\frac{\\Delta P}{L}-\\rho g\\sin\\theta\\right)\\\\ u_{avg}&=\\frac{u_{max}}{2}=\\frac{D^{2}}{32\\mu}\\left(\\frac{\\Delta P}{L}-\\rho g\\sin\\theta\\right) \\end{align*} Q = \\frac{\\pi D^{4}}{128\\mu L}(\\Delta P - \\rho gL\\sin\\theta)Pressure drop in a pipe flowThe main driving force of internal flow is pressure difference (Pressure drop), $\\Delta P$ \\Delta P = \\frac{32\\mu Lv_{avg}}{D^2}Now, we consider an inclined pipe Considering friction, \\left(\\frac{P}{\\gamma}+\\frac{v^{2}}{2g}+z\\right)_1=\\left(\\frac{P}{\\gamma}+\\frac{v^{2}}{2g}+z\\right)_2 + H_f Since the flow is fully developed, $v_1 = v_2$ H_f=(z_1 - z_2)+\\left(\\frac{P_1}{\\gamma}-\\frac{P_2}{\\gamma}\\right)=\\Delta z+\\frac{\\Delta P}{\\gamma} By force balancing, \\begin{align*} \\Sigma F_l=\\Delta P\\pi R^{2}-\\rho g(\\pi R^{2})L\\sin\\theta-\\tau_w(2\\pi R\\cdot L)=0\\\\ \\frac{\\Delta P}{\\rho g}-L\\sin\\theta=\\frac{2\\tau_w}{\\rho g}\\frac{L}{R}=\\frac{4\\tau_w}{\\rho g}\\frac{L}{D}=H_f \\end{align*} H_f = \\frac{4\\tau _w}{\\rho g} \\frac{L}{D}From experiment, the head loss for all types of fully developed internal flows was found as: H_f = f \\frac{L}{D} \\frac{v_{avg}^2}{2g}$f$: Darcy friction factor f = \\frac{64}{\\mathrm{Re}}Turbulent flow in pipesMost flows in reality are turbulent Swirling regions Eddies Transport mass, momentum, and energy Higher values of friction, heat transfer, mass transfer Losses in turbulent pipe flow The head loss in the pipe flow was found as H_f = f\\frac{L}{D}\\frac{v_{avg}^2}{2g}Friction factor, $f$ In laminar flow: $f = f(Re)=\\frac{64}{Re}$ In turbulent flow: $f = f(\\frac{e}{D},Re)$ $e/D$ is relative roughness ($e$: roughness, $D$: diameter) Friction factor is found by experiment Moody chart ($e/D$, $Re$, $f$) Minor lossMost pipe systems consists of different components, not only straight pipes. Those components interrupt the smooth flow ofthe fluid and cause additional losses because of theflow separation and mixing they induce. a pipe with sudden contraction h_L=\\frac{v_2^2}{2g}\\left(\\frac{1}{C_c}-1\\right)^2Contraction coefficient $C_c = \\frac{A_1}{A_2}$ a pipe with sudden expansion h_L = \\frac{v_1^2}{2g}\\left(1 - \\frac{d}{D}\\right)^2Define the loss coefficient $K_L$ h_L=\\frac{v^{2}}{2g}K_L,\\quad K_L = \\frac{h_L}{v^{2}/2g}Piping networks Pipes in series Pipes in parallel Chap8. External FlowsExternal flows: The fluid and the flows completely surround an object External flows involving air are termed aerodynamics For typical external flows, the most important of parameter is $\\mathrm{Re}$ Boundary layer (BL) Real fluid flows past a stationary solid boundary (flat plate) at high Re: A thin layer adjoining the solid boundary, and viscous effects and rotation cannot be neglected In outer region away from the thin layer, the viscous effects are negligible, and the flow behavior is similar to the upstream flow, and thus, a potential flow can be assumed. Within the thin layer, there is a steep velocity gradient. Laminar boundary layer (BL) A free stream flows approaching a flat plate Viscosity is important inside the BL Outside BL, flow is inviscid If $\\mathrm{Re} &lt; 5 \\times 10^5$, BL is laminar No slip condition Equation for BL \\frac{\\delta}{x} = \\frac{5}{\\sqrt{\\mathrm{Re}_x}}, \\quad \\delta = \\frac{5x}{\\sqrt{\\mathrm{Re}_x}} \\tau _w = 0.332\\sqrt{\\frac{\\rho \\mu}{x}} U^{\\frac{3}{2}} = c_f \\frac{\\rho U^2}{2}, \\quad c_f = \\frac{0.664}{\\sqrt{\\mathrm{Re}_x}}Drag force at x position on the flat plate: F_D = \\int _0 ^x \\tau _w b \\mathrm{d}x = 0.664\\sqrt{\\rho \\mu x} U^{3/2}The nondimensional drag coefficient is defined as C_D = \\frac{2 \\left. F_D \\right|_{L}}{\\rho U^2 bL} = \\frac{1.328}{\\sqrt{\\mathrm{Re}_L}}Turbulent boundary layer (BL)Equations for BL: \\begin{align*} \\delta&=\\frac{0.16x}{Re_x^{1/7}}\\\\ \\tau_w&=0.0135\\left(\\frac{\\mu\\rho^{6}U^{13}}{x}\\right)^{1/7}\\\\ c_f&=\\frac{0.027}{Re_x^{1/7}}\\\\ F_D&=C_DA\\rho\\frac{U^{2}}{2}\\\\ C_D&=\\frac{0.031}{Re_L^{1/7}} \\end{align*}Mixed flow boundary layer Partially laminar + partially turbulent Flow starts as laminar and BL transits from laminar to turbulent $x_c$ is the location where BL transits from laminar to turbulent Re_{x_c}=5\\times 10^{5}=\\frac{Ux_c}{ u}\\Rightarrow x_c = 5\\times 10^{5}\\frac{ u}{U} \\begin{align*} F_D&=C_DbL\\rho\\frac{U^{2}}{2}\\\\ C_D&=\\frac{0.031}{Re_L^{1/7}}-\\frac{1440}{\\mathrm{Re}_L} \\end{align*}Flat plate aligned with flow Drag force is caused by skin friction (surface shear stress) No pressure difference outside BL It is called friction drag $C_D$ is small Flat plate normal to flow Drag force is caused by a pressure difference It is called pressure drag $C_D$ is large In most situation, Drag force = friction drag + pressure drag Flow around a blunt body Ideal flow: Thin BL all around the body Narrow sheet of viscous wake in the rear Actual flow: Thin BL on the front, side of the body Pressure decreases along the surface In the rear, pressure starts to ↑increase and velocity decrease BL breaks off Main stream is deflected by the wake (A): $\\mathrm{Re}\\sim1$ Very slow Stokes flow Very small wake region (B): $20 &lt; \\mathrm{Re} &lt; 50000$ Laminar BL Separation Larger wake region (C): $50000 &lt; \\mathrm{Re} &lt; 100000$ Laminar BL Separation at front Huge wake region (D) $\\mathrm{Re}&gt;5\\times10^{5}$ Laminar BL $\\rightarrow$ Turbulent BL Separation at behind Reduced wake region Drag force of a flow around cylinder F_D = C_DA\\rho\\frac{U^{2}}{2} A: Front view area (projected area) Plan form (top view) area $C_D$: drag coefficient from the log - log graph $\\rho$: density $U$: velocity in free stream Lift force Fluid force perpendicular to the fluid motion Large $Re$ Most of the lift comes from surface pressure distribution Some shear stress \\begin{align*} F_L&=C_LA\\rho\\frac{U^{2}}{2}, A = lb\\\\ F_D&=C_DA\\rho\\frac{U^{2}}{2}, A = lb \\end{align*}Flow around an airfoil Pressure distribution generates lift Symmetrical airfoil: No lift unless angle of attack $\\alpha e 0$ Nonsymmetrical airfoil: Lift even with $\\alpha = 0$ In general $\\alpha(&gt; 0)$ increase $\\rightarrow$ lift and drag coefficients increase $\\mathcal{A}$ ($\\mathcal{A} = l/b$, aspect ratio) increase $\\rightarrow$ lift coefficient increase but drag coefficient decrease As the angle of attack increases, $\\Delta P$ between the upper and lower surfaces increases Drag increases the boundary layer on the upper surface separates wide and turbulent wake region Stall: Sudden decrease of $C_L$ Extremely dangerous at low altitude (not sufficient time to recover) Chap9. Compressible FlowCompressible flow: Flows that involve significant changes in density $\\rho(x, y, z)$ must be treated as a variable Mach numbers greater than 0.3 Speed of Sound c = \\sqrt{k\\frac{P}{\\rho}}=\\sqrt{kRT}Mach number M = \\frac{v}{c} $v$: local velocity $c$: local speed of sound $M &lt; 1$: subsonic speed $M = 1$: sonic speed $M &gt; 1$: supersonic speed Mach angle \\sin\\alpha=\\frac{c}{v}\\rightarrow\\alpha = \\sin^{-1}\\frac{c}{v}=\\sin^{-1}\\frac{1}{M} Sound source and sound wave If the sound source is stationary, the sound wave forms as If the sound source is moving at $v_{source} &lt; v_{sound}$, the sound wave forms as If the sound source is moving at $v_{source} = v_{sound}$, the sound wave forms as If the sound source is moving at $v_{source} &gt; v_{sound}$, the sound wave forms as Shock waves Discontinuous wave Observed in supersonic flow Irreversible Internal or external Stationary or moving Normal shock wave / oblique shock wave Normal shock wave: Usually in a duct Perpendicular to the direction of the movement Oblique shock wave: On the leading edge of sharp edged corner On axisymmetric projectiles Steady and uniform plane flow exits before and after this wave Specific-heat ratio k =\\frac{C_p}{C_v}The perfect gas p = \\rho R T R = C_p - C_v = const k = \\frac{C_p}{C_v} = const For real gases, $C_p$, $C_v$ and $k$ vary with temperature but only moderately Adiabatic and Isentropic Steady flow \\frac{p_0}{p}=\\left(\\frac{T_0}{T}\\right)^{k/(k - 1)}=\\left[1+\\frac{1}{2}(k - 1)\\mathrm{Ma}^2\\right]^{k/(k - 1)} \\frac{\\rho_0}{\\rho}=\\left(\\frac{T_0}{T}\\right)^{1/(k - 1)}=\\left[1+\\frac{1}{2}(k - 1)\\mathrm{Ma}^2\\right]^{1/(k - 1)}For $k = 1.4$, the following numerical versions of the isentropic and adiabatic flow formulas are obtained: \\begin{align*} \\frac{T_0}{T}&=1 + 0.2\\mathrm{Ma}^2\\\\ \\frac{\\rho_0}{\\rho}&=(1 + 0.2\\mathrm{Ma}^2)^{2.5}\\\\ \\frac{p_0}{p}&=(1 + 0.2\\mathrm{Ma}^2)^{3.5}\\\\ \\mathrm{Ma}^2&=5\\left(\\frac{T_0}{T}-1\\right)=5\\left[\\left(\\frac{\\rho_0}{\\rho}\\right)^{2/5}-1\\right]=5\\left[\\left(\\frac{p_0}{p}\\right)^{2/7}-1\\right] \\end{align*}Speed of Sound in ductsConsider a duct where the area varies: \\frac{dA}{A}=\\frac{dv}{v}(Ma^2 - 1)"},{"title":"ME Control(EN)","path":"/notes/autocontrol.html","content":"Chap1 IntroductionSec 1.1 Basic Concepts of Control DefinitionAutomatic control refers to the use of additional equipment or devices to make the machine, equipment, or production process automatically operate in accordance with the predetermined rule under a certain working state or parameter without the participation of anyone. An outstanding feature of automatic control systems is that the process of system automatic control is the process of information transmission and transformation. Sec 1.2 Feedback Control System DefinitionIf the output of the system is not brought back to affect the control part of the system, such a system is called an open-loop control system. DefinitionIf the output of the system acts on the control part through the feedback, forming a closed loop, such a system is called a closed-loop control system, also known as a Feedback Control System. Passive Feedback: It mainly acts on the control system through the difference between input and output. Positive Feedback: It boosts the input signal to make the system deviate from its original state. Sec 1.3 Control System Block Diagram A control system consists of the controlled plant and the control device. Several representations in block diagram: Sec 1.4 The Design Requirements Stability: Preconditions for normal operation of the control system. Rapidity: Dynamic performance, with indicators. Accuracy: The steady-state (after the transition) value should be as consistent as possible with the expected value. Chap2 Mathematical Model of Control System DefinitionA mathematical model is an expression that indicates the dynamic relationship between physical quantities (or variables) in a system. Sec 2.1 Differential Equation of Linear SystemLinear systems can apply the superposition principle, i.e., they have superposition and uniformity (homogeneity). General ExpressionThe mathematical equation of the linear system is: a_n \\frac{d^n c(t)}{dt^n} + a_{n-1} \\frac{d^{n-1} c(t)}{dt^{n-1}} + \\cdots + a_1 \\frac{dc(t)}{dt} + a_0 c(t) = b_m \\frac{d^m r(t)}{dt^m} + b_{m-1} \\frac{d^{m-1} r(t)}{dt^{m-1}} + \\cdots + b_1 \\frac{dr(t)}{dt} + b_0 r(t) Sec 2.2 Laplace Transform DefinitionA function $f(t)$ (original) defined in the interval $[0,\\infty]$, its Laplace transform $F(s)$ is defined as \\mathcal{L} [f(t)] = F(s) = \\int_{0}^{\\infty} f(t) e^{-st} dt The table below gives the Laplace Transform of some typical test waveforms: Item $f(t)$ $F(s)$ Impulse response $\\delta(t)$ $1$ Step response $u(t)$ $\\frac{1}{s}$ Ramp response $t u(t)$ $\\frac{1}{s^2}$ Polynomial response $t^n u(t)$ $\\frac{n!}{s^{n+1}}$ Exponential response $e^{-at} u(t)$ $\\frac{1}{s+a}$ Sinusoid response $\\sin \\omega t u(t)$ $\\frac{\\omega}{s^2 + \\omega^2}$ Cosine response $\\cos \\omega t u(t)$ $\\frac{s}{s^2 + \\omega^2}$ Theorem Linear:$L[af_1(t) \\pm bf_2(t)] = aF_1(s) \\pm bF_2(s)$ Differential:$L[f^{(n)}(t)] = s^n \\cdot F(s)$ Integral:$L\\left[\\int \\int f(t) dt\\right] = \\frac{1}{s^n} F(s)$ Real displacement:$L[f(t - \\tau_0)] = e^{-\\tau_0 s} \\cdot F(s)$ Complex displacement:$L[e^{At}f(t)] = F(s - A)$ Initial value:$\\lim_{t \\to 0} f(t) = \\lim_{s \\to \\infty} s \\cdot F(s)$ Terminal value:$\\lim_{t \\to \\infty} f(t) = \\lim_{s \\to 0} s \\cdot F(s)$ DefinitionInverse Laplace Transform: f(t) = \\mathcal{L}^{-1}[F(s)] = \\frac{1}{2\\pi j} \\int_{\\sigma - j\\infty}^{\\sigma + j\\infty} F(s) e^{st} ds Sec 2.3 Transfer Function DefinitionUnder zero initial conditions, the transfer function is the ratio of the Laplace transform of the output to the input: G(s) = \\frac{C(s)}{R(s)} = \\frac{b_m s^m + b_{m-1} s^{m-1} + \\cdots + b_1 s + b_0}{a_n s^n + a_{n-1} s^{n-1} + \\cdots + a_1 s + a_0} Sec 2.3.1 Basic properties The transfer function is a rational and proper fraction of the complex variable. The transfer function does not indicate the system’s physical characteristics or structure. The transfer function is only used for single-input single-output systems. Without zero-pole cancellation, the denominator polynomial is the system’s characteristic polynomial. Sec 2.3.2 Common forms Rational form: G(s) = \\frac{b_m s^m + \\cdots + b_0}{a_n s^n + \\cdots + a_0} Zero-pole form: G(s) = K^* \\frac{(s - z_1)\\cdots(s - z_m)}{(s - p_1)\\cdots(s - p_n)} Time constant form: G(s) = K \\frac{\\prod (\\tau_i s + 1) \\prod (\\tau_k^2 s^2 + 2\\xi_e \\tau_k s + 1)}{\\prod (\\tau_j s + 1) \\prod (T_l^2 s^2 + 2\\xi_e T_l s + 1)} Sec 2.3.3 Typical links Link Differential Equation Transfer Function Proportional $c = Kr$ $K$ First-order inertia $T\\dot{c} + c = r$ $\\frac{1}{Ts + 1}$ Second-order oscillation $T^2\\ddot{c} + 2\\xi T\\dot{c} + c = r$ $\\frac{1}{T^2s^2 + 2\\xi Ts + 1}$ Integral $\\dot{c} = r$ $\\frac{1}{s}$ Ideal differential $c = \\dot{r}$ $s$ Sec 2.4 Block Diagram of a System DefinitionA graphical representation of the signal transmission relationships between system components. The transfer function can be derived from the block diagram. Sec 2.4.1 Equivalent transformation rules Series blocks: Parallel blocks: Feedback connection: Open-loop transfer function: G(s) = G_1(s)G_2(s)H(s)Closed-loop transfer function: \\Phi(s) = \\frac{G(s)}{1 \\mp G_o(s)} For input signal (disturbance = 0): \\Phi(s) = \\frac{C(s)}{R(s)} = \\frac{G_1(s) G_2(s)}{1 + G_1(s) G_2(s) H(s)} For disturbance signal (input = 0): \\Phi_n(s) = \\frac{C(s)}{N(s)} = \\frac{G_2(s)}{1 + G_1(s)G_2(s)H(s)} Total output: C(s) = \\Phi(s)R(s) + \\Phi_n(s)N(s)= \\frac{1}{1 + G_1(s)G_2(s)H(s)} [G_1(s)G_2(s)R(s) + G_2(s)N(s)] \\textbf{when} $|G(s)H(s)| \\gg 1$ \\Phi(s) = \\approx \\frac{C(s)}{R(s)} = \\frac{G(s)}{1 \\mp G(s)H(s)} \\approx \\frac{1}{\\mp H(s)} When $H(s) = 1$ \\Phi(s) = \\frac{C(s)}{R(s)} = \\frac{G(s)}{1 \\mp G(s)H(s)} = \\frac{G(s)}{1 \\mp G(s)} When $H(s) = 1$, it is called unit feedback Sec 2.4.2 Equivalent Transformation Rules Signal lead backward: Signal lead forward: Comparison backward: Comparison forward: Chap3 Time Domain AnalysisSec3.1 Time response performanceThe time response of the system consists of two parts: transient process and steady-state process. Sec3.1.1 Transient performance index delay time $t_d$ rise time $t_r$ peak time $t_p$ settling time $t_s$ percent overshoot $\\sigma_p\\%$ Sec3.1.2 Steady-state indexThe steady-state index is an index that measures the accuracy of the control system and is characterized by the steady-state error. Sec3.2 Time domain analysis of first order system Transfer function of first order system: G(s) = \\frac{1}{Ts+1}Unit step response of the system: h(t)=(1 - e^{-t/T})\\quad (t\\geq0) delay time $t_d$: $0.69T$ rise time $t_r$: $2.2T$ peak time $t_p$: N/A settling time $t_s$: 3T ($\\pm5\\%$) percent overshoot $\\sigma_p\\%$: N/A The output response of the first order system to the input $r(t)$ $R(s)$ $C(s)$ $c(t)$ $\\delta(t)$ $1$ $\\frac{1}{Ts + 1}$ $\\frac{1}{T}e^{-t/T}$ $1(t)$ $\\frac{1}{s}$ $\\frac{1}{Ts + 1}\\cdot\\frac{1}{s}$ $1 - e^{-t/T}$ $t$ $\\frac{1}{s^2}$ $\\frac{1}{Ts + 1}\\cdot\\frac{1}{s^2}=\\frac{1}{s^2}-T\\left[\\frac{1}{s}-\\frac{1}{s + \\frac{1}{T}}\\right]$ $t - T(1 - e^{-t/T})$ Sec3.3 Time domain analysis of second-order systemTransfer function of second order system: \\frac{C(s)}{R(S)} = \\frac{\\omega_n^2}{s^2+2\\zeta\\omega_ns+\\omega_n^2} \\quad T = \\frac{1}{\\omega_n} $T$ is the time constant $ω_n$ is the natural frequency $ζ$ is the damping ratio Open loop transfer function: Sec3.3.1 Characteristic equation of second-order systemscharacteristic equation: s^2 +2\\zeta\\omega_ns+\\omega_n^2=0 Sec3.3.2 Step response of second-order systems We mainly analyze the under-damped system ($0&lt;\\zeta&lt;1$) c(t) = 1 - \\frac{e^{-\\zeta \\omega_n t}}{\\sqrt{1 - \\zeta^2}} \\sin(\\omega_d t + \\beta) \\omega_d = \\sqrt{1 - \\zeta^2} \\omega_n \\quad \\cos \\beta = \\zetaSec3.3.3 Transient response index of second-order system rise time: $t_r = \\frac{\\pi - \\beta}{\\omega_d} = \\frac{\\pi - \\beta}{\\omega_n \\sqrt{1 - \\zeta^2}}, \\cos \\beta = \\zeta$ peak time: $t_p = \\frac{\\pi}{\\sqrt{1 - \\zeta^2} \\omega_n}$ settling time: $t_s \\approx \\frac{3.5}{\\zeta \\omega_n}, \\Delta = 0.05$ percent overshoot: $\\sigma \\% = e^{-\\zeta \\pi / \\sqrt{1 - \\zeta^2}} \\times 100\\%$ Sec3.4 Measures to improve system performance The response of a first-order system is uniquely related to the time constant T. If you want to improve the performance of the first-order system response, just change the constant T. The performance of the second-order system is closely related to the damping ratio. To improve the response characteristics of the second-order system, generally change the damping ratio of the system Sec3.4.1 Proportional-derivative control of second-order systems Gain: K = \\frac{\\omega_n^2}{2\\zeta \\omega_n} = \\frac{\\omega_n}{2\\zeta}Transfer function: \\Phi(s) = \\frac{C(s)}{R(s)} = \\frac{\\omega_n^2 (T_d s + 1)}{s(s + 2\\zeta \\omega_n) + \\omega_n^2 (T_d s + 1)} = \\frac{\\omega_n^2 (T_d s + 1)}{s^2 + (2\\zeta \\omega_n + \\omega_n^2 T_d)s + \\omega_n^2} \\zeta_d = \\zeta + \\frac{1}{2} \\omega_n T_d Proportional-derivative control has the following characteristics Proportional differential control is introduced to increase the system damping ratio, thereby suppressing oscillation, weakening overshoot, and improving system stability Introducing the differential control of the error signal, the closed-loop transfer function of the system will have a zero point. Therefore, if the differential time constant is appropriately selected so that the system is over-damped, the response will be significantly improved without overshoot Sec3.4.2 Closed loop system with speed feedback Transfer function: \\frac{C(s)}{R(s)} = \\frac{\\omega_n^2}{s(s + 2\\zeta \\omega_n) + \\omega_n^2 K_t s + \\omega_n^2} = \\frac{\\omega_n^2}{s^2 + (2\\zeta \\omega_n + \\omega_n^2 K_t)s + \\omega_n^2} \\zeta_t = \\zeta + \\frac{1}{2} \\omega_n K_t After using speed feedback, the system performance is improved as follows: Speed feedback increases damping, reduces oscillation and overshoot, and improves system stability The closed-loop transfer function of speed negative feedback control has no zero points, so the relationship between the stability of its output response and the feedback coefficient $K$ is simple and easy to adjust The addition reduce the open-loop amplificationcoefficient of the system and increase the steady-state error of the system when following the slope input. And the feedbackcoefficient $K_t$ should be appropriately selected to make the damping ratio more appropriate Sec3.4.3 Comparison of proportional-derivative control and tachometer feedback control The damping effect of proportional-derivative control is generated from the speed of the error signal at the input end of the system, while the damping effect of tachometer feedback control is derived from the speed of the system output end response. Therefore, for a given open-loop gain and command input speed, the latter Corresponds to a larger steady-state error value Proportional-derivative control has a significant amplification effect on noise. The speed measurement feedback control has a filtering effect on the noise at the input end of the system. Proportional-derivative control has no effect on the open-loop gain and natural frequency of the system; although speed measurement feedback control does not affect the natural frequency, it will reduce the open-loop gain. Proportional-derivative control is equivalent to adding a real zero point to the system, which can speed up the rise time. Under the same damping ratio, the overshoot of the proportional-derivative control system will be greater than the overshoot of the tachometer feedback control system. Sec3.4.4 The influence of the third pole and zero point on the response of the second order system The effect of additional zeros on the response of second-order system: Adding a closed-loop zero point will advance the peak time of the system and increase overshoot. The closer it is to the imaginary axis, the stronger this effect will be The effect of the third pole on the response of the second order system Adding closed-loop poles will delay the peak time of the system and reduce overshoot. The closer it is to the demand axis, the stronger this effect will be Sec3.4.5 Unit step response of higher order system Dominant poles and equivalent second order system If there is a real pole or a pair of conjugate complex poles near the virtual axis, and there is no zero point nearby, the other poles are ignored because they are far away from the virtual axis or are dipoles This or this pair of poles is called the closed - loop dominant pole of the higher - order system, which determines the main characteristics of the system transition process Sec3.5 Stability analysis Definition If the output of the linear control system deviates from the original equilibrium state under the influence of the initial disturbance, and its dynamic process gradually attenuates over time and tends to the original equilibrium state point after the disturbance is eliminated, the system is said to be asymptotically stable (stability for short). Sec3.5.1 Sufficient and necessary conditions for system stabilityAll roots of the characteristic equation of the closed-loop system have negative real parts D(s) = a_n s^n + a_{n-1} s^{n-1} + \\dots + a_1 s + a_0, a_n > 0Necessary: a_i > 0, i = 0, 1, 2, \\dots, n - 1 Sec3.5.2 Routh stability criterion First column elements are all larger than 0 $\\rightarrow$ System is stable Otherwise the system is not stable The number of change of sign in the first column $\\rightarrow$ The number of the positive real root Case 1: If the first element of any row in the table is 0 and all subsequent elements are not 0: Ex: The characteristic equation of the system is $s^4 + 2s^3 + s^2 + 2s + 2 = 0$. Determine the stability of the system according to Routh stability criterion. \\begin{array}{c|ccc} s^4 & 1 & 1 & 2 \\\\ s^3 & 2 & 2 & \\\\ s^2 & \\frac{2 \\times 1 - 1 \\times 2}{2} = 0(\\varepsilon) & \\frac{2 \\times 2}{2} = 2 & \\\\ s^1 & \\frac{\\varepsilon \\times 2 - 2 \\times 2}{\\varepsilon} = 2 - \\frac{4}{\\varepsilon} = -\\infty & & \\\\ s^0 & 2 & & \\\\ \\end{array}replace the 0 in the first column with a small positive number Case 2: If all the elements in a row in a table are 0: Ex:The characteristic equation of the system is $s^6 + 2s^5 + 6s^4 + 8s^3 + 10s^2 + 4s + 4 = 0$. Determine the stability of the system according to Routh stability criterion \\begin{array}{c|ccc} s^6 & 1 & 6 & 10 & 4 \\\\ s^5 & 2 & 8 & 4 \\\\ s^4 & 2 & 8 & 4 \\\\ s^3 & 0 & 0 & 0 \\\\ s^3 & 8 & 16 & 0 \\\\ s^2 & 4 & 4 \\\\ s^1 & 8 \\\\ s^0 & 4 \\\\ \\end{array} For the row of $s^4$, we should construct the auxiliary polynomial: A(s) = 2s^4+8s^2+4 \\frac{dA(s)}{ds} = 8s^3+16sSo the coefficients of the row of $s^3$ is $8 \\quad 16 \\quad 0$ And we can get the roots from the auxiliary polynomial: Set $s^2 = y$， A(s) = 2s^4 + 8s^2 + 4 = 2(y^2 + 4y + 2) = 0y = -2 \\pm \\sqrt{2} = -0.586, -3.414s_{1,2} = \\pm j\\sqrt{0.586} = \\pm j0.766s_{3,4} = \\pm j\\sqrt{3.414} = \\pm j1.848 The system is critically stable. Sec3.5.3 Steady state error analysis for linear systems Steady-state error: The difference between the expected value of the steady-state response and the actual value Steady-state error calculation If the poles of $sE(s)$ are located in the left half plane of s (including the origin), the steady-state error of the system can be obtained by the Laplace transform end value theorem: \\lim_{t \\to \\infty} f(t) = \\lim_{s \\to 0} s \\cdot F(s) \\phi_e(s) = \\frac{E(s)}{R(s)} = \\frac{1}{1 + G(s)H(s)} e_{ss} = \\lim_{t \\to \\infty} e(t) = \\lim_{s \\to 0} s \\cdot E(s) = \\lim_{s \\to 0} \\frac{sR(s)}{1 + G(s)H(s)} If the application condition of the final value theorem is not met, the final value theorem will lead to the wrong conclusion For a system like: The open loop transfer function: G(s) = G_1(s)H(s) = \\frac{K(\\tau_1 s + 1)\\cdots(\\tau_m s + 1)}{s^{ u}(T_1 s + 1)\\cdots(T_n s + 1)} = \\frac{K}{s^{ u}}G_0(s) G_0(s) = \\frac{(\\tau_1 s + 1)\\cdots(\\tau_m s + 1)}{(T_1 s + 1)\\cdots(T_n s + 1)} \\quad \\lim_{s \\to 0} G_0(s) = 1K: \\text{gain}ν: \\text{system type} Ex Open loop transfer function G(s) = \\frac{K_1(Ts + 1)}{s^2(s + a)} K = \\frac{K_1}{a}, u = 2Closed loop transfer function \\Phi(s) = \\frac{\\frac{K_1}{s^2(s + a)}}{1 + \\frac{K_1(Ts + 1)}{s^2(s + a)}} = \\frac{K_1}{s^2(s + a) + K_1(Ts + 1)}Characteristic equation: D(s) = s^2(s + a) + K_1(Ts + 1) = s^3 + as^2 + K_1Ts + K_1Routh table \\begin{array}{c|cc} s^3 & 1 & K_1 T \\\\ s^2 & a & K_1 \\quad a > 0 \\\\ s^1 & \\frac{(aT - 1)K_1}{a} \\quad aT > 0 & \\\\ s^0 & K_1 \\quad K_1 > 0 & \\\\ \\end{array}r(t) = 2t + 4t^2r_1(t) = 2t \\Rightarrow e_{ss1} = 0r_2(t) = 4t^2 = 8\\frac{t^2}{2} \\Rightarrow e_{ss2} = \\frac{A}{K} = \\frac{8a}{K_1}e_{ss} = e_{ss1} + e_{ss2} = \\frac{8a}{K_1}The superposition of the system Calculation of steady-state error under disturbance \\Phi_{en} = \\frac{E(s)}{N(s)} = \\frac{-G_2(s)H(s)}{1 + G_1(s)G_2(s)H(s)}Final value theorem e_{ssn} = \\lim_{s \\to 0} s \\cdot \\Phi_{en}(s) \\cdot N(s)= \\lim_{s \\to 0} s \\cdot \\frac{-G_2(s)H(s)}{1 + G_1(s)G_2(s)H(s)} \\cdot N(s)Sec 3.5.4 Methods for reducing and eliminating steady-state errors Increase the magnification of the controller (the premise is that the system must be stable) Improve the system type, especially introduce the integral link before the disturbance point Chap4 Root Locus TechniquesRoot locus: The root locus refers to a locus in which an open - loop system parameter changes from 0 to $\\infty$ and the closed - loop characteristic root moves on the s - plane. The root locus is closely related to system performance. Root locus equation characteristic equation of closed - loop system: 1 + G(s)H(s) = 0 \\quad \\Rightarrow \\quad G(s)H(s) = -1root locus equation: G(s)H(s) = K^* \\frac{\\prod_{i = 1}^{m}(s - z_i)}{\\prod_{j = 1}^{n}(s - p_j)} = -1magnitude criterion: |G(s)H(s)| = 1angle criterion: \\angle [G(s)H(s)]=(2k + 1)\\pi \\quad k = 0, \\pm1, \\pm2 \\cdotsSec4.1 Sketching the root locus Starting and ending points: The root locus begins at the finite and infinite poles of $G(s)H(s)$ and ends at the finite and infinite zeros of $G(s)H(s)$. The root locus starts at the pole of the open-loop transfer function, and end at the zero of the open-loop transfer function. There are $m$ locus approaching zero, and $n - m$ locus approaching infinity Number of branches, symmetry and continuity: The number of branches of the root locus is equal to the order of the characteristic equation and the number of open-loop poles ($n&gt;m$); the root locus changes continuously and is symmetrical to the real axis Real-axis segments: For a certain area on the real-axis, if the sum of the number of open-loop poles and the number of open-loop zeros on the right side is equal to an odd number, the area is the root locus. Asymptote of root locus: When $n&gt;m$, and when $K^*$ approaches infinity, there are $n - m$ locus extending to infinity, and the root locus approaches the asymptote at infinity. The crossings of the asymptote with the real axis is: \\sigma_a = \\frac{\\sum_{i = 1}^{n} p_i - \\sum_{j = 1}^{m} z_j}{n - m}$P_j$ is the pole of the open - loop transfer function $z_i$ is the zero point of the open - loop transfer function The crossing angle of the asymptote with the positive real - axis is: \\varphi_a = \\frac{(2k + 1)\\pi}{n - m}, k = 0, \\pm1, \\pm2, \\cdots, n - m - 1 Breakaway and break-in Points: When $K^*$ tends to change to infinity, several root locus separate immediately after meeting at a certain point in the s - plane. This point is called the breakaway point. The breakaway or break-in points can be calculated by: \\sum_{i = 1}^{n} \\frac{1}{d - p_i} = \\sum_{j = 1}^{m} \\frac{1}{d - z_j}\\sum_{i = 1}^{n} \\frac{1}{d - p_i} = 0 \\ (No \\ open - loop \\ zero)$p_i$ is the pole of the open - loop transfer function $z_j$ is the zero of the open - loop transfer function The $jω$ -Axis Crossings: There are pure imaginary roots in the closed - loop characteristic equation, and the system is in critical stability. Substituting $s = j\\omega$ into the characteristic equation 1 + G(j\\omega)H(j\\omega) = 0Make \\mathrm{Re}[1 + G(j\\omega)H(j\\omega)] = 0 \\mathrm{Im}[1 + G(j\\omega)H(j\\omega)] = 0 Angles of Departure and Arrival: The angle between the tangent to the root locus at the open-loop complex pole and the positive real axis is called the Departure angle; The angle between the tangent to the root locus at the open-loop complex zero point and the positive real axis is called the Arrival angle. Calculation formula of departure angle: \\theta_{p_k} = (2k + 1)\\pi + \\sum_{j = 1}^{m} \\angle (p_k - z_j) - \\sum_{\\substack{i = 1 \\\\ eq k}}^{n} \\angle (p_k - p_i)Calculation formula of arrival angle: \\theta_{z_k} = (2k + 1)\\pi - \\sum_{\\substack{j = 1 \\\\ eq k}}^{m} \\angle (z_k - z_j) + \\sum_{i = 1}^{n} \\angle (z_k - p_i) Sum of roots: When the order difference $n-m$ between the numerator and denominator of the open-loop transfer function $G(s)H(s)$ of the system is greater than or equal to 2, the sum of the closed-loop poles of the system is equal to the sum of the open-loop poles of the system. \\sum_{i = 1}^{n} p_i = \\sum_{i = 1}^{n} \\lambda_i Sec4.2 Root locus analysis Analysis of root locus system with stable condition: Only when the parameter is within a certain range can the system be stable Transient performance analysis Second-order system dynamic performance analysisRise Time: t_r = \\frac{\\pi - \\beta}{\\omega_n\\sqrt{1 - \\zeta^2}}, \\beta = \\arccos\\zetaPeak time: t_p = \\frac{\\pi}{\\omega_n\\sqrt{1 - \\zeta^2}}Settling time: t_s \\approx \\frac{3.5}{\\zeta\\omega_n}, \\Delta = 0.05Overshoot : \\sigma_p\\% = e^{-\\pi\\zeta/\\sqrt{1 - \\zeta^2}} \\times 100\\%System unit step response: h(t) = 1 - \\frac{e^{-\\zeta\\omega_n t}}{\\sqrt{1 - \\zeta^2}}(\\sqrt{1 - \\zeta^2}\\cos\\omega_d t + \\zeta\\sin\\omega_d t) Example: The open - loop transfer function is: G(s)H(s) = \\frac{K^*}{s(s^2 + 6s + 10)} = \\frac{K^*}{s(s + 3 - j)(s + 3 + j)}Try to use the root locus method to determine: the root locus gain value, equivalent second - order system and its transition process performance criteria, when the closed - loop dominant pole has a damping ratio = 0.5 ANS: poles and zeros $p_1 = 0, p_2 = -3 + j, p_3 = -3 - j$ root locus on the real axis asymptote $\\sigma_a = \\frac{\\sum_{i = 1}^{n} p_i - \\sum_{j = 1}^{m} z_j}{n - m} = -2$ breakaway point: $\\sum_{i = 1}^{n} \\frac{1}{d - p_i} = 0 \\quad d = -1.18, -2.82$ departure angle: \\begin{align*} \\theta_{p_k}&=\\pi - \\sum_{\\substack{i = 1 \\\\ eq k}}^{n} \\angle (p_k - p_i)\\\\ &=180 - 90 - (180 - 18.4)= -71.6 \\end{align*} crossings of root locus and imaginary axis 1 + G(j\\omega)H(j\\omega) = 0 \\quad s(s^2 + 6s + 10)+K^* = 0 K^* = 6 \\quad \\omega = \\pm\\sqrt{10}=\\pm3.16 The image of the root locus: Find the closed - loop pole and root locus gain values when the damping ratio is 0.5 \\beta=\\cos^{-1}\\zeta = 60^{\\circ}Make a straight line with an angle of 60 degrees to the negative real axis through the origin and intersect with the root locus at points s_{1,2}=-0.84\\pm j1.455The third pole is \\begin{align*} s_3&=p_1 + p_2 + p_3 - s_1 - s_2\\\\ &=0 - 3 + j1 - 3 - j1 + 0.84 + j1.455 + 0.8 - j1.455\\\\ &=-4.32 \\end{align*}According to the magnitude criterion: |G(s)H(s)| = K^* \\frac{\\prod_{i = 1}^{m}|(s - z_i)|}{\\prod_{j = 1}^{n}|(s - p_j)|}=1 \\begin{align*} K^*&=\\prod_{j = 1}^{n}|(s - p_j)|\\\\ &= |-0.84 + j1.455||-0.84 + j1.455 + 3 - j1||-0.84 + j1.455 + 3 + j1|\\\\ &= 12.13 \\end{align*}Finding equivalent second - order systems and transition process indicators \\begin{align*} \\phi(s)&=\\frac{K^*}{(s - s_1)(s - s_2)(s - s_3)}\\\\ &=\\frac{12.13}{(s + 0.84 - j1.455)(s + 0.84 + j1.455)(s + 4.32)}\\\\ &=\\frac{12.13/4.32}{(s + 0.84 - j1.455)(s + 0.84 + j1.455)(\\frac{1}{4.32}s + 1)}\\\\ &\\approx\\frac{2.82}{s^2 + 1.68s + 2.82} \\end{align*} \\omega_n=\\sqrt{2.82}=1.68, \\zeta = 1.68/2\\omega_n = 0.5System transition process indicators \\sigma_p\\%=e^{-\\pi\\zeta/\\sqrt{1 - \\zeta^2}}\\times100\\% = 16.3\\% t_s=\\frac{3.5}{\\zeta\\omega_n}=4.17(s)Chap5 Frequency Response TechniquesFrequency response: the regularity of the amplitude and phase angle of the steady-state sinusoidal response of a linear system as it changes with the input frequency If the input signal of the system is a sine function, the steady state component of the system output is also a sine function of the same frequency , and its amplitude is amplified by $|G(j\\omega)|$ times , Phase shifted by $\\phi(\\omega) = \\angle G(j\\omega)$ . The complex number $G(j\\omega)$ is called the frequency characteristic of the system. The amplitude ratio $|G(j\\omega)|$ of the output to the input is called the system amplitude-frequency characteristic. The phase difference $\\phi(\\omega)$ between the output and input is called the system phase-frequency characteristic. Sec5.1 Geometrical representation of frequency characteristics amplitude-frequency and phase-frequency characteristic amplitude-phase curve (Nyquist diagram) logarithmic frequency characteristic (Bode diagram) logarithmic amplitude-phase curve (Nichols diagram) Sec5.2 Frequency characteristics of typical elements Proportional element Frequency characteristics: \\begin{cases} |G| = K \\\\ \\angle G = 0 \\end{cases}logarithmic frequency characteristic \\begin{cases} L(\\omega) = 20\\lg K \\\\ \\phi (\\omega) = 0 \\end{cases} Differential element Frequency characteristics: \\begin{cases} |G| = \\omega \\\\ \\angle G = 90^\\circ \\end{cases}logarithmic frequency characteristic \\begin{cases} L(\\omega) = 20\\lg \\omega \\\\ \\phi (\\omega) = 90^\\circ \\end{cases} Integral element Frequency characteristics: \\begin{cases} |G| = \\frac{1}{\\omega} \\\\ \\angle G = -90^\\circ \\end{cases}logarithmic frequency characteristic: \\begin{cases} L(\\omega) = -20\\lg \\omega \\\\ \\phi (\\omega) = -90^\\circ \\end{cases} inertial element Frequency characteristics: \\begin{cases} |G| = \\frac{1}{\\sqrt{1+\\omega^2 T^2}} \\\\ \\angle G = -\\arctan \\omega T \\end{cases}logarithmic frequency characteristic \\begin{cases} L(\\omega) = -20\\lg \\sqrt{1+\\omega^2 T^2} \\\\ \\phi (\\omega) = -\\arctan \\omega T \\end{cases} First order differential element Frequency characteristics: \\begin{cases} |G| = \\sqrt{1+\\omega^2 T^2} \\\\ \\angle G = \\arctan \\omega T \\end{cases}logarithmic frequency characteristic \\begin{cases} L(\\omega) = 20\\lg \\sqrt{1+\\omega^2 T^2} \\\\ \\phi (\\omega) = \\arctan \\omega T \\end{cases} Oscillation element Frequency characteristics: \\begin{cases} |G|=\\frac{1}{\\sqrt{\\left(1 - \\frac{\\omega^2}{\\omega_n^2}\\right)^2+\\left(2\\zeta\\frac{\\omega}{\\omega_n}\\right)^2}}\\\\ \\angle G = 0-\\arctan\\frac{2\\zeta\\frac{\\omega}{\\omega_n}}{1 - \\frac{\\omega^2}{\\omega_n^2}} \\end{cases}logarithmic frequency characteristic: \\begin{cases} L(\\omega)=-20\\lg\\sqrt{\\left(1 - \\frac{\\omega^2}{\\omega_n^2}\\right)^2+\\left(2\\zeta\\frac{\\omega}{\\omega_n}\\right)^2} \\\\ \\phi (\\omega)=\\arctan\\frac{2\\zeta\\frac{\\omega}{\\omega_n}}{1 - \\frac{\\omega^2}{\\omega_n^2}} \\end{cases} Resonance frequency and resonance peak \\begin{align*} \\omega_r&=\\omega_n\\sqrt{1 - 2\\zeta^2},(0 < \\zeta < 0.707)\\\\ M_r&=\\frac{1}{2\\zeta\\sqrt{1 - \\zeta^2}} \\end{align*} Sec5.3 Plot open loop frequency characteristicsSec5.3.1 amplitude-phase curve (Nyquist diagram) of open loop systemSteps: The starting point of the open-loop amplitude-phasecurve ($\\omega =0$) The end point of the open-loop amplitude-phasecharacteristic curve ($\\omega = \\infty$) The changing trend of open-loop frequencycharacteristics when $\\omega$ changes from $0$ to $\\infty$ Ex G(s)=\\frac{K}{s^{ u}(T_1s + 1)(T_2s + 1)}=\\frac{K/(T_1T_2)}{s^{ u}(s + 1/T_1)(s + 1/T_2)} \\begin{align*} G(j0)&=\\begin{cases} K\\angle0^{\\circ},& u = 0\\\\ \\infty\\angle - 90^{\\circ} u,& u>0 \\end{cases}\\\\ G(j\\infty)&=0\\angle - 90^{\\circ}(n - m) \\end{align*} Sec5.3.2 logarithmic frequency characteristic (Bode diagram) of open loop system According to the decomposition of typical elements, the typical elements that make up the system are divided into three parts: Typical element type Transfer function Crossover frequency Frequency change $\\frac{K}{s^{ u}}$ $\\frac{K}{s^{ u}}$ -20$ u$dB/dec First - order element $\\frac{1}{Ts + 1}$ $\\frac{1}{T}$ -20dB/dec First - order element $Ts + 1$ $\\frac{1}{T}$ 20dB/dec Second - order element $\\frac{1}{(\\frac{s}{\\omega_n})^2 + 2\\zeta\\frac{s}{\\omega_n}+1}$ $\\omega_n$ -40dB/dec Steps: The open-loop transfer function is decomposed according to typical elements and arranged into a time constant form. (Integral element, inertial element, first-order differential element, second-order element) Determine the first-order and second-order corner frequencies, and mark each corner frequency on a logarithmic graph. Plot the low frequency curve In the low frequency band (corresponding to the leftmost end of the open-loop frequency characteristic curve) the approximate formula of the system open-loop frequency characteristic is $L(\\omega) = 20 \\log K - 20 u\\log \\omega$, where $ u$ is the number of integration links. The slope of the leftmost straight line of the approximate logarithmic amplitude-frequency curve is -20 $ u$ dB/dec. At $\\omega = 1$, the decibel value of the leftmost straight line (the extension of the leftmost straight line when there is a crossover frequency in the frequency range of $\\omega &lt; 1$) is equal to the decibel value of the proportional link $20\\lg K$; the leftmost straight line or its extension is the same as 0dB. The intersection frequency of the lines (when $L(\\omega)=0$) is numerically equal to $K^{\\frac{1}{ u}}$. Plot the characteristic curve of intermediate frequency and high frequency part At the handover frequency, the slope changes, and the change pattern depends on the corresponding typical links. If the typical link is an inertia link or an oscillation link, after the handover frequency, the slope must be reduced by 20 dB/dec or 40 dB/dec. If the typical link is a first-order differential link or a second-order differential link, after the handover frequency, the slope must be Add 20dB/dec or 40dB/dec. Sec5.4 Frequency domain stability criterionSec5.4.1 Nyquist stability criterion Z = P-2N $Z$: The number of closed-loop poles in the right half s-plane $P$: The number of open-loop poles in the right half s-plane $N$: The number of counterclockwise circles surrounding $(-1, \\, j0)$ point The smallest unit of $N$ is $\\frac{1}{2}$ When there is an open-loop pole on the imaginary axis of the $[s]$ plane, the Nyquist path should be an infinitesimal circle from the right; the corresponding large arc of the $[G]$ plane should be supplemented. Sec5.4.2 Logarithmic stability criterion \\begin{cases} Z =P-2N\\\\ N=N_+-N_- \\end{cases} It is stipulated that within the range of $L(\\omega)&gt;0,$ the curve $\\phi(\\omega)$ crossing the $-\\pi$ line from bottom to top is a positive crossing. It is stipulated that within the range of $L(\\omega)&gt;0,$ the curve $\\phi(\\omega)$ crossing the $-\\pi$ line from top to bottom is a negative crossing. For the case where there is an open-loop pole at the origin of the s-plane, when $\\omega$ changes from $0$ to $0_+$, the phase-frequency characteristic curve $\\phi(\\omega)$ should be where $\\omega$ tends to 0, and $ u \\pi/2$ is drawn from top to bottom. When calculating the number of positive and negative crossings, the curve of the complementary surface should be regarded as part of the logarithmic phase-frequency curve. Sec5.5 Stability margin phase margin The angular frequency that corresponds to the amplitude $|GH(j\\omega_c)| = 1$ in frequency characteristics is called the sheared frequency (or cut-off frequency). At the sheared frequency, the amount of phase angle delay required to make the system reach a stable critical state is called the phase margin, expressed as $\\gamma$. \\gamma = 180^\\circ + \\angle GH(j\\omega_c) magnitude margin The angular rate corresponding to the phase angle $\\phi(\\omega)=-\\pi$ radians in frequency characteristics is called the phase angle boundary frequency $\\omega_g$, and the amplitude margin is expressed in $K_g$. On the Bode diagram, the amplitude margin is expressed in decibels $h$. K_g(\\text{dB}) = -20\\lg|GH(j\\omega_g)| h = \\frac{1}{|GH(j\\omega_g)|} Physical meaning angle margin: if the phase angle of a stable system lags behind another $\\gamma$ angle at the cutoff frequency $\\omega_c$, the system is in a critical stable state; if the phase angle lag is greater than $\\gamma$, the system will become unstable. magnitude margin: if the open-loop gain of the stable system is increased by $h$ times, then the amplitude $A(\\omega_g)$ at $\\omega_g$ is equal to 1, the curve just passes through the point $(-1, \\,j0)$, and the system is in a critical stable state ; If the open-loop gain increases by more than $h$ times, the system will become unstable. For stability in engineering, it is required: \\gamma > 30^\\circ \\, (40^\\circ \\sim 60^\\circ) h > 6\\text{dB}\\,(10 \\sim 20 \\, \\text{dB}) Sec5.6 Approximate estimation of system indicators Sec5.6.1 The relationship between $L(\\omega)$ low-frequency asymptote and system steady-state error \\begin{align*} G_L(s)&=\\frac{K}{s^{ u}}\\\\ 20\\log|G_L(j\\omega)|&=20\\log\\frac{K}{\\omega^{ u}}\\\\ \\angle G_L(j\\omega)&=- u\\times90^{\\circ} \\end{align*} Ex: The Bode diagram of a known close loop system is shown in the following Figure, Find the steady - state error value of the system when the input signal is r(t)=(100 + 10t)\\times1(t) Because the slope of the low frequency straight line is -20dB/dec,so the system is 1 type system Then $K_p = \\infty$ \\begin{align*} &\\because\\frac{0 - L(3)}{\\log40/3-\\log3}=-20\\quad\\therefore L(3)=20\\log40/9\\\\ &\\because\\frac{20\\log40/9 - L(2)}{\\log3-\\log2}=-40\\quad\\therefore L(2)=20\\log10\\\\ &\\because 20\\log K_{ u}/2 = 20\\log10\\quad\\therefore K_{ u}=20\\\\ &\\therefore e_{ss}=\\frac{100}{1 + K_p}+\\frac{10}{K_{ u}}=\\frac{100}{1+\\infty}+\\frac{10}{20}=0.5 \\end{align*} Sec5.6.2 The relationship between $L(\\omega)$ mid-frequency band characteristics and system dynamic performanceIf the slope of the mid - frequency band of the $L(\\omega)$ curve is -20dB/dec and occupies a wide frequency range, the phase angle margin $\\gamma$ will be large (close to $90^{\\circ}$), and the overshoot of the system will be small. Therefore, in order to ensure that the system has satisfactory dynamic performance, it is expected that $L(\\omega)$ crosses the 0dB line with a slope of -20dB/dec and maintains a wide mid - frequency range. First-order system The larger $\\omega_c$, the shorter the setting time. \\begin{align*} \\omega_c&=1/T\\\\ t_s&\\approx3T = 3/\\omega_c \\end{align*} Second-order system \\begin{align*} \\sigma\\%&=e^{-\\zeta\\pi/\\sqrt{1 - \\zeta^2}}\\times100\\%\\\\ \\gamma&=\\arctan\\frac{2\\zeta}{\\sqrt{\\sqrt{4\\zeta^4 + 1}- 2\\zeta^2}} \\end{align*}In order to prevent the transient process of the second-order system from oscillating too much and the adjustment time being too long, it is generally desirable that $30^\\circ\\le \\gamma \\le70^\\circ$. Sec5.6.3 The relationship between $L(\\omega)$ high-frequency band characteristics and the system to suppress noiseIn the high frequency band, the closed-loop amplitude-frequency characteristics are approximately equal to the open-loop amplitude-frequency characteristics. The lower the decibel value in the high-frequency band, the greater the attenuation effect of the system on high-frequency signals, that is, the stronger the system’s ability to resist high-frequency interference. Sec5.6.4 Three-band theory If the system has no steady-state error under step or ramp action, the low frequency band of the $L(\\omega)$ characteristic should have a slope of -20dB/dec or -40dB/dec. In order to ensure the steady-state accuracy of the system, the low-frequency band should have a higher decibel value. The $L(\\omega)$ characteristic should cross the zero-dB line with a slope of -20dB/dec and have a certain mid-frequency band width so that the system has sufficient stability margin to ensure that the closed-loop system has better stability. The $L(\\omega) $characteristic should have a higher cutoff frequency $\\omega_c$ to improve the rapidity of the closed-loop system. The high frequency band of the $L(\\omega)$ characteristic should be as low as possible to enhance the system’s ability to resist high-frequency interference. Chap6 CompensationCompensation: Use appropriate methods to add some devices (calibration devices) with adjustable structures and parameters to the system to improve system performance and make the system meet the index requirements. Sec6.1 System Design and Compensation Performance criterion of control system Relationship between frequency-domain and time-domain index of second-order open-loop systems Terms Formula Cut - off frequency $\\omega_c=\\omega_n\\sqrt{1 + 4\\zeta^4-2\\zeta^2}$ Phase margin $\\gamma=\\arctan\\frac{2\\zeta}{\\sqrt{\\sqrt{1 + 4\\zeta^4-2\\zeta^2}}}$ Overshoot $\\sigma\\%=e^{\\frac{-\\pi\\zeta}{\\sqrt{1 - \\zeta^2}}}\\times100\\%$ Settling time $t_s=\\frac{3.5}{\\zeta\\omega_n}$ The influence of the shape of the Bode diagramon the system performance criterion Sec6.2 Lead CompensationThe main feature of the correction is to provide a positive phase, so it is called Lead Compensation. \\begin{align*} G_c(s)&=\\frac{aTs + 1}{Ts + 1}\\quad a>1\\\\ L(\\omega)&=20\\lg\\sqrt{(aT\\omega)^2 + 1}-20\\lg\\sqrt{(T\\omega)^2 + 1}\\\\ \\phi_c(\\omega)&=\\arctan(aT\\omega)-\\arctan(T\\omega)\\\\ &=\\arctan\\frac{aT\\omega - T\\omega}{1 + aT^2\\omega^2} \\end{align*}Maximum leading phase angle \\begin{align*} \\phi_m&=\\arctan\\frac{a - 1}{2\\sqrt{a}}=\\arcsin\\frac{a - 1}{a + 1}\\\\ a&=\\frac{1+\\sin\\phi_m}{1 - \\sin\\phi_m}\\\\ \\omega_m&=\\frac{1}{T\\sqrt{a}} \\end{align*} This compensation mainly corrects the intermediate frequency - band of the original system, so that the slope of the intermediate frequency-band amplitude after compensation is -20dB/dec, and there is a sufficient phase margin. Keep the low frequency band, improve the intermediate frequency band, raise the high frequency band, make the system transient response faster, reduced ability to resist high-frequency noise. Sec6.3 Lag Compensation G_c(s)=\\frac{bTs + 1}{Ts + 1}\\quad b"},{"title":"Forehead","path":"/notes/index.html","content":"写在前面面向期末的笔记，全英的。（课是全英的课"},{"title":"Digital Circuit(EN)","path":"/notes/dc.html","content":"这是一篇手写笔记，下面对应的PDF文件 目前存放在云端，这是云端链接 数电笔记。"},{"title":"Fundamentals of Kalman Filter and Inertia Navigation(EN)","path":"/notes/kalman.html","content":"Basic Requirement Formulate an filtering problem. Build a state space model of a system. Solve linear state estimation problems with Kalman filter. Learn the principles of inertial navigation. Learn/implement basic INS-GNSS integrated navigation system. Kalman FilterWhy is Kalman filter so popular? Kalman filter is BULE (Best Linear Unbiased Estimator) Powerful Convenient to use Example1 - Measure the center temperature of a rocket flame Example2 - Data Merging Notation $e_{EST}$ —— state estimation error $e_{MEA}$ — measurement error $K$ — Kalman gain $X$ — true state $\\hat{X}$ — estimated state $y$ — measurement $K = \\frac{e_{EST}}{e_{EST} + e_{MEA}}$ $\\hat{X}_k = \\hat{X}_{k-1} + K(y - \\hat{y})$ $e_{EST} = (1 - K)e_{EST}$ Example3 - A simple 0-order Kalman filter $K = \\frac{E_{\\hat{X}}}{E_{\\hat{X}} + E_y}$ $\\hat{X}_t = \\hat{X}_{t-1} + K (y - \\hat{X}_{t-1})$ $E_{\\hat{X}_{t}} = (1 - K)E_{\\hat{X}_{t-1}}$ Numerical integration of differential equations Euler integration Consider a first-order differential equation of the form: \\dot{x} = f(x, t)We know from calculus that the definition of a derivative of a function can be approximated by \\dot{x} = f(x, t) = \\frac{x(t + h) - x(t)}{h} = \\frac{x_k - x_{k-1}}{h}for small $ h $ . Rearranging terms yields x_k = x_{k-1} + hf(x, t)The preceding equation is known as Euler integration. Second-order Runge–Kutta The second-order Runge–Kutta numerical integration procedure is easy to state. Given a first-order differential equation of the form: \\dot{x} = f(x, t)where $ t $ is time, we seek to find a recursive relationship for $ x $ as a function of time. With the second-order Runge–Kutta numerical technique the value of $ x $ at the next integration interval $ h $ is given by x_k = x_{k-1} + 0.5h[f(x, t) + f(x, t + h)]Finding the area under a curve using trapezoids is equivalent to second-order Runge–Kutta integration. Noise and random variables The mean squared value of $x$ is defined as: $E(x^2) = \\int_{-\\infty}^{\\infty} x^2 p(x) dx$ The root mean square or rms of $x$ is defined as: $rms = \\sqrt{E(x^2)}$ The variance of $x$ is defined as: $\\sigma^2 = E[x - E(x)]^2 = E(x^2) - E^2(x)$ If we have independent random variables $x_1, x_2 … x_n$ , then the variance of the sum can be shown to be the sum of the variances, $\\sigma^2 = \\sigma_1^2 + \\sigma_2^2 + \\cdots + \\sigma_n^2$ State space notationOften in this text we will put linear differential equations into state space form because this will be required for setting up a Kalman-filtering problem. With state-space notation we are saying that any set of linear differential equations can be put in the form of the first-order matrix differential equation \\dot{x} = Fx + Gu + w Example: Consider the second-order differential equation without any random inputs. \\ddot{y} + 2\\dot{y} + 3y = 4rewrite \\dot{y} = -2\\dot{y} - 3y + 4\\begin{bmatrix} \\dot{y} \\\\ \\ddot{y} \\end{bmatrix} = \\begin{bmatrix} 0 & 1 \\\\ -3 & -2 \\end{bmatrix} \\begin{bmatrix} y \\\\ \\dot{y} \\end{bmatrix} + \\begin{bmatrix} 0 \\\\ 4 \\end{bmatrix}x = \\begin{bmatrix} y \\\\ \\dot{y} \\end{bmatrix}, F = \\begin{bmatrix} 0 & 1 \\\\ -3 & -2 \\end{bmatrix}, G = \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix}, u = 4, w = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix} Fundamental matrixIf the state-space form is: \\dot{x} = Fxwhere the systems dynamics matrix $F$ is time invariant, then we can say that there is a transition or fundamental matrix $\\Phi$ that can be used to exactly propagate the state forward from any time $t_0$ to time $t$ according to x(t) = \\Phi(t - t_0)x(t_0)Two simple ways of finding the fundamental matrix for time-invariant systems are by Laplace transforms and by Taylor-series expansion: Laplace transform technique: $\\Phi(t) = \\mathcal{L}^{-1} [(sI - F)^{-1}]$ Taylor-series expansion: $\\Phi(t) = e^{Ft} = I + Ft + \\frac{(Ft)^2}{2}{2!} + \\cdots + \\frac{(Ft)^n}{n!} + \\cdots$ Least squares methodWe will normally follow a three-step procedure for extracting information or estimating the characteristics of the signal based upon noisy measurement Assume a polynomial model to represent the actual signal. Try to estimate the coefficients of the selected polynomial by choosing a goodness of fit criterion. This is where Gauss comes in. The least squares criterion is the sum of the squares of the individual discrepancies between the estimated polynomial and measurement values of the actual signal contaminated by noise. Use calculus to minimize the sum of the squares of the individual discrepancies in order to obtain the best coefficients for the selected polynomial. Zero order of one-state filter For the zeroth-order case in which the best estimate is supposed to be a constant $a_0$: \\hat{x}_k = a_0Suppose we sample $n$ measurements $x^*_k$ of the data every $T_s$ seconds (i.e., $k$ goes from $1$ to $n$). R = \\sum_{k = 1}^{n}(\\hat{x}_k - x^*_k)^2 = \\sum_{k = 1}^{n}(a_0 - x^*_k)^2where $R$ is the square of the summation of all the residuals or differences between the estimate and the measurement. Because we are only estimating one constant, this is also sometimes called a one-state system. From calculus we know that a function can be minimized by taking its derivative and setting the result equal to zero. R = \\sum_{k = 1}^{n}(\\hat{x}_k - x^*_k)^2 = (a_0 - x^*_1)^2 + (a_0 - x^*_2)^2 + \\cdots + (a_0 - x^*_n)^2To minimize $R$ \\frac{\\partial R}{\\partial a_0} = 0 = 2(a_0 - x^*_1) + 2(a_0 - x^*_2) + \\cdots 2(a_0 - x^*_n)-x^*_1 - x^*_2 - \\cdots - x^*_n = -\\sum_{k = 1}^{n}x^*_k, \\quad a_0 + a_0 + \\cdots + a_0 = na_00 = na_0 - \\sum_{k = 1}^{n}x^*_ka_0 = \\frac{\\sum_{k = 1}^{n}x^*_k}{n}The preceding formula shows us that the best constant fit to a set of measurement data in the least squares sense is simply the average value of the measurements. First order or two-state filterSuppose we want to fit the measurement data with the best straight line (i.e., rather than a constant) in the least squares sense. This means we are seeking estimates to fit the first-order polynomial \\hat{x} = a_0 + a_1t, \\quad \\hat{\\dot{x}} = a_1in discrete notation \\hat{x}_k = a_0 + a_1(k - 1)T_s, \\quad \\hat{\\dot{x}}_k = a_1where $k$ is the number of measurements taken and $T_s$ is the sampling time. As before, the quantity to be minimized is still given by the summation of the square of the difference between the estimates and measurements or \\begin{align*} R =& \\sum_{k = 1}^{n}(\\hat{x}_k - x^*_k)^2 = \\sum_{k = 1}^{n}[a_0 + a_1(k - 1)T_s - x^*_k]^2 \\\\ =& (a_0 - x^*_1)^2 + (a_0 + a_1T_s - x^*_2)^2 + \\cdots + [a_0 + a_1(n - 1)T_s - x^*_n]^2 \\end{align*}Again, according to calculus, we can minimize $R$ by setting its derivative with respect to $a_0$ and $a_1$ to zero or \\begin{align*} \\frac{\\partial R}{\\partial a_0} &= 0 \\\\=& 2(a_0 - x^*_1) + 2(a_0 + a_1T_s - x^*_2) + \\cdots + 2[a_0 + a_1(n - 1)T_s - x^*_n] \\end{align*}\\begin{align*} \\frac{\\partial R}{\\partial a_1} &= 0\\\\ =& 2(a_0 + a_1T_s - x^*_2)T_s + \\cdots + 2(n - 1)T_s[a_0 + a_1(n - 1)T_s - x^*_n] \\end{align*}Simplify: na_0 + a_1\\sum_{k = 1}^{n}(k - 1)T_s = \\sum_{k = 1}^{n}x^*_ka_0\\sum_{k = 1}^{n}(k - 1)T_s + a_1\\sum_{k = 1}^{n}[(k - 1)T_s]^2 = \\sum_{k = 1}^{n}(k - 1)T_sx^*_kmatrix form: \\begin{bmatrix} n & \\sum_{k = 1}^{n}(k - 1)T_s \\\\ \\sum_{k = 1}^{n}(k - 1)T_s & \\sum_{k = 1}^{n}[(k - 1)T_s]^2 \\end{bmatrix} \\begin{bmatrix} a_0 \\\\ a_1 \\end{bmatrix} = \\begin{bmatrix} \\sum_{k = 1}^{n}x^*_k \\\\ \\sum_{k = 1}^{n}(k - 1)T_sx^*_k \\end{bmatrix} Second order LS filter*Second order polynomial model \\hat{x} = a_0 + a_1t + a_2t^2 \\hat{\\dot{x}} = a_1 + 2a_2t \\hat{\\ddot{x}} = 2a_2Discrete form \\hat{x}_k = a_0 + a_1(k - 1)T_s + a_2[(k - 1)T_s]^2matrix form: \\begin{align*} & \\begin{bmatrix} n & \\sum_{k = 1}^{n}(k - 1)T_s & \\sum_{k = 1}^{n}[(k - 1)T_s]^2 \\\\ \\sum_{k = 1}^{n}(k - 1)T_s & \\sum_{k = 1}^{n}[(k - 1)T_s]^2 & \\sum_{k = 1}^{n}[(k - 1)T_s]^3 \\\\ \\sum_{k = 1}^{n}[(k - 1)T_s]^2 & \\sum_{k = 1}^{n}[(k - 1)T_s]^3 & \\sum_{k = 1}^{n}[(k - 1)T_s]^4 \\end{bmatrix} \\begin{bmatrix} a_0 \\\\ a_1 \\\\ a_2 \\end{bmatrix} \\\\&= \\begin{bmatrix} \\sum_{k = 1}^{n}x^*_k \\\\ \\sum_{k = 1}^{n}(k - 1)T_sx^*_k \\\\ \\sum_{k = 1}^{n}[(k - 1)T_s]^2x^*_k \\end{bmatrix} \\end{align*} Third order LS filter*We can also fit the measurement data with the best cubic or third - order curve in the least squares sense. This means we are seeking estimates to fit the formula for the cubic \\hat{x} = a_0 + a_1t + a_2t^2 + a_3t^3or \\hat{x}_k = a_0 + a_1(k - 1)T_s + a_2[(k - 1)T_s]^2 + a_3[(k - 1)T_s]^3 Accelerometer testing exampleAccelerometer measurements are taken for different accelerometer orientation angles. where $\\theta_𝑘$ is the angle the accelerometer makes with the vertical for the $k$th measurement, $g$ is gravity. \\text{Theory} = g \\cos\\theta_kActually, the accelerometer output will also consist of additional terms caused by imperfections in the accelerometer. \\text{Output} = g \\cos\\theta_k + B + SFg \\cos\\theta_k + K(g \\cos\\theta_k)^2Therefore, the accelerometer error is simply the difference between the actual output and theory($\\theta_k$ is the actual angle and $\\theta^*_k$ is the measured angle): Error = Accelerometer Output – Theory = g\\cos\\theta_k + B + SF \\ g\\cos\\theta_k + K(g\\cos\\theta_k)^2 - g\\cos\\theta^*_kInitially, the simulation is set up so there is no noise on the angle $\\theta^*_k$. The error or measurement equation for the first example will be given by: \\theta^*_k = \\theta_k, \\quad x_k = g\\cos\\theta_k, \\quad y^*_k = B + SF \\ g\\cos\\theta_k + K(g\\cos\\theta_k)^2Let $x_k = g\\cos\\theta_k$ then $y^*_k = B + SFx_k + K(x_k)^2$ Term Scientific value English units Bias error $B$ $10 \\ \\mu g$ $10\\times 10^{-6} \\times32.2 = 0.000322 \\ \\text{ft}/\\text{s}^2$ Scale factor error $SF$ $5 \\ \\text{ppm}$ $5\\times10^{-6}$ $g$-squared sensitive drift $K$ $1 \\ \\mu g/\\text{g}^2$ $1\\times 10^{-6}/32.2 = 3.106 \\times10^{-8} \\ \\text{s}^2/\\text{ft}$ No angle noise 1 $\\mu r$ of angle noise on the vertical angle Making Least-Squares filter recursiveIf we were trying to fit a zeroth - order polynomial or constant to a set of measurement data the best estimate can be expressed as \\hat{x}_k = a_0 = \\frac{\\sum_{i = 1}^{k}x^*_i}{k}By changing subscripts we can rewrite the preceding expression as \\hat{x}_{k + 1} = \\frac{\\sum_{i = 1}^{k + 1}x^*_i}{k + 1} = \\frac{\\sum_{i = 1}^{k}x^*_i + x^*_{k + 1}}{k + 1}\\sum_{i = 1}^{k}x^*_i = k\\hat{x}_k\\hat{x}_{k + 1} = \\frac{k\\hat{x}_k + x^*_{k + 1}}{k + 1}\\begin{align*} \\hat{x}_{k + 1} = \\frac{k\\hat{x}_k + \\hat{x}_k + x^*_{k + 1} - \\hat{x}_k}{k + 1} \\\\= \\frac{(k + 1)\\hat{x}_k + x^*_{k + 1} - \\hat{x}_k}{k + 1} \\\\= \\hat{x}_k + \\frac{1}{k + 1}(x^*_{k + 1} - \\hat{x}_k) \\end{align*}Recursive properties of One-State filtersThe form of the zeroth - order or one - state recursive least - squares filter is given by \\hat{x}_k = \\hat{x}_{k - 1} + K_{1k}Res_kgain: $K_{1k} = \\frac{1}{k} \\quad k = 1,2,\\cdots,n$ residual: $Res_k = x^*_k - \\hat{x}_{k - 1}$ We can see that the filter gain for the zeroth - order recursive least - squares filter is unity for the first measurement (i.e., $k = 1$) and eventually goes to zero as more measurements are taken. The batch-processing least squares estimates are only available after all of the measurements are taken ,whereas the recursive least-squares estimates are available as the measurements are being taken. Recursive properties of One-State filtersIf the actual measurement data are simply a constant plus noise (i.e., zeroth - order signal plus noise) where the measurement noise is a zero - mean Gaussian process with variance $\\sigma^2_n$. x^*_k = x_k + v_k\\begin{align*} x_k - \\hat{x}_k =& x_k - \\hat{x}_{k - 1} - \\frac{1}{k}(x^*_k - \\hat{x}_{k - 1}) \\\\=& x_k - \\hat{x}_{k - 1} - \\frac{1}{k}(x_k + v_k - \\hat{x}_{k - 1}) \\end{align*}However, because the signal is a constant for the zeroth - order system, we can also say that $x_k = x_{k - 1}$ x_k - \\hat{x}_k = (x_{k - 1} - \\hat{x}_{k - 1})\\left(1 - \\frac{1}{k}\\right) - \\frac{1}{k}v_k\\begin{align*} (x_k - \\hat{x}_k)^2 =& (x_{k - 1} - \\hat{x}_{k - 1})^2\\left(1 - \\frac{1}{k}\\right)^2 \\\\-& 2\\left(1 - \\frac{1}{k}\\right)(x_{k - 1} - \\hat{x}_{k - 1})\\frac{v_k}{k} + \\left(\\frac{1}{k}v_k\\right)^2 \\end{align*}\\begin{align*} E[(x_k - \\hat{x}_k)^2] =& E[(x_{k - 1} - \\hat{x}_{k - 1})^2]\\left(1 - \\frac{1}{k}\\right)^2 \\\\-& 2\\left(1 - \\frac{1}{k}\\right)E[(x_{k - 1} - \\hat{x}_{k - 1})v_k]\\frac{1}{k} + E\\left[\\left(\\frac{1}{k}v_k\\right)^2\\right] \\end{align*}If we define the variance of the error in the estimate to be $P_k$ and the variance of the measurement noise to be $\\sigma^2_n$ and also assume that the noise is uncorrelated with the state or the estimate of the state, we can say that E[(x_k - \\hat{x}_k)^2] = P_kE[v^2_k] = \\sigma^2_nE[(x_{k - 1} - \\hat{x}_{k - 1})v_k] = 0Substitution of the preceding three equations into the expectation equation yields the difference equation for the variance of the error in the estimate or P_k = P_{k - 1}\\left(1 - \\frac{1}{k}\\right)^2 + \\frac{\\sigma^2_n}{k^2}P_1 = P_0\\left(1 - \\frac{1}{1}\\right)^2 + \\frac{\\sigma^2_n}{1^2} = \\sigma^2_nP_2 = P_1\\left(1 - \\frac{1}{2}\\right)^2 + \\frac{\\sigma^2_n}{2^2} = \\sigma^2_n\\frac{1}{4} + \\frac{\\sigma^2_n}{4} = \\frac{\\sigma^2_n}{2}P_3 = P_2\\left(1 - \\frac{1}{3}\\right)^2 + \\frac{\\sigma^2_n}{3^2} = \\frac{\\sigma^2_n}{2}\\frac{4}{9} + \\frac{\\sigma^2_n}{9} = \\frac{\\sigma^2_n}{3}P_4 = P_3\\left(1 - \\frac{1}{4}\\right)^2 + \\frac{\\sigma^2_n}{4^2} = \\frac{\\sigma^2_n}{3}\\frac{9}{16} + \\frac{\\sigma^2_n}{16} = \\frac{\\sigma^2_n}{4}The trend in the preceding four equations is now obvious, and we can summarize these results by saying in general for the zeroth - order recursive least - squares filter that the variance of the error in the estimate is simply P_k = \\frac{\\sigma^2_n}{k}If the real signal is a first - order: x_k = a_0 + a_1t = a_0 + a_1(k - 1)T_sThe filter will not be able to track the signal. The resulting error in the estimate is known as truncation error: \\varepsilon_k = x_k - \\hat{x}_kIn the noise - free case: \\begin{align*} \\hat{x}_k&=\\frac{\\sum_{i = 1}^{k}x_i}{k}=\\frac{\\sum_{i = 1}^{k}[a_0 + a_1(i - 1)T_s]}{k} \\\\&= \\frac{a_0\\sum_{i = 1}^{k}1 + a_1T_s\\sum_{i = 1}^{k}i - a_1T_s\\sum_{i = 1}^{k}1}{k}\\\\ &=\\frac{a_0k + a_1T_s[k(k + 1)/2] - a_1T_sk}{k}\\\\&=a_0+\\frac{a_1T_s}{2}(k - 1) \\end{align*}The truncation error of the zeroth - order recursive least - squares filter: \\begin{align*} \\varepsilon_k = x_k - \\hat{x}_k &= a_0 + a_1T_s(k - 1) - a_0 - \\frac{a_1T_s}{2}(k - 1)\\\\&=\\frac{a_1T_s}{2}(k - 1) \\end{align*}As already noted, as more measurements are taken k gets larger, and the error in the estimate caused by the measurement noise decreases while the error in the estimate caused by truncation error increases. In principle, for any particular numerical example there is an optimal value of k that will minimize the errors in the estimates caused by both measurement noise and truncation error. Filters properties of Two-State filtersThe two gains of a first - order or two - state recursive least - squares filter can be shown to be: K_{1k} = \\frac{2(2k - 1)}{k(k + 1)} \\quad k = 1,2,\\cdots,nK_{2k} = \\frac{6}{k(k + 1)T_s}If we think of the measurement as a position, position is the first state, whereas the velocity is the second state. residual: $Res_k = x^*_k - \\hat{x}_{k - 1} - \\dot{\\hat{x}}_{k - 1}T_s$ the new filter estimates: \\hat{x}_k = \\hat{x}_{k - 1} + \\dot{\\hat{x}}_{k - 1}T_s + K_{1k}Res_k\\dot{\\hat{x}}_k = \\dot{\\hat{x}}_{k - 1} + K_{2k}Res_kDescribing the variance of the error in the estimates in both states (i.e., $P_{11}$ and $P_{22}$) of the first - order filter: P_{11k} = \\frac{2(2k - 1)\\sigma^2_n}{k(k + 1)}P_{22k} = \\frac{12\\sigma^2_n}{k(k^2 - 1)T_s^2}where $\\sigma^2_n$ is the variance of the measurement noise, $k$ is the number of measurements taken, and $T_s$ is the sample time or time between measurements. The real signal is a second - order polynomial (one degree higher than the first - order filter) or x^*_k = a_0 + a_1t + a_2t^2 = a_0 + a_1(k - 1)T_s + a_2(k - 1)^2T_s^2The resulting error buildup caused by this lack of tracking ability is known as truncation error $\\varepsilon_k$ \\varepsilon_k = \\frac{1}{6}a_2T_s^2(k - 1)(k - 2)\\dot{\\varepsilon}_k = a_2T_s(k - 1)Properties of Second-Order or Three-State filterThe three gains of a second - order or three - state recursive least - squares filter can be shown to be: K_{1k} = \\frac{3(3k^2 - 3k + 2)}{k(k + 1)(k + 2)}, k = 1,2,\\cdots,nK_{2k} = \\frac{18(2k - 1)}{k(k + 1)(k + 2)T_s}K_{3k} = \\frac{60}{k(k + 1)(k + 2)T_s^2}If we think of the measurement as a position, then the estimates from this three - state filter will be position, velocity, and acceleration. For this filter a residual is also formed, which is the difference between the present measurement and a projection of the preceding estimate to the current time or Res_k = x^*_k - \\hat{x}_{k - 1} - \\dot{\\hat{x}}_{k - 1}T_s - 0.5\\ddot{\\hat{x}}_{k - 1}T_s^2The new filter estimates are a combination of the preceding state estimates projected forward to the current time plus a gain multiplied by the residual or \\hat{x}_k = \\hat{x}_{k - 1} + \\dot{\\hat{x}}_{k - 1}T_s + 0.5\\ddot{\\hat{x}}_{k - 1}T_s^2 + K_{1k}Res_k\\dot{\\hat{x}}_k = \\dot{\\hat{x}}_{k - 1} + \\ddot{\\hat{x}}_{k - 1}T_s^2 + K_{2k}Res_k\\ddot{\\hat{x}}_k = \\ddot{\\hat{x}}_{k - 1} + K_{3k}Res_kIf the measurement data are a second - order polynomial corrupted by noise and the measurement noise statistics are known, then formulas can be derived, describing the variance of the error in the estimates of all three states of the second - order filter. P_{11k} = \\frac{3(3k^2 - 3k + 2)\\sigma^2_n}{k(k + 1)(k + 2)}P_{22k} = \\frac{12(16k^2 - 30k + 11)\\sigma^2_n}{k(k^2 - 1)(k^2 - 4)T_s^2}P_{33k} = \\frac{720\\sigma^2_n}{k(k^2 - 1)(k^2 - 4)T_s^4}If the real signal is a third - order polynomial (one degree higher than the second - order filter) or \\begin{align*} x^*_k&=a_0 + a_1t + a_2t^2 + a_3t^3\\\\ &=a_0 + a_1(k - 1)T_s + a_2(k - 1)^2T_s^2 + a_3(k - 1)^3T_s^3 \\end{align*}The resulting error buildup caused by this lack of tracking ability is known as truncation error $\\varepsilon_k$ \\varepsilon_k = \\frac{1}{20}a_3T_s^3(k - 1)(k - 2)(k - 3)\\dot{\\varepsilon}_k = \\frac{1}{10}a_3T_s^2(6k^2 - 15k + 11)\\ddot{\\varepsilon}_k = 3a_3T_s(k - 1)Recursive filter summary From a measurement noise reduction point of view, it is best to use as low an order filter as possible because that will tend to reduce the error in the estimate caused by measurement noise. However, we also know that if we make the order of the filter too low there might be excessive truncation error. In each case the best-order filter to use will depend on the number of measurements to be taken and the actual order of the signal. Polynomial Kalman FiltersGeneral EquationsTo apply Kalman - filtering theory, our model of the real world must be described by a set of differential equations. \\dot{\\mathbf{x}} = \\mathbf{F}\\mathbf{x} + \\mathbf{G}\\mathbf{u} + \\mathbf{w}\\mathbf{z} = \\mathbf{H}\\mathbf{x} + \\mathbf{v} $\\mathbf{x}$ is a column vector with the states of the system $\\mathbf{F}$ the system dynamics matrix, $\\mathbf{u}$ is a known vector, which is sometimes called the control vector $\\mathbf{w}$ is a white - noise process, which is also expressed as a vector $\\mathbf{z}$ is the measurement vector $\\mathbf{H}$ is the measurement matrix $\\mathbf{v}$ is white measurement noise process noise matrix: \\mathbf{Q} = E[\\mathbf{w}\\mathbf{w}^T]measurement noise matrix: \\mathbf{R} = E[\\mathbf{v}\\mathbf{v}^T]Kalman Filter in Discrete FormTime Update（State prediction (1) State prediction \\hat{\\mathbf{x}}_k = \\boldsymbol{\\Phi}_k\\hat{\\mathbf{x}}_{k - 1}+\\mathbf{G}_k\\mathbf{u}_{k - 1}, \\quad \\mathbf{G}_k=\\int_{0}^{T_s}\\boldsymbol{\\Phi}(\\tau)\\mathbf{G} \\mathrm{d}\\tau(2) Covariance prediction \\mathbf{M}_k = \\boldsymbol{\\Phi}_k\\mathbf{P}_{k - 1}\\boldsymbol{\\Phi}_k^T+\\mathbf{Q}_kMeasure Update (1) Kalman gain update \\mathbf{K}_k=\\mathbf{M}_k\\mathbf{H}^T(\\mathbf{H}\\mathbf{M}_k\\mathbf{H}^T+\\mathbf{R}_k)^{-1}(2) State Update \\hat{\\mathbf{x}}_k = \\boldsymbol{\\Phi}_k\\hat{\\mathbf{x}}_{k - 1}+\\mathbf{G}_k\\mathbf{u}_{k - 1}+\\mathbf{K}_k(\\mathbf{z}_k-\\mathbf{H}\\boldsymbol{\\Phi}_k\\hat{\\mathbf{x}}_{k - 1}-\\mathbf{H}\\mathbf{G}_k\\mathbf{u}_{k - 1})(3) Covariance Update \\mathbf{P}_k = (\\mathbf{I}-\\mathbf{K}_k\\mathbf{H})\\mathbf{M}_kDerivation of Scalar Riccati Equations (may not in the exam)If there is no deterministic disturbance or control scalar, our discrete model of the real world is given by: x_k = \\Phi_kx_{k - 1} + w_kThe scalar Kalman - filtering equation: \\hat{x}_k = \\Phi_k\\hat{x}_{k - 1}+K_k(z_k - H\\Phi\\hat{x}_{k - 1})Measurement equation: z_k = Hx_k + v_kError: \\tilde{x}_k=(1 - K_kH)\\tilde{x}_{k - 1}\\Phi_k+(1 - K_kH)w_k - K_kv_kCovariance: P_k = E(\\tilde{x}^2_k) \\quad Q_k = E(w^2_k) \\quad R_k = E(v^2_k)we can square and take expectations of both sides of the error in the estimate equation to obtain: P_k=(1 - K_kH)^2(P_{k - 1}\\Phi^2_k + Q_k)+K^2_kR_kdefine: M_k = P_{k - 1}\\Phi^2_k + Q_kP_k=(1 - K_kH)^2M_k + K^2_kR_kFinding the gain that will minimize the variance of the error in the estimate: \\frac{\\partial P_k}{\\partial K_k}=0 = 2(1 - K_kH)M_k(-H)+2K_kR_kK_k=\\frac{M_kH}{H^2M_k + R_k}=M_kH(H^2M_k + R_k)^{-1}Substitution of the optimal gain into the covariance equation and simplification: P_k=(1 - K_kH)M_k The gain of the Kalman filter is chosen to minimize the variance of the error in the estimate. Polynomial Kalman Filter (Zero Process Noise) Comparing Zeroth-Order Recursive Least-Squares and Kalman FiltersSubstitution of the fundamental and measurement matrices of table into \\hat{x}_k = \\Phi_k\\hat{x}_{k - 1}+K_k(z_k - H\\Phi_k\\hat{x}_{k - 1})the scalar equation: \\hat{x}_k = \\hat{x}_{k - 1}+K_{1k}(x^*_k - \\hat{x}_{k - 1})define: Res_k = x^*_k - \\hat{x}_{k - 1}The zeroth - order or one - state polynomial Kalman - filter equation simplifies to \\hat{x}_k = \\hat{x}_{k - 1}+K_{1k}Res_kwhich is the same as the equation for the zeroth - order recursive least - squares filter. If we assume that the initial covariance matrix is infinite (i.e., this means that we have no a priori information on how to initialize the filter state) P_0 = \\inftythe Riccati equation M_1 = \\Phi_1P_0\\Phi_1^T = 1\\times \\infty\\times 1=\\inftyK_1 = M_1H^T(HM_1H^T + R_1)^{-1}=\\frac{M_1}{M_1+\\sigma^2_n}=\\frac{\\infty}{\\infty+\\sigma^2_n}=1P_1=(I - K_1H)M_1=\\left(1 - \\frac{M_1}{M_1+\\sigma^2_n}\\right)M_1=\\frac{\\sigma^2_nM_1}{M_1+\\sigma^2_n}=\\sigma^2_nWhen the zeroth-order polynomial Kalman filter has zero process noise and infinite initial covariance matrix, it has the same gains and variance predictions as the zeroth-order recursive least-squares filter The zeroth-order, first-order, and second order polynomial Kalman and recursive least-squares filters are identical in every way when the Kalman filter has zero process noise and infinite initial covariance matrix. Comparing Recursive Least-Squares and Kalman Filters Least-Square Filters = Kalman Filters($Q=0,P_0=infinity$)Kalman Filter is NOT Sensitive to the initial value of $P_0$For a specific system, Kalman Filter with Lower order gets better estimation accuracy When the process noise is zero the error in the state estimate will eventually approach zero as more measurements are taken. One engineering fix to the divergence problem is the use of process noise. Although the addition of process noise to the first-order filter prevents divergence, it also increases the errors in the estimate to the point where we would have been better off using the second-order polynomial Kalman filter without process noise Kalman Filter in a non-polynomial worldExtended Kalman Filtering Theoretical Equations \\dot{\\mathbf{x}} = f(\\mathbf{x})+\\mathbf{w} \\quad \\mathbf{Q} = E(\\mathbf{w}\\mathbf{w}^T)\\mathbf{z} = h(\\mathbf{x})+\\mathbf{v} \\quad \\mathbf{R} = E(\\mathbf{v}\\mathbf{v}^T)Linearize the model via Jaccobian Matrix \\mathbf{F}=\\left.\\frac{\\partial f(\\mathbf{x})}{\\partial \\mathbf{x}}\\right|_{\\mathbf{x}=\\hat{\\mathbf{x}}}\\mathbf{H}=\\left.\\frac{\\partial h(\\mathbf{x})}{\\partial \\mathbf{x}}\\right|_{\\mathbf{x}=\\hat{\\mathbf{x}}}\\boldsymbol{\\Phi}_k = \\mathbf{I}+\\mathbf{F}T_s+\\frac{\\mathbf{F}^2T_s^2}{2!}+\\frac{\\mathbf{F}^3T_s^3}{3!}+\\cdotsInertial NavigationWhat is navigation System? Techniques and methods for guiding a carrier from its starting point toits destination. Provide navigation parameters, position, speed and attitude of the carrier. What is Guidance System? Guidance is a technology and method that automatically guides the carrier to the destination according to the pre-planned route. Relationship between navigation and guidance Navigation system: Provide navigation parameters and achieve navigation tasks Guidance: Automatic guidance and control of aircraft according to a certain law to fly to the target or predetermined orbit technology or method. Guidance contains not only the measurement value of the application navigation system, but also the whole closed-loop working process of automatic control. Base-Station based navigation: GNSS UWB RF WiFi Dead Reckoning: IMU Odometer Magnetic Compass Map Match: Road vector Map Vision Sensors Lidars Sonar SoOP Inertial navigation Features of inertial navigation system: Error characteristics of inertial navigation: Basic principle of inertial navigation calculate the change in velocity and position by performing successive mathematical integrations of the acceleration with respect to time. it is necessary to keep track of the direction in which the accelerometers are pointing. Rotational motion of the body with respect to inertial reference frame may be sensed using gyroscopic sensors that are used to determine the orientation of the accelerometers at all times. What does INS consist of ? gyroscopes accelerometers There are mainly two types of INS: Gimbaled INS Strap-down INS Strapdown INSTwo-dimensional navigation for stabilized platform Strapdown inertial navigation unit block diagram Reference Frames The inertial frame(i-frame)Origin-$O_i$ :Center of earth non-rotating with fixed stars; $X_i$ axis: In equatorial plane $Y_i$ axis: In equatorial plane $Z_i$ axis: Coincident with polar axis(normally assumed to be invariant in direction) The earth frame(e-frame)Origin - $O_e$: Center of Earth, fixed with respect to Earth $Z_e$ axis: Along with polar axis $X_e$ axis: Intersection of the plane of Greenwich meridian with equatorial plane $Y_e$ axis: obey right - hand rule. The e - frame rotates with respect to the inertial frame at a rate $\\Omega$ about the axis $Z_e$. \\omega_{ie}=\\frac{1 + 365.25}{365.25\\times24}\\frac{2\\pi}{3600}\\approx7.292115\\times 10^{-5} \\text{ (rad/s)}The body frame(b-frame)Origin - $O_b$: Origin at the center of the carrier (or the navigation system) $X_b$ axis: Forward $Y_b$ axis: Right $Z_b$ axis: Down Sometimes the x, y, z are chosen to be Right, Forward, Up or Pitch, Roll, Yaw The Local Geographic frame(L-frame)Origin - $O_L$: Origin at the location of the navigation system $X_L$ axis: Align with local North $Y_L$ axis: Align with local East $Z_L$ axis: Align with vertical down Sometimes the x, y, z are chosen to be East, North, Up. Above is also defined as Local Geographic Frame (L - frame), and n frame is chosen as L - frame, n - frame can also be i - frame when performing interstellar missions. Transform between FramesDirection cosine matrix(DCM) A direction cosine matrix (DCM) is a transformation matrix that transforms one coordinate reference frame to another. \\mathbf{r^n} = \\mathbf{C^n_br^b}The rotation matrix $\\mathbf{C^n_b}$ is generated from the Euler angles by multiplying the three matricesgenerated by rotations about the axes. Euler angles rotate through angle $\\psi$ about reference $z$-axis rotate through angle $\\theta$ about new $y$-axis rotate through angle $\\phi$ about new $x$-axis Quaternions A quaternion representation of rotation is written as a vector (normalized quaternion): \\mathbf{q}=\\begin{bmatrix} a\\\\ b\\\\ c\\\\ d \\end{bmatrix}=\\begin{bmatrix} \\cos(\\mu/2)\\\\ (\\mu_x/\\mu)\\sin(\\mu/2)\\\\ (\\mu_y/\\mu)\\sin(\\mu/2)\\\\ (\\mu_z/\\mu)\\sin(\\mu/2) \\end{bmatrix}where $\\mu_x, \\mu_y, \\mu_z$ are the components of the angle vector $\\boldsymbol{\\mu}$ and $\\mu$ the magnitude of $\\boldsymbol{\\mu}$. Use of quaternion for vector transformation \\mathbf{q}=a + \\mathbf{i}b+\\mathbf{j}c+\\mathbf{k}d\\mathbf{r}^b=\\mathbf{i}x+\\mathbf{j}y+\\mathbf{k}z \\mathbf{r}^{b^\\prime}=0+\\mathbf{i}x+\\mathbf{j}y+\\mathbf{k}zThis is expressed in reference axes as $\\mathbf{r}^{n^\\prime}$ using: \\mathbf{r}^{n^\\prime}=\\mathbf{q}\\mathbf{r}^{b^\\prime}\\mathbf{q}^*where $\\mathbf{q}^*=(a - \\mathbf{i}b - \\mathbf{j}c - \\mathbf{k}d)$, the complex conjugate of $\\mathbf{q}$. Types of inertial navigationGimbaled inertial navigation systemThree-axis gyro-stabilized platform, the accelerometer is fixed on the platform, its sensitive axis is parallel to the platform axis, and the three stable axes of the platform simulate a navigation coordinate system. Advantages: Directly simulate the navigation coordinate system, the calculation is relatively simple; it can isolate the angular motion of the carrier, and the system has high precision. Disadvantages: The structure is complex, the volume is large, and the production cost is high. Strap-down inertial navigationThere is no stable platform, and the accelerometer and gyroscope are directly fixed to the carrier. When the carrier rotates, the sensitive axes of the accelerometers and gyroscopes also follow the rotation. The gyroscope measures the angular motion of the carrier, calculates the attitude angle of the carrier, and determines the direction of the sensitive axis of the accelerometer. Then through the coordinate transformation, the signal output by the accelerometer is transformed into the navigation coordinate system, and the navigation calculation is performed. Advantages: No mechanical platform, simple structure, small size, easy maintenance. Disadvantages: High requirements for components; large amount of calculation in coordinate transformation. Type of gyroscope Comparison of gyroscopes with different precision Types Accuracy (drift) Application High precision (inertial stage) gyroscope &lt;$10^{-3}\\ ^{\\circ}/$h Long - range launch vehicles, intercontinental missiles, nuclear submarines Medium precision (navigational stage) gyroscope &lt;$10^{-2}\\ ^{\\circ}/$h Aircraft attitude system, Marine platform compass Low and medium precision gyroscope About $0.1\\ ^{\\circ}/$h All tactical weapons, fire control and stable aim systems Low precision gyroscope $0.1\\sim1\\ ^{\\circ}/$h Motion detection in traffic vehicles and industrial fields Angular rate sensor $0.01\\ ^{\\circ}/$s Motion detection in traffic vehicles and industrial fields Error model of gyroscope\\begin{align*} \\tilde{\\omega}_x - \\omega_x&=S_x\\omega_x+M_y\\omega_y+M_z\\omega_z\\\\ &+B_{g_x}a_x + B_{g_z}a_z + B_{a_{xz}}a_ya_z\\\\ &+n_x\\\\ &+B_f \\end{align*} $a_x$: Acceleration of the input axis of the gyro $a_z$: Acceleration of the gyroscope rotor shaft $S_x$: Scale factor error $M_y, M_z$: Cross coupling coefficient $B_{g_x}, B_{g_z}$: The bias coefficient with respect to $\\mathbf{g}$ $B_{a_{xz}}$: Inelastic bias coefficient $B_f$: A bias independent of $\\mathbf{g}$ $n_x$: Zero mean random bias Mechanical model of accelerometer For the spring - mass system, the sensitive mass force balance equation is as follows: m\\frac{d^2x}{dt^2}=C\\frac{dx}{dt}+kx $x$: Sensitive mass displacement $C$: Damping coefficient $k$: Spring elasticity coefficient Pendulum accelerometerQuartz flexible pendulum accelerometer is mainly used in inertial navigation system Advantages: small volume, high precision, fast start, impact resistance Application: requirements of a variety of carriers and inertial systems, including ships, vehicles and aircraft inertial navigation system, missile and rocket inertial guidance system, satellite and spacecraft control system Silicon micro accelerometerIt is based on integrated circuit technology and micromachining technology. Advantages: low cost, small size, low power consumption and mass production Application: national defense, inertial navigation, seismic detection, industry, medical, automation and consumer electronics. Followed by the Lesson 10, What if the rotation angle is small? \\mathbf{C}^b_a=\\begin{bmatrix} 1&\\alpha_z&-\\alpha_y\\\\ -\\alpha_z&1&\\alpha_x\\\\ \\alpha_y&-\\alpha_x&1 \\end{bmatrix}=\\mathbf{I}-\\begin{bmatrix} 0&-\\alpha_z&\\alpha_y\\\\ \\alpha_z&0&-\\alpha_x\\\\ -\\alpha_y&\\alpha_x&0 \\end{bmatrix}Where $[\\boldsymbol{\\alpha}\\times]=\\begin{bmatrix}0&amp;-\\alpha_z&amp;\\alpha_y\\\\\\alpha_z&amp;0&amp;-\\alpha_x\\\\-\\alpha_y&amp;\\alpha_x&amp;0\\end{bmatrix}$, called skewed matrix Quaternion operations \\mathbf{Q} = q_0 + q_1\\mathbf{i}+q_2\\mathbf{j}+q_3\\mathbf{k}\\mathbf{P} = p_0 + p_1\\mathbf{i}+p_2\\mathbf{j}+p_3\\mathbf{k} Summing: \\mathbf{Q}\\pm\\mathbf{P}=(q_0\\pm p_0)+(q_1\\pm p_1)\\mathbf{i}+(q_2\\pm p_2)\\mathbf{j}+(q_3\\pm p_3)\\mathbf{k} Multiplication: \\begin{align*} \\mathbf{P}\\otimes\\mathbf{Q}&=(p_0 + p_1\\mathbf{i}+p_2\\mathbf{j}+p_3\\mathbf{k})\\otimes(q_0 + q_1\\mathbf{i}+q_2\\mathbf{j}+q_3\\mathbf{k})\\\\ &=(p_0q_0 - p_1q_1 - p_2q_2 - p_3q_3)\\\\&+(p_0q_1 + p_1q_0 + p_2q_3 - p_3q_2)\\mathbf{i}\\\\ &+(p_0q_2 + p_2q_0 + p_3q_1 - p_1q_3)\\mathbf{j}\\\\&+(p_0q_3 + p_3q_0 + p_1q_2 - p_2q_1)\\mathbf{k}\\\\ &=r_0 + r_1\\mathbf{i}+r_2\\mathbf{j}+r_3\\mathbf{k} \\end{align*} \\begin{align*} \\begin{bmatrix} r_0\\\\ r_1\\\\ r_2\\\\ r_3 \\end{bmatrix}= \\begin{bmatrix} p_0&-p_1&-p_2&-p_3\\\\ p_1&p_0&-p_3&p_2\\\\ p_2&p_3&p_0&-p_1\\\\ p_3&-p_2&p_1&p_0 \\end{bmatrix} \\begin{bmatrix} q_0\\\\ q_1\\\\ q_2\\\\ q_3 \\end{bmatrix} \\\\= \\begin{bmatrix} q_0&-q_1&-q_2&-q_3\\\\ q_1&q_0&q_3&-q_2\\\\ q_2&-q_3&q_0&q_1\\\\ q_3&q_2&-q_1&q_0 \\end{bmatrix} \\begin{bmatrix} p_0\\\\ p_1\\\\ p_2\\\\ p_3 \\end{bmatrix} \\end{align*}Relationship between DCM,Euler angle,and QuaternionEuler angle or Quaternion-&gt;DCM DCM -&gt; Euler angle \\begin{align*} \\phi&=\\arctan\\left(\\frac{c_{32}}{c_{33}}\\right)\\\\ \\theta&=\\arcsin(-c_{31})\\\\ \\psi&=\\arctan\\left(\\frac{c_{21}}{c_{11}}\\right) \\end{align*}Euler -&gt; Quaternion \\begin{align*} a&=\\cos\\frac{\\phi}{2}\\cos\\frac{\\theta}{2}\\cos\\frac{\\psi}{2}+\\sin\\frac{\\phi}{2}\\sin\\frac{\\theta}{2}\\sin\\frac{\\psi}{2}\\\\ b&=\\sin\\frac{\\phi}{2}\\cos\\frac{\\theta}{2}\\cos\\frac{\\psi}{2}-\\cos\\frac{\\phi}{2}\\sin\\frac{\\theta}{2}\\sin\\frac{\\psi}{2}\\\\ c&=\\cos\\frac{\\phi}{2}\\sin\\frac{\\theta}{2}\\cos\\frac{\\psi}{2}+\\sin\\frac{\\phi}{2}\\cos\\frac{\\theta}{2}\\sin\\frac{\\psi}{2}\\\\ d&=\\cos\\frac{\\phi}{2}\\cos\\frac{\\theta}{2}\\sin\\frac{\\psi}{2}+\\sin\\frac{\\phi}{2}\\sin\\frac{\\theta}{2}\\cos\\frac{\\psi}{2} \\end{align*} $\\mathbf{f}^a$ — vector $\\mathbf{f}$ in a - frame $\\mathbf{f}^b$ — vector $\\mathbf{f}$ in b - frame Transformation between frame a and b: \\begin{align*} \\mathbf{f}^a&=\\mathbf{C}^a_b\\mathbf{f}^b\\\\ \\mathbf{r}^{a^\\prime}&=\\mathbf{q}^a_b\\mathbf{r}^{b^\\prime}\\mathbf{q}^{a*}_b,\\\\ \\mathbf{r}^{a^\\prime}&=[0, rax, ray, raz]^T,\\\\ \\mathbf{r}^{b^\\prime}&=[0, rbx, rby, rbz]^T \\end{align*} Differential equation for Quaternion*\\begin{align*} \\dot{\\mathbf{q}}^n_b&=\\frac{1}{2}[\\boldsymbol{\\Omega}^b_{nb}]\\mathbf{q}^n_b\\\\ [\\boldsymbol{\\Omega}^b_{nb}]&=[\\boldsymbol{\\omega}^b_{ab}\\times]= \\begin{bmatrix} 0&\\omega_x&\\omega_y&\\omega_z\\\\ -\\omega_x&0&\\omega_z&-\\omega_y\\\\ -\\omega_y&-\\omega_z&0&\\omega_x\\\\ -\\omega_z&\\omega_y&-\\omega_x&0 \\end{bmatrix} \\end{align*}Solution: \\mathbf{q}(t_k)= \\begin{bmatrix} \\cos\\frac{\\phi}{2}\\\\ \\sin\\frac{\\phi}{2}\\cdot\\frac{\\boldsymbol{\\varphi}}{\\phi} \\end{bmatrix}\\otimes\\mathbf{q}(t_{k - 1})Differential equation for DCM*\\dot{\\mathbf{C}}^a_b=\\mathbf{C}^a_b\\boldsymbol{\\Omega}^b_{ba}Let frame b rotate with respect to a frame during $\\Delta t$ for angle $\\boldsymbol{\\phi}^b_{ab}=[\\phi_x, \\phi_y, \\phi_z]$ \\begin{align*} \\mathbf{C}^b_a(t+\\Delta t)&=(\\mathbf{I}-[\\boldsymbol{\\phi}\\times])\\mathbf{C}^b_a(t)=\\mathbf{C}^b_a(t)-[\\boldsymbol{\\phi}\\times]\\mathbf{C}^b_a(t)\\\\ \\dot{\\mathbf{C}}^b_a(t)&=\\lim_{\\Delta t\\rightarrow0}\\frac{\\mathbf{C}^b_a(t + \\Delta t)-\\mathbf{C}^b_a(t)}{\\Delta t}\\\\&=-\\lim_{\\Delta t\\rightarrow0}\\left[\\frac{\\boldsymbol{\\phi}^b_{ab}\\times}{\\Delta t}\\right]\\mathbf{C}^b_a(t)=-[\\boldsymbol{\\Omega}^b_{ab}\\times]\\mathbf{C}^b_a(t)\\\\ \\dot{\\mathbf{C}}^a_b(t)&=\\mathbf{C}^a_b(t)[\\boldsymbol{\\Omega}^b_{ab}\\times]\\\\ \\boldsymbol{\\Omega}^b_{ab}&=\\boldsymbol{\\Omega}^b_{ib}-\\mathbf{C}^b_a\\boldsymbol{\\Omega}^a_{ia} \\end{align*}The shape of the earth the length of the semi - major axis, $R$ the length of the semi - minor axis, $r = R(1 - f)$ the flattening of the ellipsoid, $f=(R - r)/R$ the major eccentricity of the ellipsoid, $e = [f(2 - f)]^{1/2}$ Variations of gravitational attraction over the Earth Theoretical gravity vector: g, downward Gravity vector in Practice: Vary with position &amp; hight Reason: variations between mass attraction and g vector Centrifugal acceleration being a function of latitude inhomogeneous mass distribution of the Earth Earth parametersThe motions of the earth are composed of: rotation around the axis of rotation relative to the sun revolution around the sun Then: angular velocity of the earth’s rotation relative to the inertial space is different from the angular velocity of the earth’s rotation relative to the sun around its axis of rotation. The angular velocity of the earth‘s rotation relative to the inertial space can be measured by the gyroscope. \\omega_{ie}=\\frac{1 + 365.25}{365.25\\times24\\times3600}\\cdot2\\pi\\approx7.292115\\times 10^{-5}\\text{ (rad/s)}Gravitational acceleration \\mathbf{g}=\\mathbf{G}_m-\\overline{\\boldsymbol{\\omega}}_{ie}\\times(\\overline{\\boldsymbol{\\omega}}_{ie}\\times\\overline{\\boldsymbol{R}}) $\\overline{\\boldsymbol{R}}$ - The position vector of the point relative to the center of the earth $\\overline{\\boldsymbol{\\omega}}_{ie}$ - Angular velocity of the earth $\\times$ - Skew - symmetric matrix Universal Navigational EquationsPrerequisite Specific force — $\\mathbf{f}^a$ \\mathbf{f}^a=\\mathbf{C}^a_b\\mathbf{f}^b Position vector in Earth fixed frame — $\\mathbf{r}^e$ Mathematical Platform: \\dot{\\mathbf{C}}^a_b=\\mathbf{C}^a_b\\boldsymbol{\\Omega}^b_{ba}\\boldsymbol{\\Omega}^b_{ba}=\\begin{bmatrix} 0&-\\omega_z&\\omega_y\\\\ \\omega_z&0&-\\omega_x\\\\ -\\omega_y&\\omega_x&0 \\end{bmatrix}\\quad \\text{skew - symmetric matrix}\\left.\\frac{\\mathrm{d}^2\\mathbf{r}}{\\mathrm{d}t^2}\\right|_{\\mathrm{i}}=\\mathbf{f}+\\mathbf{g}Differentiating this expression and writing $\\left.\\frac{\\mathrm{d}\\mathbf{r}}{\\mathrm{d}t}\\right|_{\\mathrm{e}} = \\mathbf{v}_{\\mathrm{e}}$, we have, \\left.\\frac{\\mathrm{d}^2\\mathbf{r}}{\\mathrm{d}t^2}\\right|_{\\mathrm{i}}=\\left.\\frac{\\mathrm{d}\\mathbf{v}_{\\mathrm{e}}}{\\mathrm{d}t}\\right|_{\\mathrm{i}}+\\left.\\frac{\\mathrm{d}}{\\mathrm{d}t}[\\boldsymbol{\\omega}_{\\mathrm{ie}}\\times\\mathbf{r}]\\right|_{\\mathrm{i}}Absolute velocity = ground speed + implicated velocity Navigation algorithmThe velocity and position equations: \\begin{align*} \\mathbf{v}^n&=\\int_0^t\\mathbf{f}^n\\mathrm{d}t-\\int_0^t[2\\boldsymbol{\\omega}_{ie}+\\boldsymbol{\\omega}_{en}]\\times\\mathbf{v}^n\\mathrm{d}t+\\int_0^t\\mathbf{g}\\mathrm{d}t\\\\ \\mathbf{x}^n&=\\int_0^t\\mathbf{v}^n\\mathrm{d}t \\end{align*}The vectors in the above equations may be expressed in component form as follows: \\begin{align*} \\mathbf{v}^n&=[v_N \\quad v_E \\quad v_D]^T\\\\ \\mathbf{x}^n&=[x_N\\quad x_E\\quad -h]^T\\\\ \\boldsymbol{\\omega}_{ie}&=[\\Omega\\cos L\\quad 0\\quad -\\Omega\\sin L]^T\\\\ \\boldsymbol{\\omega}_{en}&=\\left[\\frac{v_E}{R_0 + h}\\quad \\frac{-v_N}{R_0 + h}\\quad \\frac{-v_E\\tan L}{R_0 + h}\\right]^T\\\\ \\mathbf{g}&=[0\\quad 0\\quad g]^T \\end{align*}The expressions apply for navigation in the vicinity of the Earth, in the local vertical geographic frame. Inertial navigation system alignmentAlignment Methods: Coarse alignment and fine alignment Using gyrocompassing techniques (leveling and azimuth alignment) Using Kalman filterring. Coarse alignment: Obtain the approximate attitude matrix from the carrier coordinate system to the navigation coordinate system in a short time, providing initial conditions for fine alignment. Fine alignment: On the basis of coarse alignment, accurately estimate and compensate for the attitude error through a filtering algorithm, making the misalignment angle approach zero. Azimuth Coarse Alignment (Northfind alignment) \\begin{align*} \\omega_x&=\\Omega\\cos L\\cos\\psi\\\\ \\omega_y&=\\Omega\\cos L\\sin\\psi \\end{align*} $\\Omega$-Earth’s rate $L$-latitude $\\psi$-the heading of gyroscope axis with respect to true north. \\begin{align*} \\frac{\\omega_y}{\\omega_x}&=\\frac{\\Omega\\cos L\\sin\\psi}{\\Omega\\cos L\\cos\\psi}=\\tan\\psi\\\\ \\psi&=\\arctan\\left(\\frac{\\omega_y}{\\omega_x}\\right) \\end{align*}Fine alignment - Using gyro compassing method \\begin{align*} \\delta\\dot{V}_E &= -\\phi_y g + abla_E \\\\ \\dot{\\phi}_y &= \\frac{\\delta V_E}{R} + \\epsilon_N \\\\ \\delta\\dot{V}_N &= \\phi_x g + abla_N \\\\ \\dot{\\phi}_x &= -\\frac{\\delta V_N}{R} - \\phi_z \\omega_{ie} \\cos L + \\epsilon_E \\end{align*}Error model of Azimuth channel $\\boldsymbol{\\omega}_{cmd}=\\boldsymbol{\\omega}_{ig}^g=\\begin{bmatrix}0\\\\\\omega_{ie}\\cos L\\\\\\omega_{ie}\\sin L\\end{bmatrix}$ $\\boldsymbol{\\omega}_{iP}^g = \\boldsymbol{C}_P^g\\boldsymbol{\\omega}_{iP}=\\begin{bmatrix}1&amp;-\\phi_z&amp;0\\\\\\phi_z&amp;1&amp;0\\\\0&amp;0&amp;1\\end{bmatrix}\\begin{bmatrix}0\\\\\\omega_{ie}\\cos L\\\\\\omega_{ie}\\sin L\\end{bmatrix}=\\begin{bmatrix}-\\phi_z\\omega_{ie}\\cos L\\\\\\omega_{ie}\\cos L\\\\\\omega_{ie}\\sin L\\end{bmatrix}$ $\\boldsymbol{\\omega}_{gP}^g=\\boldsymbol{\\omega}_{iP}^g-\\boldsymbol{\\omega}_{ig}^g=\\begin{bmatrix}-\\phi_z\\omega_{ie}\\cos L\\\\0\\\\0\\end{bmatrix}$ $\\omega_{gPx}^g = -\\phi_z\\omega_{ie}\\cos L$ $\\phi_z\\omega_{ie}\\cos L$ - Compass Term Fine Alignment - Using Kalman Filter \\dot{\\boldsymbol{X}}(t)=\\boldsymbol{A}\\boldsymbol{X}(t)+\\boldsymbol{W}Ground alignment methodThe objective of the angular alignment process is to determine the direction cosine matrix which relates the body and geographic reference frames. \\mathbf{g}^b = \\mathbf{C}_n^b \\mathbf{g}^n \\boldsymbol{\\omega}_{ie}^b = \\mathbf{C}_n^b \\boldsymbol{\\omega}_{ie}^nwhere $\\mathbf{g}^n = [0 \\ 0 \\ -g]^T$ and $\\boldsymbol{\\omega}_{ie}^n = [\\Omega\\cos L \\ 0 \\ -\\Omega\\sin L]^T$ in which $\\Omega$ and $L$ denote Earth’s rate and latitude, respectively. Given knowledge of these quantities, estimates of the elements of the direction cosine matrix may be computed directly from the measurements of $\\mathbf{g}^b = [g_x \\ g_y \\ g_z]^T$ and $\\boldsymbol{\\omega}_{ie}^b = [\\omega_x \\ \\omega_y \\ \\omega_z]^T$ as follows: \\begin{align*} c_{31}&=-\\frac{g_x}{g}& c_{11}&=\\frac{\\omega_x}{\\Omega\\cos L}-\\frac{g_x\\tan L}{g}\\\\ c_{32}&=-\\frac{g_y}{g}& c_{12}&=\\frac{\\omega_y}{\\Omega\\cos L}-\\frac{g_y\\tan L}{g}\\\\ c_{33}&=-\\frac{g_z}{g}& c_{13}&=\\frac{\\omega_z}{\\Omega\\cos L}-\\frac{g_z\\tan L}{g} \\end{align*}The remaining direction cosine elements may be determined by making use of the orthogonality properties of the direction cosine matrix which yield: \\begin{align*} c_{21}&=-c_{12}c_{33}+c_{13}c_{32}\\\\ c_{22}&=c_{11}c_{33}-c_{31}c_{13}\\\\ c_{23}&=-c_{11}c_{32}+c_{31}c_{12} \\end{align*}As a result of instrument biases, the above procedure will yield an estimate of the direction cosine matrix $\\tilde{\\mathbf{C}}_b^n$ which will be in error. $\\tilde{\\mathbf{C}}_b^n$ may be expressed as the product of the true matrix $\\mathbf{C}_b^n$ and a matrix $\\mathbf{B}$ which represents the misalignment between the actual and computed geographic frames: \\tilde{\\mathbf{C}}_b^n = \\mathbf{B}\\mathbf{C}_b^n \\mathbf{B}=\\mathbf{I}-\\boldsymbol{\\Psi} \\boldsymbol{\\Psi}=\\begin{pmatrix} 1 & -\\delta\\gamma & \\delta\\beta\\\\ \\delta\\gamma & 1 & -\\delta\\alpha\\\\ -\\delta\\beta & \\delta\\alpha & 1 \\end{pmatrix}When $\\mathbf{C}_b^n = \\mathbf{I}$, it can be shown that: \\begin{align*} \\delta\\alpha&=\\frac{B_y}{g}\\\\ \\delta\\beta&=-\\frac{B_x}{g}\\\\ \\delta\\gamma&=\\frac{D_y}{\\Omega\\cos L}+\\frac{B_y\\tan L}{g} \\end{align*}The azimuth misalignment term ($\\delta\\gamma$) contains two components; the first being the result of a residual gyroscopic bias acting in the east direction, the second term being the result of a level or tilt error about the north axis causing a component of vertical Earth’s rate ($\\delta\\alpha\\Omega\\sin L$) to appear as a further bias about the east axis. Initial Alignment Alignment based on Kalman Filter——Estimating $\\Psi_N$, $\\Psi_E$, $\\Psi_D$ from random noises, thus correct $\\mathbf{C}_b^n$ to align body frame with navigation frame At the same time, try to estimate biases of gyros and accelerometers, which can be viewed as constants Error models of INSThere are different forms of error model of INS for initial alignment Horizontal movement Position error as variable Velocity error as variable Attitude error model Angle Error $\\phi$ Angle Error $\\psi$ Mostly $\\psi$ error model and velocity error are chosen INS error can be described with 3 basic formulas: \\begin{cases} \\dot{r}+\\boldsymbol{\\rho}\\times r = \\delta V\\\\ \\delta\\dot{V}+(\\boldsymbol{\\Omega}+\\boldsymbol{\\omega})\\times\\delta V= abla - \\boldsymbol{\\Phi}\\times f+\\Delta g\\\\ \\dot{\\boldsymbol{\\Psi}}+\\boldsymbol{\\omega}\\times\\boldsymbol{\\Psi}=\\boldsymbol{\\varepsilon} \\end{cases} $\\delta V$, $r$ and $\\boldsymbol{\\Psi}$ denote velocity, position and attitude $\\boldsymbol{\\Omega}$——earth rotation vector $\\boldsymbol{\\omega}$——angular movement of $n$ frame with respect to $i$-frame $ abla$——accelerometer drift, $\\boldsymbol{\\varepsilon}$——gyro drift $f$——specific force, $\\Delta g$——gravity vector error $\\boldsymbol{\\rho}$——rotation vector of $n$ frame with respect to earth frame Relationship between $\\boldsymbol{\\Phi}$ and $\\boldsymbol{\\Psi}$: \\begin{cases} \\Phi_E = \\Psi_E+\\delta L\\\\ \\Phi_N = \\Psi_N+\\delta\\lambda\\cos L\\\\ \\Phi_D = \\Psi_D - \\delta\\lambda\\sin L \\end{cases}Differentiate: In static state, the two types error models are equivalent \\begin{cases} \\dot{\\Phi}_N = \\dot{\\Psi}_N+\\delta\\dot{\\lambda}\\cos L - \\delta\\lambda\\sin L\\cdot\\dot{L}\\\\ \\dot{\\Phi}_E = \\dot{\\Psi}_E+\\delta\\dot{L} \\end{cases}Velocity error is defined as velocity difference between INS and true velocity \\begin{cases} \\delta\\dot{V}_N = -2\\Omega\\sin L\\delta V_E - \\Phi_E g+ abla_N\\\\ \\delta\\dot{V}_E = 2\\Omega\\sin L\\delta V_N + \\Phi_N g+ abla_E \\end{cases}Position Error model in static base: \\begin{cases} \\delta\\dot{L}=\\frac{1}{R}\\delta V_N\\\\ \\delta\\dot{\\lambda}=\\frac{\\delta V_E}{R}\\sec L \\end{cases} Kalman filter design \\dot{X} = AX+W \\begin{align*} \\mathbf{X}&= [\\delta V_N \\ \\delta V_E \\ \\Psi_N \\ \\Psi_E \\ \\Psi_D \\ abla_N \\ abla_E \\ \\varepsilon_N \\ \\varepsilon_E \\ \\varepsilon_D]\\\\ \\mathbf{W}&= [W_{\\delta V_N} \\ W_{\\delta V_E} \\ W_{\\Psi_N} \\ W_{\\Psi_E} \\ W_{\\Psi_D} \\ 0 \\ 0 \\ 0 \\ 0 \\ 0] \\end{align*} \\begin{align*} \\mathbf{A}&=\\begin{bmatrix} \\mathbf{F} & \\mathbf{I}_{5\\times5}\\\\ \\mathbf{0}_{5\\times5} & \\mathbf{0}_{5\\times5} \\end{bmatrix}\\\\ \\mathbf{F}&=\\begin{bmatrix} 0 & 2\\Omega_D & 0 & g & 0\\\\ -2\\Omega_D & 0 & -g & 0 & 0\\\\ 0 & 0 & 0 & \\Omega_D & 0\\\\ 0 & 0 & -\\Omega_D & 0 & \\Omega_N\\\\ 0 & 0 & 0 & -\\Omega_N & 0 \\end{bmatrix} \\end{align*}Choose horizontal speed error $\\delta V_N$ and $\\delta V_E$ as observation \\mathbf{Z}=\\mathbf{H}\\mathbf{X}+\\boldsymbol{\\eta} \\begin{bmatrix} \\delta V_N\\\\ \\delta V_E \\end{bmatrix}= \\begin{bmatrix} 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\\\ 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\end{bmatrix} \\mathbf{X}+ \\begin{bmatrix} \\eta_N\\\\ \\eta_E \\end{bmatrix} $\\mathbf{Z}=[Z_1, Z_2]=[\\delta_{VN}, \\delta_{VE}]$ $\\boldsymbol{\\eta}=[\\eta_N, \\eta_E]$——Measurement noise vector, zero - mean Gauss white noise Integrated navigationRadio navigation - Satellite Navigation Technology Principle: Coordinates of known points Time of signal transmission Speed of signal transmission Working process: Select satellite Search, acquire and track signals from selected satellites Measure pseudo-ranges and make corrections Positioning calculation Error characteristics: Clock error Ephemeris error Atmospheric error Ionospheric delay error Multipath effect GNSS/INS Compare: INS: Autonomy High accuracy in short time Rich navigation information High Reliability High bandwidth Cumulative error High cost GNSS: Low bandwidth Weak anti-interference Low cost High positioning accuracy INS/GNSS integrated navigation Correction of INS Error: method drawbacks Feedback Correction Error states grow may cause error model mis-match Output Correction Errors may occur when estimation haven’t converge Loosely coupled INS/GNSS integration Tightly Coupled INS/GNSS Integration Ultra-Tight INS/GNSS Integration Examples of Integrated navigation \\boldsymbol{\\dot{X}} = \\boldsymbol{AX}+\\boldsymbol{w} \\boldsymbol{Z} = \\boldsymbol{HX}+\\boldsymbol{v}INS output: attitude angles(Euler angles ($\\gamma ,\\, \\theta , \\, \\alpha$), DCM or quaternion), velocity, position The state: X = \\begin{bmatrix} \\psi_E \\\\ \\psi_N \\\\ \\psi_D \\\\ \\delta v_E \\\\ \\delta v_N \\\\ \\delta v_U \\\\ \\delta p_\\lambda \\\\ \\delta p_L \\\\ \\delta p_h \\\\ \\end{bmatrix}INS/Odometer integration for on land vehicle navigation INS/Celestial integration for Aero-Space navigation INS/Magnet integration for Pedestrian navigation SummaryInertial navigationGeneral principles of inertial navigation system Acceleration $\\rightarrow$ velocity $\\rightarrow$ position Gyroscope $\\rightarrow$ attitute Basic concepts of INS (Gimbaled INS，Strap-down INS) Gimbaled inertial navigation system: advantage disadvantage calculation is relatively simple the structure is complex high precision the volume is large the production cost is high Strap-down inertial navigation advantage disadvantage No mechanical platform High requirements for components simple structure and small size large amount of calculation in coordinate transformation easy maintenance Period Type Period Schuler 84.4 $\\text{min}$ Foucault 16.5 $\\text{s}$ Earth 24$\\text{h}$ Schuler frequency $\\sqrt{\\frac{g}{R}}$ Foucault frequency $\\omega_{ie}\\sin L$ Earth frequency $\\omega_{ie}$ Basic concepts Earth model the length of the semi - major axis, $\\quad R$ the length of the semi - minor axis, $\\quad r = R(1 - f)$ the flattening of the ellipsoid, $\\quad f=(R - r)/R$ the major eccentricity of the ellipsoid, $\\quad e = [f(2 - f)]^{1/2}$ Coriolis theorem \\left.\\frac{\\mathrm{d}^2\\mathbf{r}}{\\mathrm{d}t^2}\\right|_{\\mathrm{i}}=\\mathbf{f}+\\mathbf{g}Differentiating this expression and writing $\\left.\\frac{\\mathrm{d}\\mathbf{r}}{\\mathrm{d}t}\\right|_{\\mathrm{e}} = \\mathbf{v}_{\\mathrm{e}}$, we have, \\left.\\frac{\\mathrm{d}^2\\mathbf{r}}{\\mathrm{d}t^2}\\right|_{\\mathrm{i}}=\\left.\\frac{\\mathrm{d}\\mathbf{v}_{\\mathrm{e}}}{\\mathrm{d}t}\\right|_{\\mathrm{i}}+\\left.\\frac{\\mathrm{d}}{\\mathrm{d}t}[\\boldsymbol{\\omega}_{\\mathrm{ie}}\\times\\mathbf{r}]\\right|_{\\mathrm{i}}Absolute velocity = ground speed + implicated velocity Specific force \\mathbf{f}^a=\\mathbf{C}^a_b\\mathbf{f}^bPosition vector in Earth fixed frame — $\\mathbf{r}^e$ Mathematical Platform: \\dot{\\mathbf{C}}^a_b=\\mathbf{C}^a_b\\boldsymbol{\\Omega}^b_{ba} \\boldsymbol{\\Omega}^b_{ba}=\\begin{bmatrix} 0&-\\omega_z&\\omega_y\\\\ \\omega_z&0&-\\omega_x\\\\ -\\omega_y&\\omega_x&0 \\end{bmatrix}\\quad \\text{skew - symmetric matrix} Attitude computation equation \\begin{align*} \\dot{\\mathbf{C}}&=\\mathbf{C}\\boldsymbol{\\Omega}\\\\ \\mathbf{C}_{k + 1}&=\\mathbf{C}_k\\exp\\int_{t_k}^{t_{k + 1}}\\boldsymbol{\\Omega}\\mathrm{d}t\\\\ \\int_{t_k}^{t_{k + 1}}\\boldsymbol{\\Omega}\\mathrm{d}t&=[\\boldsymbol{\\sigma}\\times]\\\\ \\mathbf{C}_{k + 1}&=\\mathbf{C}_k\\exp[\\boldsymbol{\\sigma}\\times]=\\mathbf{C}_k\\mathbf{A}_k\\\\ \\boldsymbol{\\sigma}&=\\sqrt{(\\sigma_x^2+\\sigma_y^2+\\sigma_z^2)}\\\\ \\boldsymbol{\\sigma}\\times&=\\begin{bmatrix} 0 & -\\sigma_z & \\sigma_y\\\\ \\sigma_z & 0 & -\\sigma_x\\\\ -\\sigma_y & \\sigma_x & 0 \\end{bmatrix}\\\\ \\mathbf{A}_k&=\\mathbf{I}+[\\boldsymbol{\\sigma}\\times]+\\frac{[\\boldsymbol{\\sigma}\\times]^2}{2!}-\\frac{\\sigma^2[\\boldsymbol{\\sigma}\\times]}{3!}-\\frac{\\sigma^2[\\boldsymbol{\\sigma}\\times]^2}{4!}+\\cdots \\end{align*} Velocity and Position computation equation \\begin{align*} \\mathbf{v}^n&=\\int_0^t\\mathbf{f}^n\\mathrm{d}t-\\int_0^t[2\\boldsymbol{\\omega}_{ie}+\\boldsymbol{\\omega}_{en}]\\times\\mathbf{v}^n\\mathrm{d}t+\\int_0^t\\mathbf{g}\\mathrm{d}t\\\\ \\mathbf{x}^n&=\\int_0^t\\mathbf{v}^n\\mathrm{d}t \\end{align*}The vectors in the above equations may be expressed in component form as follows: \\begin{align*} \\mathbf{v}^n&=[v_N \\quad v_E \\quad v_D]^T\\\\ \\mathbf{x}^n&=[x_N\\quad x_E\\quad -h]^T\\\\ \\boldsymbol{\\omega}_{ie}&=[\\Omega\\cos L\\quad 0\\quad -\\Omega\\sin L]^T\\\\ \\boldsymbol{\\omega}_{en}&=\\left[\\frac{v_E}{R_0 + h}\\quad \\frac{-v_N}{R_0 + h}\\quad \\frac{-v_E\\tan L}{R_0 + h}\\right]^T\\\\ \\mathbf{g}&=[0\\quad 0\\quad g]^T \\end{align*} Definition of frames The inertial frame(i-frame) The earth frame(e-frame) The navigation frame(n-frame) The body frame(b-frame) Inertial Measurement Sensors Type of gyroscope Sagnac effect: FOG (Fiber optic gyro), RLG (Ring laser gyro) Type of accelerometer Pendulum accelerometer Silicon micro accelerometer Initial AlignmentWhat is initial alignment ? Alignment is the process where by the orientation of the axes of an inertial navigation system is determined with respect to the reference axis system. Why we need initial alignment? It is essential to achieve an accurate alignment of an inertial navigation system within a very short period of time. This is particularly true in many military applications, in which a very rapid response time is often a prime requirement in order to achieve a very short, if not zero, reaction time. 2 steps or stages: coarse alignment fine alignment Error models of INSAngle error $\\phi$: Angle error between body and true Local Geo (n-frame). Angle error $\\psi$: Angle error between body and computed n-frame Horizontal movement Position error as variable Velocity error as variable Mostly the $\\psi$ error model and velocity error model are chosen. During static initial alignment，exact position and velocity are known，thus the error model can be simplified into： Integrated navigationWhat is integrated navigation? What are the advantages of integrated navigation? Integrated navigation employs some additional source of navigation information, external from the inertial system, to improve the accuracy of the inertial navigation system. Typical forms of INS/GNSS navigation Loosely coupled Tightly coupled Ultra-tightly coupled Basic principle of INS/X integrated navigation Basic principles of GNSS How to design a data merging Kalman filter to implement integrated navigation"},{"title":"KF and INS Review Questions(EN)","path":"/notes/kf_rv_q.html","content":"Short answer questions In the prediction step of the Kalman filter, the calculation of the a priori covariance matrix $P_k^-$ is involved. Explain the formula for $P_k^-$ in detail and interpret its physical meaning. ANS Formula: P_k^-=\\Phi P_{k-1}\\Phi^T+QIn this formula: $\\Phi$ is a state transition matrix that describes how the system state changes over time $P_{k-1}$ is the posterior covariance matrix of the previous moment, representing the uncertainty of the previous state estimation $Q$ is the covariance matrix of process noise, representing the uncertainty introduced by model errors or external disturbances. Separate the equation and explain in detail: $\\Phi P_{k-1}\\Phi^T$: The state transition matrix linearly maps the covariance of the previous state to the current state $Q$: represents external disturbances that the system model cannot fully predict Physical meaning: Quantify the uncertainty of predicted states $P_k-$ large: Indicating low confidence in the prediction Otherwise the current state is more credible The error sources in an inertial navigation system (INS) mainly include sensor errors, initial alignment errors, and computational errors. List specific examples of each type of error and propose a compensation method for gyro bias. ANS Sensor errors: Sensor characteristics vary with temperature; Random noise Initial alignment errors: Horizontal alignment error: initial pitch angle/roll angle deviation. Azimuth alignment error: initial heading angle deviation. Computational errors: Integral algorithm error Numerical rounding error Compensation method for gyro bias Using Kalman filtering to fuse external information such as GPS and magnetometer, dynamically estimate and compensate for zero bias; ZUPT: When the carrier is stationary, force the gyroscope output to zero and update the zero bias estimate Assume the body frame is defined as Forward-Left-Up and the navigation frame as North-East-Down. Given a roll angle $\\phi =4^\\circ$, pitch angle $\\theta=-2^\\circ$, and gravitational acceleration $g=9.8m/s^2$, calculate the theoretical output of the vertical accelerometer $f_z^b$. ANSThe gravity vector in the Navigation Coordinate System (NED) is [0 \\quad 0\\quad g]^T = [0\\quad 0\\quad 9.8 \\, \\mathrm{m/s^2}]^TThe DCM of roll angle($\\phi$) and pitch angle($\\theta$): C_n^b = R_x(\\phi) \\cdot R_y(\\theta)Where: R_y(\\theta) = \\begin{bmatrix} \\cos\\theta & 0 & \\sin\\theta \\\\\\\\ 0 & 1 & 0 \\\\\\\\ -\\sin\\theta & 0 & \\cos\\theta \\end{bmatrix} R_x(\\phi) = \\begin{bmatrix} 1 & 0 & 0 \\\\\\\\ 0 & \\cos\\phi & -\\sin\\phi \\\\\\\\ 0 & \\sin\\phi & \\cos\\phi \\end{bmatrix}The component calculation: f_z^b = 9.8 \\times \\cos(4^\\circ) \\times \\cos(-2^\\circ) \\approx 9.77 \\, \\text{m/s}^2 Design a Kalman filter to fuse barometer and INS data: Select the proper observation $Z$ and justify your choice. Design the measurement matrix $H$ and noise covariance matrix $R$ How to determine the state transition matrix $\\Phi$? ANS Observation $Z$: We’d like to use barometer to measure the altitude of the object. So the observation matrix $Z$ can be set as Z = [h_{ins} - h_{bar}] = \\delta p_hand it is a scalar. Why do we choose it? The shortage of the INS: INS obtains altitude and velocity by integrating acceleration, but the integration error accumulates over time, leading to long-term drift. The shortage of the barometer: The barometer directly measures altitude and has good long-term stability, but there are high-frequency noise and delays This choice leverages the barometer’s height measurement to correct INS height errors. The difference $Z$ directly relates to the height error state, making it a natural observation for refining the INS height. Measurement $H$ and noise covariance $R$ The state-space can be set: X = \\begin{bmatrix} \\psi_E \\\\\\\\ \\psi_N \\\\\\\\ \\psi_D \\\\\\\\ \\delta v_E \\\\\\\\ \\delta v_N \\\\\\\\ \\delta v_U \\\\\\\\ \\delta p_\\lambda \\\\\\\\ \\delta p_L \\\\\\\\ \\delta p_h \\\\\\\\ \\end{bmatrix}According to the $Z = HX + R$ H = \\begin{bmatrix} 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 \\end{bmatrix}Since the error is generated by the error of the barometer, we set the variance of the barometer is $\\sigma^2$. Then: R = [\\sigma] = \\sigma The state transition matrix $\\Phi$ The state-space equation: \\boldsymbol{\\dot{X}} = \\boldsymbol{FX}+\\boldsymbol{Gu}Make the model discrete: \\Phi = I + F\\Delta t Multiple-choice questions Which type of error in INS is primarily caused by accelerometer bias over time? A. Velocity random walk B. Position drift C. Attitude oscillation D. Gyro drift ANS B is correct. A. Velocity random walk arises from white - noise - like errors in accelerometers not the bias. C. Attitude oscillation is related to gyroscope performance and angular motion D: Gyro drift pertains to errors in gyroscopes The working principle of a ring laser gyro (RLG) is based on A. Coriolis effect B. Sagnac effect C. Piezoelectric effect D. Hall effect ANS B is correct. A: The Coriolis effect involves the deflection of moving objects in a rotating frame C: The piezoelectric effect generates an electric charge in materials under mechanical stress D: The Hall effect produces a voltage difference in a conductor under a magnetic field Which statement about the Extended Kalman Filter (EKF) is correct? A. It linearizes nonlinear models using Taylor series expansion. B. It is only applicable to linear systems. C. It does not require Jacobian matrices. D. It has higher accuracy than the Unscented Kalman Filter (UKF). ANS A is correct B: The EKF is specifically designed for nonlinear systems. C: The EKF requires Jacobian matrices to perform the linearization of nonlinear functions. D: The Unscented Kalman Filter (UKF) often outperforms the EKF in accuracy for nonlinear systems. The Schuler oscillation period is approximately A. 84 seconds B. 84 minutes C. 24 hours D. 1 hour ANS B is correct Which is NOT a disadvantage of GNSS/INS integration? A. Signal blockage in urban areas B. High short-term accuracy C. Vulnerability to jamming D. Dependency on satellite visibility ANS B is correct A: Signal blockage in urban areas disrupts GNSS signals, impacting the integration. C: GNSS signals can be jammed, compromising the integration. D: GNSS requires satellite visibility; lack of it degrades performance."},{"title":"Robotics(EN)","path":"/notes/robotics.html","content":"Chap1. Spatial Descriptions and TransformationsSec 1.1 Descriptions: Positions, Orientations and Frames Descriptions of a position \\mathbf{^A P} = \\begin{bmatrix} P_x \\\\ P_y \\\\ P_z \\end{bmatrix}Position is represented in a column vector $(n \\times 1)$ Description of an orientation Rotation matrix {}^A_BR = \\left[ {}^A\\widehat{X}_B \\quad {}^A\\widehat{Y}_B \\quad {}^A\\widehat{Z}_B \\right] Properties Transpose of rotation matrix describing $ \\{A\\} $ relative to $\\{ B\\} $ equals to the matrix describing $ \\{ B \\} $ relative to $ \\{ A \\} $ : {}^A_BR = {}^B_AR^T Rotation matrix describing a rectangular coordinate system $\\{A \\} $ relative to another is orthogonal: {}^B_AR^{-1} = {}^B_AR^T Description of a frame A frame (coordinate system) can be described by a vector and a rotation matrix: \\{B\\} = \\{^A_BR, ^A\\mathbf{P}_{BORG}\\} Attention ${}^A_BR(x, \\alpha)$: $\\{B\\}$ rotated counterclockwise about $\\{A\\}$’s x-axis by $\\alpha$ degrees ${}^A_BR(y, \\beta)$: $\\{B\\}$ rotated counterclockwise about $\\{A\\}$’s y-axis by $\\beta$ degrees ${}^A_BR(z, \\gamma)$: $\\{B\\}$ rotated counterclockwise about $\\{A\\}$’s z-axis by $\\gamma$ degrees Rotation Matrices: {}^A_BR(x, \\alpha) = \\begin{bmatrix} 1 & 0 & 0 \\\\ 0 & \\cos\\alpha & -\\sin\\alpha \\\\ 0 & \\sin\\alpha & \\cos\\alpha \\end{bmatrix} {}^A_BR(y, \\beta) = \\begin{bmatrix} \\cos\\beta & 0 & \\sin\\beta \\\\ 0 & 1 & 0 \\\\ -\\sin\\beta & 0 & \\cos\\beta \\end{bmatrix} {}^A_BR(z, \\gamma) = \\begin{bmatrix} \\cos\\gamma & -\\sin\\gamma & 0 \\\\ \\sin\\gamma & \\cos\\gamma & 0 \\\\ 0 & 0 & 1 \\end{bmatrix} Sec 1.2 MappingsMapping changes the description of a point from one frame to another. Mappings involving translated frames If $\\{A\\}$ and $\\{B\\}$ have the same orientation but differ by translation ${}^AP_{BORG}$: ^AP = ^BP + ^AP_{BORG}$$ Mappings involving rotated frames If $\\{A\\}$ and $\\{B\\}$ share the same origin but differ by rotation ${}^A_BR$: {}^AP = {}^A_BR \\, {}^BP Mapings involving general frames For frames differing by both translation and rotation: {}^AP = {}^A_BR \\, {}^BP + {}^AP_{BORG} Homogeneous Transform Matrix: {}^A_BT = \\begin{bmatrix} {}^A_BR & {}^A\\mathbf{P}_{BORG} \\\\ \\mathbf{0} & 1 \\end{bmatrix} \\begin{bmatrix} {}^AP \\\\ 1 \\end{bmatrix} = {}^A_BT \\begin{bmatrix} {}^BP \\\\ 1 \\end{bmatrix} AttentionMapping describes the same point in different frames. Translation and rotation relate frames, not point positions. Sec 1.3 OperatorsOperators translate points, rotate vectors, or both. Translational operators Translating point $P_1$ by ${}^A\\mathbf{Q}$: {}^AP_2 = {}^AP_1 + {}^A\\mathbf{Q}Matrix form: D_Q = \\begin{bmatrix} 1 & 0 & 0 & q_x \\\\ 0 & 1 & 0 & q_y \\\\ 0 & 0 & 1 & q_z \\\\ 0 & 0 & 0 & 1 \\end{bmatrix} \\begin{bmatrix} {}^AP_2 \\\\ 1 \\end{bmatrix} = D_Q \\begin{bmatrix} {}^AP_1 \\\\ 1 \\end{bmatrix} Rotational operators Rotating vector ${}^AP_1$ by $R$: {}^AP_2 = R \\, {}^AP_1$R$ is equivalent to a rotation matrix ${}^A_BR$. Transformation operators Combining translation and rotation: \\begin{bmatrix} {}^AP_2 \\\\ 1 \\end{bmatrix} = T \\begin{bmatrix} {}^AP_1 \\\\ 1 \\end{bmatrix}where $T = \\begin{bmatrix} R &amp; \\mathbf{Q} \\\\ 0 &amp; 1 \\end{bmatrix}$. AttentionOperators act on vectors before transformation, while mappings describe vectors after transformation. Sec 1.4 Transformation Arithmetic Compound Transformation Problem: Transform ${}^CP$ to ${}^AP$ via intermediate frames: {}^A_CT = {}^A_BT {}^B_CT \\begin{bmatrix} {}^AP \\\\ 1 \\end{bmatrix} = {}^A_CT \\begin{bmatrix} {}^CP \\\\ 1 \\end{bmatrix}Fixed reference frame transformations: {}^3_1T = {}^3_2T {}^2_1T Inverse transformation Method 1: ${}^B_AT = {}^A_BT^{-1}$ Method 2: {}^B_AT = \\begin{bmatrix} {}^A_BR^T & -{}^A_BR^T \\, {}^AP_{BORG} \\\\ \\mathbf{0} & 1 \\end{bmatrix} Sec 1.5 More on Representation of Orientation X-Y-Z Fixed Angles Rotate $\\{B\\}$ about fixed axes of $\\{A\\}$ (order: X→Y→Z): {}^A_BR = R(z, \\alpha) R(y, \\beta) R(x, \\gamma) Z-Y-X Euler Angles Rotate $\\{B\\}$ about its own axes (order: Z→Y→X): {}^A_BR = R(z, \\alpha) R(y, \\beta) R(x, \\gamma) Z-Y-Z Euler Angles Rotate $\\{B\\}$ about its own axes (order: Z→Y→Z): {}^A_BR = R(z, \\alpha) R(y, \\beta) R(z, \\gamma) Comparison Chap 2. Manipulator Kinematics"},{"title":"Sensors and Measurement System(EN)","path":"/notes/sensors.html","content":"Chap1 IntroductiomSec 1.1 Definition of measurement systemThe measurement is the process by which one can convert physical parameters to meaningful numbers. A measurement system is an information system which presents an observer with a numerical value corresponding to the variable being measured. Sec 1.2 Structure of measurement system Sensing elements: This is in contact with the process and gives an output which depends in some way on the variable to be measured. Signal conditioning element: This takes the output of the sensing elements and converts it into a form more suitable for further processing. Signal processing element: This takes the output of the conditioning element and converts it into a form more suitable for presentation. Data presentation element: This presents the measured value in a form which can be easily recognized by the observer. Sec 1.3 Applications In regulating trade, i.e. ruler. In monitoring functions, i.e. smoke sensor. Using as part of automatic feedback control systems, i.e. feedback control system. Sec 1.4 Methods of measurement Direct method: The unknown quantity can be measured directly. (like vernier caliper) Indirect method: It can’t be measured directly, but it can be transformed into directly measurable physical quantity by the relation. (like laser range finder) Sec 1.5 Definition of sensors A sensor is a device that receives a stimulus and responds with an electrical signal. A sensor is a translator of a generally nonelectrical value into an electrical value, which can be channeled, amplified, and modified by electronic devices. Sec 1.6 Sensor classification1.6.1 Passive and active Passive sensor: it does not need any additional energy source and directly generates an electric signal in response to an external stimulus. That is, the input stimulus energy is converted by the sensor into the output signal. Active Sensor: it requires external power for its operation, which is called an excitation signal. That signal is modified by the sensor to produce the output signal. 1.6.2 Absolute and relative Absolute sensor: it detects a stimulus in reference to an absolute physical scale that is independent of the measurement conditions. Relative sensor: it produces a signal that relates to some special case. Sec 1.7 Important variables and their units Chap 2 Static characteristicsSec 2.1 Meaning of static characteristic of a measurement system Static or steady-state characteristics; The relationships which may occur between the output $O$ and input $I$ of an element when $I$ is either at a constant value or changing slowly. It consists of systematic characteristic and statistical ones. 2.1.1 Systematic characteristicsThe systematic characteristics can be exactly quantified by mathematical or graphical means. These are distinct from statistical characteristics which can not be exactly quantified. Range: \\text{The input range}: I_{\\text{min}} \\quad \\text{to} \\quad I_{\\text{max}} \\text{The output range}: O_{\\text{min}} \\quad \\text{to} \\quad O_{\\text{max}} Span \\text{The input span}: I_{\\text{max}}- I_{\\text{min}} \\text{The output span}: O_{\\text{max}}- O_{\\text{min}} Usually the relationship between the input and output is monotonic. If not, the system is unsuitable for measuring. We should consider that the maximum input $I_{\\mathrm{max}}$ corresponds to the maximum output $O_{\\mathrm{max}}$. Linearity (Ideal straight line)The ideal straight line connects the minimum point A($I_{MIN}$, $O_{MIN}$) to maximum B($I_{MAX}$, $O_{MAX}$) O_{\\text{IDEAL}} = KI+awhere K = \\text{ideal straight-line slope} = \\frac{O_{\\text{max}}- O_{\\text{min}}}{I_{\\text{max}}- I_{\\text{min}}} a = \\text{ideal straight-line intercept} = O_{\\text{min}} - KI_{\\text{min}} We are only describing the relationship between output and input, not fitting the curve. Non-linearity N(I) = O(I) - (KI+a) \\text{Max non-linearity as a percentage of f.s.d.} = \\frac{\\hat{N}}{O_{\\text{max}}- O_{\\text{min}}} \\times 100\\% Sensitivity This is the change $\\Delta O$ output $O$ for unit change $\\Delta I$ input $I$. If the $\\Delta I$ tends to zero, we can find that the sensitivity $\\Delta O \\setminus \\Delta I$ is the derivative $\\text{d} O \\setminus \\text{d} I$. Hysteresis H(I) = O(I)_{\\downarrow } - O(I)_{\\uparrow } \\text{Max hysteresis as a percentage of f.s.d.} = \\frac{\\hat{H}}{O_{\\text{max}}- O_{\\text{min}}} \\times 100\\% ResolutionThis is defined as largest change in I that can occur without any corresponding change in O. R(I) = \\frac{\\Delta I_{R}}{I_{\\text{max}}- I_{\\text{min}}} \\times 100\\%For example, the ADC converter. Wear and ageing These effects can cause the characteristics of an element, e.g. $K$ and $a$, to change slowly but systematically throughout its life. Error bands Here the manufacturer states that for any value of I, the output $O$ will be within $\\pm h$ of the ideal straight-line value $O_{IDEAL}$. Environment effect The steady-state of output in general is expressed as: O = KI + a + N(I) + K_MI_MI+K_II_IWhere: $K_M$ is the change in sensitivity for unit change in $I_M$; $K_I$ is the change in zero bias for unit change in $I_I$. What is the interfering input $I_I$ and the modifying input $I_M$? Interfering Inputs - Quantities to which instrument is unintentionally sensitive. Modifying Inputs - Quantities which cause changes in Input-Output relations of desired and interfering inputs. 2.2.2 Generalised model of a measurement system O = KI + a+N(I)+K_MI_M + K_IISec 2.2 Statistical characteristics Repeatability This is the ability of an measurement system to give the same output for the same input. Lacking of repeatability is due to random effects in the system and its environment. The most common cause is random fluctuations with time in the environment inputs $I_I$ and $I_M$. Tolerance This effect is found in any batch of ��identical�� sensors or other elements. Significant variations are found in batches of thermocouples and thermistors, for example. Sec 2.3 CalibrationCalibration is a type of experiment to find static characteristics of a sensor or a measurement system by measuring corresponding values of the input $I$, the output $O$ and the environment inputs $I_M$ and $I_I$,when I is constant value or changing slowly. STANDARD: NPL (National Physical Laboratory) Support the manufacture to obtain primary measurement standards for key physical variables such as time, length, mass, current, and temperature NEL (National Engineering Laboratory) Obtain other important industrial variables such as the density and flow rate of gases and liquids UKAS (United Kingdom Accreditation Service) There is a network of laboratories and centers throughout the country which maintain transfer or intermediate standards. Sec 2.4 Experimental measurements and evaluation of results $O$ versus $I$ with $I_M = I_I = 0$ The nonlinearity and hysteresis can be found. $O$ versus $I_M$ ,$I_I$ with constant $I$ Identify $K_I$ The input $I$ is held constant at $I = I_{\\mathrm{MIN}}$, and one environmental input is changed by a known amount, the rest being kept at standard values. If there is a resulting change $\\Delta O$ in $O$, then the input $I_I$ is interfering and the value of the corresponding coefficient $K_I$ is given by $K_I=\\Delta O/\\Delta I_I$. If there is no change in $O$, then the input is not interfering; the process is repeated until all interfering inputs are identified and the corresponding $K_I$ values found. Why the input $I$ is held constant at $I = I_{\\mathrm{MIN}}$? The answer comes from AI Holding $I$ at $I_{\\min}$ sets the element exactly at its zero - bias operating point, so that any subsequent change in $O$ when you vary an environmental input must be due to interference��not simply the normal response to your main signal. Identify $K_M$ The input $I$ is held constant at the mid - range value $1/2(I_{MIN}+I_{MAX})$ and each environmental input is varied in turn by a known amount. If a change in input produces a change $\\Delta O$ in $O$ and is not an interfering input, then it must be a modifying input $I_M$ and the value of the corresponding coefficient $K_M$ is given by: K_M=\\frac{1}{I}\\frac{\\Delta O}{\\Delta I_M}=\\frac{2}{I_{MIN}+I_{MAX}}\\frac{\\Delta O}{\\Delta I_M}Suppose a change is identified as an interfering input with a known value of $K_I$. Then we must calculate a non - zero value of $K_M$ before we can be sure that the input is also modifying. \\begin{align*} \\Delta O&=K_I\\Delta I_{I,M}+K_M\\Delta I_{I,M}\\frac{I_{MIN}+I_{MAX}}{2}\\\\ K_M&=\\frac{2}{I_{MIN}+I_{MAX}}\\left[\\frac{\\Delta O}{\\Delta I_{I,M}}-K_I\\right] \\end{align*}Why the input $I$ is held constant at the mid - range value $1/2(I_{MIN}+I_{MAX})$ ? The answer comes from AI Mid-range gives you the biggest, cleanest ��window�� through which to observe how temperature, humidity, bias voltage, etc., are warping your transducer��s gain��without confusion from endpoint non-linearities or offset shifts. Repeatability test This test should be carried out in the normal working environment of the element. The signal input $I$ should be held constant at mid - range value and the output $O$ measured over an extended period, ideally many days, yielding a set of values $O_k, k = 1,2,\\dots,N$. Chap 3 Dynamic Characteristics"},{"title":"Kalman Filter Introduction","path":"/wiki/kalmanprj/Kalman Intro.html","content":"1 IntroductionThe Kalman filter, first proposed by Rudolf E. Kálmán in 1960, has become one of the most fundamental and widely used algorithms in estimation theory and signal processing. As an optimal recursive estimator, it provides an efficient computational framework for inferring the internal states of dynamic systems from noisy measurements. The fundamental strength of the Kalman filter lies in its ability to combine uncertain predictions with noisy measurements through an elegant probabilistic framework. By maintaining estimates of both the system state and its uncertainty covariance matrix, the filter achieves optimal estimation in the minimum mean-square error (MMSE) sense for linear Gaussian systems. This recursive nature makes it particularly suitable for real-time applications where computational efficiency is crucial. 2 AlgorithmThe Kalman filter operates through a recursive prediction-correction cycle, combining system dynamics with noisy measurements. Consider a discrete-time linear dynamic system described by: \\mathbf{x}_k = \\mathbf{A}\\mathbf{x}_{k-1} + \\mathbf{B}\\mathbf{u}_k + \\mathbf{w}_k \\mathbf{z}_k = \\mathbf{H}\\mathbf{x}_k + \\mathbf{v}_kwhere $\\mathbf{x}_k \\in \\mathbb{R}^n$ is the state vector, $\\mathbf{u}_k \\in \\mathbb{R}^m$ the control input, and $\\mathbf{z}_k \\in \\mathbb{R}^p$ the measurement vector. $\\mathbf{A}$ (state transition), $\\mathbf{B}$ (control input), and $\\mathbf{H}$ (observation) matrices define the system model. Process noise $\\mathbf{w}_k \\sim \\mathcal{N}(0,\\mathbf{Q})$ and measurement noise $\\mathbf{v}_k \\sim \\mathcal{N}(0,\\mathbf{R})$ are independent Gaussian distributions. 2.1 Predict PhaseThe filter first predicts the a priori state estimate and error covariance: \\hat{\\mathbf{x}}^-_k = \\mathbf{A}\\hat{\\mathbf{x}}_{k-1} + \\mathbf{B}\\mathbf{u}_k \\mathbf{P}^-_k = \\mathbf{A}\\mathbf{P}_{k-1}\\mathbf{A}^\\top + \\mathbf{Q}where $\\hat{\\mathbf{x}}^-_k$ represents the predicted state estimate and $\\mathbf{P}^-_k$ the predicted estimate covariance. 2.2 Update PhaseThe measurement update incorporates observations to compute the a posteriori estimate: \\mathbf{K}_k = \\mathbf{P}^-_k\\mathbf{H}^\\top(\\mathbf{H}\\mathbf{P}^-_k\\mathbf{H}^\\top + \\mathbf{R})^{-1} \\hat{\\mathbf{x}}_k = \\hat{\\mathbf{x}}^-_k + \\mathbf{K}_k(\\mathbf{z}_k - \\mathbf{H}\\hat{\\mathbf{x}}^-_k) \\mathbf{P}_k = (\\mathbf{I} - \\mathbf{K}_k\\mathbf{H})\\mathbf{P}^-_kHere, $\\mathbf{K}_k$ denotes the Kalman gain matrix that optimally weights prediction and measurement uncertainties. The innovation term $(\\mathbf{z}_k - \\mathbf{H}\\hat{\\mathbf{x}}^-_k)$ represents the difference between actual and predicted measurements. 2.3 Algorithm Pseudocode"},{"title":"Kalman Filter Simulation Practice","path":"/wiki/kalmanprj/Kalman simulation.html","content":"Project I1. Project DescriptionThe object is initially 40,000$m$ above the radar and throwing at initial vertical downward velocity 300$m/s$ and horizontal velocity 400$m/s$ . In this example we are neglecting drag or air resistance so that only gravity g ( $g$=9.8$m/s^2$) acts on the object.Assuming that the radar measures the range from the radar to the target with a 100$m$ standard deviation measurement accuracy. The radar takes measurement 10 times a second for 30 s. We would like to build a filter to estimate the position and velocity of the object without any a priori information. 2. Modelling State Space: We set the k-th state $\\boldsymbol{x}_k = [P_x\\quad P_y \\quad V_x\\quad V_y]^T_k$, so the (k+1)-th state is \\boldsymbol{x}_{k+1} = [P_x\\quad P_y \\quad V_x\\quad V_y]^T_{k+1}\\quad \\text{Expanded,} \\begin{bmatrix} P_x^{k+1} \\\\ P_y^{k+1}\\\\ V_x^{k+1}\\\\ V_y^{k+1} \\end{bmatrix} = \\begin{bmatrix} P_x^k +V_x^kdt + \\frac{1}{2}a_x(dt)^2\\\\ P_y^k +V_y^kdt + \\frac{1}{2}a_y(dt)^2\\\\ V_x^k + a_xdt\\\\ V_y^k + a_ydt \\end{bmatrix} The control input is $\\boldsymbol{u}_k = [a_x\\quad a_y]^T$. State Transition Matrix: According to the equation $\\boldsymbol{x}_{k+1} = \\mathbf{A}\\boldsymbol{x}_k + \\mathbf{B}\\boldsymbol{u}_k + \\boldsymbol{w}_k$, we can write: \\begin{bmatrix} P_x^{k+1} \\\\ P_y^{k+1}\\\\ V_x^{k+1}\\\\ V_y^{k+1} \\end{bmatrix} = A \\cdot \\begin{bmatrix} P_x^k \\\\ P_y^k\\\\ V_x^k\\\\ V_y^k \\end{bmatrix} + B \\cdot \\begin{bmatrix} a_x\\\\ a_y \\end{bmatrix}So the state transition matrix $\\mathbf{A}$ is: \\mathbf{A} = \\begin{bmatrix} 1 & 0 & dt & 0\\\\ 0 & 1 & 0 & dt\\\\ 0 & 0 & 1 & 0\\\\ 0 & 0 & 0 & 1 \\end{bmatrix} The control input matrix $\\mathbf{B}$ is: \\mathbf{B} = \\begin{bmatrix} \\frac{1}{2}(dt)^2 & 0\\\\ 0 & \\frac{1}{2}(dt)^2\\\\ dt & 0\\\\ 0 & dt \\end{bmatrix} Measurement Model: The measurement model is given by:$\\mathbf{z}_k = \\mathbf{H}\\boldsymbol{x}_k + \\mathbf{v}_k$. where $\\mathbf{H}$ is the measurement matrix. In this case, we only measure the range from the radar to the target, so: $\\boldsymbol{z}_k=\\boldsymbol{x}_k = \\begin{bmatrix}P_x^k\\\\P_y^k\\\\V_x^k\\\\V_y^k\\end{bmatrix}$. eventually we have: $\\mathbf{H} =\\begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; 0\\\\ 0 &amp; 1 &amp; 0 &amp; 0\\\\ 0 &amp; 0 &amp; 1 &amp; 0\\\\ 0 &amp; 0 &amp; 0 &amp; 1\\end{bmatrix}$. Process Noise: The process noise $\\mathbf{w}_k$ is assumed to be Gaussian with zero mean and covariance $\\mathbf{Q}$. We can set $\\mathbf{Q}$ as: \\mathbf{Q} = \\begin{bmatrix} q_{P_x} & 0 & 0 & 0\\\\ 0 & q_{P_y} & 0 & 0\\\\ 0 & 0 & q_{V_x} & 0\\\\ 0 & 0 & 0 & q_{V_y} \\end{bmatrix}where $q_{P_x}$, $q_{P_y}$, $q_{V_x}$, and $q_{V_y}$ are the process noise variances for position and velocity in the x and y directions, respectively. We can set them as: q_{P_x} = 0.1, \\quad q_{P_y} = 0.1, \\quad q_{V_x} = 0.1, \\quad q_{V_y} = 0.1 Measurement Noise: The measurement noise $\\mathbf{v}_k$ is also assumed to be Gaussian with zero mean and covariance $\\mathbf{R}$. We can set $\\mathbf{R}$ as: \\mathbf{R} = \\begin{bmatrix} r_{P_x} & 0 & 0 & 0\\\\ 0 & r_{P_y} & 0 & 0\\\\ 0 & 0 & r_{V_x} & 0\\\\ 0 & 0 & 0 & r_{V_y} \\end{bmatrix}where $r_{P_x}$, $r_{P_y}$, $r_{V_x}$, and $r_{V_y}$ are the measurement noise variances for position and velocity in the x and y directions, respectively. We can set them as: r_{P_x} = 100, \\quad r_{P_y} = 100, \\quad r_{V_x} = 100, \\quad r_{V_y} = 100 Initial State: The initial state $\\boldsymbol{x}_0$ is given by the initial position and velocity of the object. We can set it as: \\boldsymbol{x}_0 = \\begin{bmatrix} P_x\\\\ P_y\\\\ V_x\\\\ V_y \\end{bmatrix} = \\begin{bmatrix} 0\\\\ 40000\\\\ 400\\\\ -300 \\end{bmatrix}where $P_x$ is the initial position in the x direction, $P_y$ is the initial position in the y direction, $V_x$ is the initial velocity in the x direction, and $V_y$ is the initial velocity in the y direction. And the control input $\\boldsymbol{u}_0$ is given by the initial acceleration of the object. We can set it as: \\boldsymbol{u}_0 = \\begin{bmatrix} a_x\\\\ a_y \\end{bmatrix} = \\begin{bmatrix} 0\\\\ -9.8 \\end{bmatrix}where $a_x$ is the acceleration in the x direction and $a_y$ is the acceleration in the y direction. Initial Covariance: The initial covariance $\\mathbf{P}_0$ is given by the initial uncertainty of the state. We can set it as: \\mathbf{P}_0 = \\begin{bmatrix} p_{P_x} & 0 & 0 & 0\\\\ 0 & p_{P_y} & 0 & 0\\\\ 0 & 0 & p_{V_x} & 0\\\\ 0 & 0 & 0 & p_{V_y} \\end{bmatrix}where $p_{P_x}$, $p_{P_y}$, $p_{V_x}$, and $p_{V_y}$ are the initial covariance values for position and velocity in the x and y directions, respectively. We can set them as: p_{P_x} = 0.1, \\quad p_{P_y} = 0.1, \\quad p_{V_x} = 0.1, \\quad p_{V_y} = 0.13. Results:Position estimation: Velocity estimation: Project II1. Project DescriptionSuppose that the actual measurement is a pure cosine wave of unity amplitude corrupted by noise or where $\\omega$ is the frequency of the cosinusoidal signal and the noise is zero-mean Gaussian with a standard deviation of unity. We would like to build a Kalman filter that will be able to track the cosinusoidal and estimate its states based on the noisy cosinusoidal measurement. \\boldsymbol{x}^{*} = \\cos (\\omega t) + \\textbf{noise}2. Modelling State Space We set the k-th state $\\boldsymbol{x}_k = [x_1\\quad x_2]^T_k$. The components of the state vector are: \\begin{bmatrix} x_1\\\\ x_2 \\end{bmatrix} = \\begin{bmatrix} \\cos(\\omega t)\\\\ \\sin(\\omega t) \\end{bmatrix}The components meet the relationship: \\left\\{\\begin{matrix} \\dot{x_1} (t) = -\\omega x_2(t)\\\\ \\dot{x_2} (t) = -\\omega x_1(t) \\end{matrix}\\right.The (k+1)-th state is $\\boldsymbol{x}_{k+1}$ is given by: \\boldsymbol{x}_{k+1} = \\begin{bmatrix} \\cos\\omega (t + dt)\\\\ \\sin\\omega (t + dt) \\end{bmatrix} = \\begin{bmatrix} \\cos \\omega t \\sin \\omega dt - \\sin\\omega t \\sin \\omega dt\\\\ \\sin \\omega t \\cos \\omega dt + \\cos\\omega t \\sin \\omega dt \\end{bmatrix} State Transition Matrix: According to the equation $\\boldsymbol{x}_{k+1} = \\mathbf{A}\\boldsymbol{x}_k + \\mathbf{B}\\boldsymbol{u}_k + \\boldsymbol{w}_k$, since the control input is zero, we can write: \\begin{bmatrix} \\cos \\omega t \\sin \\omega dt - \\sin\\omega t \\sin \\omega dt\\\\ \\sin \\omega t \\cos \\omega dt + \\cos\\omega t \\sin \\omega dt \\end{bmatrix} = \\mathbf{A} \\cdot \\begin{bmatrix} \\cos(\\omega t)\\\\ \\sin(\\omega t) \\end{bmatrix}So the state transition matrix $\\mathbf{A}$ is: \\mathbf{A} = \\begin{bmatrix} \\cos\\omega dt & -\\sin\\omega dt\\\\ \\sin\\omega dt & \\cos\\omega dt \\end{bmatrix} Measurement Model: The measurement model is given by:$\\mathbf{z}_k = \\mathbf{H}\\boldsymbol{x}_k + \\mathbf{v}_k$. where $\\mathbf{H}$ is the measurement matrix. In this case, we only measure the range from the radar to the target, so: $ \\boldsymbol{z}_k=\\boldsymbol{x}_k = \\begin{bmatrix} x_1\\\\ x_2 \\end{bmatrix}$. eventually we have: $\\mathbf{H} = \\begin{bmatrix} 1 &amp; 0 \\end{bmatrix}$. Process Noise: The process noise $\\mathbf{w}_k$ is assumed to be Gaussian with zero mean and covariance $\\mathbf{Q}$. We can set $\\mathbf{Q}$ as: \\mathbf{Q} = \\begin{bmatrix} q_{x_1} & 0\\\\ 0 & q_{x_2} \\end{bmatrix}where $q_{x_1}$ and $q_{x_2}$ are the process noise variances in the two component states, respectively. We can set them as: q_{x_1} = 10^{-3}, \\quad q_{x_2} = 10^{-3} Measurement Noise: The measurement noise $\\mathbf{v}_k$ is also assumed to be Gaussian with zero mean and covariance $\\mathbf{R}$. We can set $\\mathbf{R}$ as: \\mathbf{R} = \\begin{bmatrix} r_{x} \\end{bmatrix}where $r_{x}$ are the measurement noise variances in the measure state. We can set: r_{x} = 1 Initial State: The initial state $\\boldsymbol{x}_0$ is given by the initial state. We can set it as: \\boldsymbol{x}_0 = \\begin{bmatrix} x_1\\\\ x_2 \\end{bmatrix} = \\begin{bmatrix} 1\\\\ 0 \\end{bmatrix}where $x_1$ is the initial state in the first component and $x_2$ is the initial state in the second component.(The initial state is the cosine wave at $t=0$) Initial Covariance: The initial covariance $\\mathbf{P}_0$ is given by the initial uncertainty of the state. We can set it as: \\mathbf{P}_0 = \\begin{bmatrix} p_{x_1} & 0\\\\ 0 & p_{x_2} \\end{bmatrix}where $p_{x_1}$ and $p_{x_2}$ are the initial covariance values for the two component states, respectively. We can set them as: p_{x_1} = 1, \\quad p_{x_2} = 13. Results"},{"title":"16届蓝桥杯模拟试题1","path":"/wiki/lanqiao/16moni_1.html","content":"原题请在80MHz主频下完成以下任务 功能要求： 功能概述： 通过微控制器的ADC功能，检测电位器R37上输出的模拟电压信号; 通过板载AT24C02 EEPROM芯片，存储密码值; 依试题要求，通过LCD完成数据显示等功能; 依试题要求通过按键完成参数设置功能; 依试题要求，通过LED完成状态指示功能。 性能要求： 按键响应时间:≤0.1秒 电压采集刷新时间:≤0.5秒 AT24C02:数据掉电不丢失 显示功能： 输入界面：显示要素包含界面名称(Lock)，输入密码(Pass Word)。输入密码值从左往右输入，未输入的密码值使用”*”代替。 修改界面：显示要素包含界面名称(Set)，待修改密码(Change)。修改密码值从左往右输入，未输入的修改密码值使用“*”代替。 LCD通用要求： 显示背景色(BackColor):黑色 显示前景色(TextColor):白色 请严格按照图示要求设计各个信息项的名称(区分字母大小写)和行列位置。 密码机制：使用微控制器的ADC功能读取电位器R37的电压值，经转换关系转化后作为输入的密码：输入界面输入密码与修改界面输入密码的机制相同。 存储功能：当前密码值存储于AT24C02的指定位置，密码数据掉电不丢失，存储表如下图所示。 解锁功能： 输入界面下，完成三位密码值输入后自动尝试解锁，若输入密码值和存储密码值一致，则进入修改界面，否则输入的密码值更置为“*”，可以重新开始输入密码。 进入修改界面后3秒不进行修改密码操作则返回输入界面。 按键功能 B1:定义为“确认”按键： 在输入界面，按下B1按键，确定一位输入密码。 在修改界面，按下B1按键，确定一位修改的密码。若三位修改密码值输入完成，则将密码值修改成功，同时对当前密码值进行存储，并返回到输入界面。 通用按键要求： 按键应进行有效的防抖处理，避免出现一次按键动作触发多次功能等情形。 按键动作不应影响数据采集过程和屏幕显示效果。 当前界面下无功能的按键按下，不触发其它界面的功能。 LED功能 LD1:处于输入界面时，指示灯LD1点亮，否则熄灭。 LD2:处于修改界面时，指示灯LD2点亮，否则熄灭。 LD3-LD8指示灯。 初始状态说明： 请严格按照以下要求设置作品的初始状态： 处于输入界面 初始状态密码默认为：012 设计思路Cubemx配置： 时钟树配置 引脚配置 LED模块在cubemx中配置好时钟和引脚后，新建工程文件，打开工程文件，新增文件“led.c”和“led.h”。 led.c123456789101112#include &quot;led.h&quot;void LED_Disp(uint8_t led)&#123;\tHAL_GPIO_WritePin(GPIOC, 0xff&lt;&lt;8, GPIO_PIN_SET);\tHAL_GPIO_WritePin(GPIOD, GPIO_PIN_2, GPIO_PIN_SET);\tHAL_GPIO_WritePin(GPIOD, GPIO_PIN_2, GPIO_PIN_RESET); HAL_GPIO_WritePin(GPIOC, led&lt;&lt;8, GPIO_PIN_RESET);\tHAL_GPIO_WritePin(GPIOD, GPIO_PIN_2, GPIO_PIN_SET);\tHAL_GPIO_WritePin(GPIOD, GPIO_PIN_2, GPIO_PIN_RESET);&#125; led.h1234567#ifndef __LED_H#define __LED_H#include &quot;main.h&quot;void LED_Disp(uint8_t led);#endif 按键模块新建文件“key.c”和“key.h”，由于只需要按键单击，所以我们的按键驱动可以简写： key.c123456789101112131415161718192021222324252627282930313233#include &quot;key.h&quot;struct keys key[4] = &#123;0,0,0,0&#125;;void key_state(void)&#123;\tkey[0].key_state = HAL_GPIO_ReadPin(GPIOB,GPIO_PIN_0);\tkey[1].key_state = HAL_GPIO_ReadPin(GPIOB,GPIO_PIN_1);\tkey[2].key_state = HAL_GPIO_ReadPin(GPIOB,GPIO_PIN_2);\tkey[3].key_state = HAL_GPIO_ReadPin(GPIOA,GPIO_PIN_0); for(uint8_t i = 0; i&lt; 4; i++)\t&#123; switch(key[i].judge_state) &#123; case 0: if(key[i].key_state == 0) &#123; key[i].judge_state =1; &#125; break; case 1: if(key[i].key_state == 1) &#123; key[i].key_ispressed = 1; key[i].judge_state = 0; &#125; break; default:break; &#125;\t&#125; &#125; key.h123456789101112131415161718#ifndef __KEY_H#define __KEY_H#include &quot;main.h&quot;struct keys&#123;\tuint8_t judge_state;\tuint8_t key_state;\tuint8_t key_ispressed;&#125;;extern struct keys key[];void key_state(void);#endif ADC电压捕获配置打开生成的“adc.c”文件，在用户代码区增加ADC捕获函数： adc.c12345678910/* USER CODE BEGIN 1 */double getADC(ADC_HandleTypeDef *pin)&#123;\tuint16_t adc;\tHAL_ADC_Start(pin);\tadc = HAL_ADC_GetValue(pin);\treturn adc*3.3/4096;&#125;/* USER CODE END 1 */ 记住需要在“adc.h”中增加声明。 e2prom模块将赛点资源包中的i2c驱动放到项目文件夹中，并导入到项目： 新建“e2prom.c”和“e2prom.h”文件： e2prom.c123456789101112131415161718192021222324252627282930313233343536#include &quot;e2prom.h&quot;#include &quot;i2c_hal.h&quot;void e2prom_write(uint8_t addr, uint8_t data)&#123;\tI2CStart();\tI2CSendByte(0xa0);\tI2CWaitAck(); I2CSendByte(addr);\tI2CWaitAck();\tI2CSendByte(data);\tI2CWaitAck();\tI2CStop();&#125;uint8_t e2prom_read(uint8_t addr)&#123;\tuint8_t val;\tI2CStart();\tI2CSendByte(0xa0);\tI2CWaitAck(); I2CSendByte(addr);\tI2CWaitAck();\tI2CStop(); I2CStart();\tI2CSendByte(0xa1);\tI2CWaitAck();\tval = I2CReceiveByte();\tI2CSendNotAck();\tI2CStop(); return val;&#125; e2prom.h123456789#ifndef __E2PROM_H#define __E2PROM_H#include &quot;main.h&quot;void e2prom_write(uint8_t addr, uint8_t data);uint8_t e2prom_read(uint8_t addr);#endif 主函数LCD显示与程序主体同样的，我们把“lcd.c”和“lcd.h”放入项目文件夹和项目文件中，在主函数用户编辑区，增加lcd显示函数用于显示屏幕内容： main.c12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273void LCD_Page(void)&#123;\tchar buf[20]; switch(page_flag)\t&#123; case 0: sprintf(buf,&quot; Lock &quot;); LCD_DisplayStringLine(Line1, (uint8_t *)buf); sprintf(buf,&quot; Pass Word &quot;); LCD_DisplayStringLine(Line3,(uint8_t *)buf); if(password1_flag == 1 &amp;&amp; password2_flag == 0 &amp;&amp; password3_flag == 0) &#123; sprintf(buf,&quot; %d * * &quot;,password[0]); LCD_DisplayStringLine(Line4,(uint8_t *)buf); &#125; if(password1_flag == 1 &amp;&amp; password2_flag == 1 &amp;&amp; password3_flag == 0) &#123; sprintf(buf,&quot; %d %d * &quot;,password[0],password[1]); LCD_DisplayStringLine(Line4,(uint8_t *)buf); &#125; if(password1_flag == 1 &amp;&amp; password2_flag == 1 &amp;&amp; password3_flag == 1) &#123; sprintf(buf,&quot; %d %d %d &quot;,password[0],password[1],password[2]); LCD_DisplayStringLine(Line4,(uint8_t *)buf); if(password[0] == password_saved[0] &amp;&amp; password[1] == password_saved[1] &amp;&amp; password[2] == password_saved[2]) page_flag = 1, password1_flag = 0, password2_flag = 0, password3_flag = 0, password[0] = 0, password[1] = 0, password[2] = 0; else password1_flag = 0, password2_flag = 0, password3_flag = 0, password[0] = 0, password[1] = 0, password[2] = 0 ; &#125; if(password1_flag == 0 &amp;&amp; password2_flag == 0 &amp;&amp; password3_flag == 0) &#123; sprintf(buf,&quot; * * * &quot;); LCD_DisplayStringLine(Line4,(uint8_t *)buf); &#125; LED_Disp(0x01); break; case 1: sprintf(buf,&quot; Set &quot;); LCD_DisplayStringLine(Line1, (uint8_t *)buf); sprintf(buf,&quot; Change &quot;); LCD_DisplayStringLine(Line3,(uint8_t *)buf); if(password1_flag == 1 &amp;&amp; password2_flag == 0 &amp;&amp; password3_flag == 0) &#123; sprintf(buf,&quot; %d * * &quot;,password_saved[0]); LCD_DisplayStringLine(Line4,(uint8_t *)buf); &#125; if(password1_flag == 1 &amp;&amp; password2_flag == 1 &amp;&amp; password3_flag == 0) &#123; sprintf(buf,&quot; %d %d * &quot;,password_saved[0],password_saved[1]); LCD_DisplayStringLine(Line4,(uint8_t *)buf); &#125; if(password1_flag == 1 &amp;&amp; password2_flag == 1 &amp;&amp; password3_flag == 1) &#123; sprintf(buf,&quot; %d %d %d &quot;,password_saved[0],password_saved[1],password_saved[2]); LCD_DisplayStringLine(Line4,(uint8_t *)buf); page_flag = 0; password1_flag = 0, password2_flag = 0, password3_flag = 0; &#125; if(password1_flag == 0 &amp;&amp; password2_flag == 0 &amp;&amp; password3_flag == 0) &#123; sprintf(buf,&quot; * * * &quot;); LCD_DisplayStringLine(Line4,(uint8_t *)buf); if(timer &gt;=3000) &#123; page_flag = 0; timer = 0; &#125; &#125; save_Password(); LED_Disp(0x02); break; default:break;\t&#125;&#125; 这里的设计思路是： page_flag 标志用于切换“Pass Word”界面和“Change”界面； password_flag1 到 password_flag3是三个密码的输入标志，对应每一位密码，在该位密码输入后密码输入标志置1； 三位密码标志全部置1后判断输入的密码和存储的密码是否相等，相等进入设置界面；无论如何都会清零密码输入标志； 设置界面也是相同思路； 如何实现3s不设置密码返回？设置设置密码界面标志位，进入密码设置界面后标志置1，滴答计时器开始计时，当计时3s时且没有输入密码（密码输入标志位均为0），界面标志位置0返回输入密码界面。 密码输入模块在主函数中用户编辑区，main.c12345678910111213141516171819202122232425void enter_Password(void)&#123;\tr37 = getADC(&amp;hadc2);\tif(key[0].key_ispressed == 1)\t&#123; key[0].key_ispressed = 0; i++; password[i-1] = get_Password(r37); switch(i) &#123; case 1: password1_flag = 1; break; case 2: password2_flag = 1; break; case 3: password3_flag = 1; break; default:break; &#125; if(i&gt;=3) i = 0;\t&#125;&#125;每按下一次B1按键，i都自增1，设置密码输入标志位。根据当前的r37的电压确定密码： main.c12345678uint8_t get_Password(double adc)&#123;\tuint8_t password_value;\tif(adc &lt; 1.5) password_value = 0;\tif(adc&gt;=1.5 &amp;&amp; adc &lt;=2.5) password_value = 1;\tif(adc &gt; 2.5) password_value = 2;\treturn password_value;&#125; 密码存储与读取功能存储密码：在上面的密码输入函数后面添加将数组内容写入eeprom的内容。main.c12345678910111213141516171819202122232425262728293031void save_Password(void)&#123;\tr37 = getADC(&amp;hadc2);\tif(key[0].key_ispressed == 1)\t&#123; key[0].key_ispressed = 0; i++; password_saved[i-1] = get_Password(r37); switch(i) &#123; case 1: password1_flag = 1; break; case 2: password2_flag = 1; break; case 3: password3_flag = 1; break; default:break; &#125; if(i&gt;=3) i = 0;\t&#125;\te2prom_write(0x00, password_saved[0]);\tHAL_Delay(10);\te2prom_write(0x01, password_saved[1]);\tHAL_Delay(10);\te2prom_write(0x02, password_saved[2]);\tHAL_Delay(10);&#125;密码读取：main.c12345678910void read_Password(void)&#123;\tHAL_Delay(10);\tpassword_saved[0] = e2prom_read(0x00);\tHAL_Delay(10);\tpassword_saved[1] = e2prom_read(0x01);\tHAL_Delay(10);\tpassword_saved[2] = e2prom_read(0x02);\tHAL_Delay(10);&#125;初始密码设置：这里设置一个标志位，在进入循环之前查看eeprom里是否存在该标志，如果不存在，则表示第一次写入；否则不是第一次写入。main.c123456789101112131415161718192021222324252627int main&#123;\t...\tif(e2prom_read(0x21) != 4) // 判断是否时第一次写入\t&#123; e2prom_write(0x21,4); HAL_Delay(10); initial_password();\t&#125;\t...\twhile (1)\t...&#125;...void initial_password(void)&#123;\tHAL_Delay(10);\te2prom_write(0x00, 0);\tHAL_Delay(10);\te2prom_write(0x01, 1);\tHAL_Delay(10);\te2prom_write(0x02, 2);\tHAL_Delay(10);&#125; 项目源文件将这些文件综合一下就可以完成这一题，在4T评测网中这题也是满分。 源文件"},{"title":"ADC","path":"/wiki/lanqiao/ADC.html","content":"嵌入式ADC在cubemx中选择PB12，PB15分别设置为ADC输出模式（ADC1_IN11和ADC2_IN15） 生成代码后，在adc.c文件中写单通道采样函数，需要在adc.h文件中声明 1234567double getADC(ADC_HandleTypeDef *pin)&#123; uint16_t adc; HAL_ADC_Start(pin); adc = HAL_ADC_GetValue(pin); return adc*3.3/4096;&#125; 在主函数中，用ACD_Proc()调用采样功能 12345678void ADC_Proc(void)&#123; char text[20]; adc_value1 = getADC(&amp;hadc1); adc_value2 = getADC(&amp;hadc2); sprintf(text,&quot;ADC1:%.2f,ADC2:%.2f&quot;,adc_value1,adc_value2); LCD_DisplayStringLine(Line4,(uint8_t *)text);&#125; 需要注意的是，记得在adc.c中使用校准函数对采样进行校准，否则采样最大值为3.25V 123456/* USER CODE BEGIN ADC1_Init 2 */HAL_ADCEx_Calibration_Start(&amp;hadc1,ADC_SINGLE_ENDED);/* USER CODE END ADC1_Init 2 *//* USER CODE BEGIN ADC2_Init 2 */HAL_ADCEx_Calibration_Start(&amp;hadc2,ADC_SINGLE_ENDED);/* USER CODE END ADC2_Init 2 */"},{"title":"IIC","path":"/wiki/lanqiao/IIC.html","content":"嵌入式IIC通信与EEPROM的读写I2C总线是一种双向二线制的同步串行总线，它只需要两根线即可在连接于总线上的器件之间传送信息。（SDA和SCL） 关键是读懂EEPROM的读写时序。 对照着时序图，我们可以写出与EEPROM进行读写数据的函数： 12345678910111213//写函数void e2prom_write(unsigned char address, unsigned char info)&#123; I2CStart(); //1.I2C起始信号(START) I2CSendByte(0xa0); //2.发送设备地址与“写”信号(DEVICE ADDRESS+WRITE)，将在下文解释 I2CWaitAck(); //3.IC2等待确认信号(ACK) I2CSendByte(address); //4.发送数据存储地址(WORD ADDRESS)（可以为0~255，对应256个） I2CWaitAck(); //5.I2C等待确认信号(ACK) I2CSendByte(info); //6.发送数据(DATA) I2CWaitAck(); //7.I2C等待确认信号(ACK) I2CStop(); //8.I2C结束信号(STOP)&#125; 12345678910111213141516171819202122//读函数unsigned char e2prom_read(unsigned char address)&#123; unsigned char val; I2CStart(); //1.I2C起始信号(START) I2CSendByte(0xa0); //2.发送设备地址与“写”信号(DEVICE ADDRESS+WR-TE)，将在下文解释 I2CWaitAck(); //3.IC2等待确认信号(ACK) I2CSendByte(address); //4.发送数据存储地址(WORD ADDRESS)（可以为0~255，对应256个） I2CWaitAck(); //5.I2C等待确认信号(ACK) I2CStop(); //下一次发送起始信号前先停止 I2CStart(); //6.I2C起始信号(START) I2CSendByte(0xa1); //7.发送设备地址与“读”信号(DEVICE ADDRESS+READ)，将在下文解释 I2CWaitAck(); //8.I2C等待确认信号(ACK) val = I2CReceiveByte(); //9.接收数据(DATA) I2CSendNotAck(); //10.I2C发送非确认信号(NO ACK) I2CStop(); //11.I2C结束信号(STOP) return (val);&#125; 注意，EEPROM每一个地址只能读取8位无符号数，16位或者32位需要进行分割 在实际使用中，每一次的EEPROM的读写都需要时间，在具体程序中需要进延时操作。"},{"title":"KEY","path":"/wiki/lanqiao/KEY.html","content":"嵌入式按键使用按键状态机，在用户区新建Key_State.c和Key_State.h文件。在Key_State.h中，写下 123456789101112131415161718192021222324252627#ifndef __KEY_STATE_H_#define __KEY_STATE_H_#include &quot;main.h&quot;/** * @brief 按键状态结构体 */struct keys&#123; uint8_t judge_state; // 状态机标志，0： 检测到一个低电平；1：确实被按下；2：等待抬起 uint8_t key_state; // 按键是否被按下（信号来自GPIO输入） uint8_t key_isPressed; // 按键短按标志位 uint8_t key_long_flag; // 按键长按标志位 uint32_t key_time; // 按键计时 uint32_t key_double_click_time; // 双击计时器 uint8_t key_double_click_EN; // 双击计时器使能 uint8_t key_double_click_flag; // 双击标志位&#125;;extern struct keys key[];void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim);#endif keys结构体即为按键状态机，使用定时中断函数进行按键消抖。 Key_State.c内容 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081#include &quot;Key_State.h&quot;struct keys key[4] = &#123;0, 0, 0, 0&#125;;/** * @brief TIM定时器定时中断回调函数 */void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)&#123; if (htim-&gt;Instance == TIM3) &#123; key[0].key_state = HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_0); key[1].key_state = HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_1); key[2].key_state = HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_2); key[3].key_state = HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0); for (uint8_t i = 0; i &lt; 4; i ++) &#123; if (key[i].key_double_click_EN == 1) // 计数器使能开启时，计时并判断 &#123; key[i].key_double_click_time ++; if (key[i].key_double_click_time &gt; 35) // 如果超时，则说明是短按，置标志位后关闭计数器使能 &#123; key[i].key_isPressed = 1; key[i].key_double_click_EN = 0; &#125; &#125; switch (key[i].judge_state) &#123; case 0: if (key[i].key_state == 0) // 如果刚开始检测到一个低电平 &#123; key[i].key_time = 0; // 时间计数清0 key[i].judge_state = 1; &#125; break; case 1: if (key[i].key_state == 0) // 如果10ms后依然检测到这个按键是低电平，就说明这个按键确实被按下了 &#123; key[i].judge_state = 2; &#125; else &#123; key[i].judge_state = 0; &#125; break; case 2: if (key[i].key_state == 1 &amp;&amp; key[i].key_time &lt;= 70) // 如果是一次短按 &#123; key[i].judge_state = 0; if (key[i].key_double_click_EN == 0) // 如果是第一次按下 &#123; key[i].key_double_click_EN = 1; key[i].key_double_click_time = 0; &#125; else // 双击计时开启，说明这次短按还在双击计时的时间范围内 &#123; key[i].key_double_click_EN = 0; key[i].key_double_click_flag = 1; &#125; &#125; else if (key[i].key_state == 1 &amp;&amp; key[i].key_time &gt; 70) // 长按松开按键，则回到state0 &#123; key[i].judge_state = 0; &#125; else if (key[i].key_state == 0) // 如果按键没有松开，则持续计时 &#123; key[i].key_time ++; if (key[i].key_time &gt; 70) // 如果按键按下时间大于700ms &#123; key[i].key_long_flag = 1; &#125; &#125; break; default: break; &#125; &#125; &#125;&#125; 记住要在cubemx中设置10ms中断，其中PSC预分频是79（80-1），ARR重装预载是9999（10000-1）。以及加入初始化函数： 1HAL_TIM_Base_Start_IT(&amp;htim3);"},{"title":"LED","path":"/wiki/lanqiao/LED.html","content":"LED操作在cubemx中配置时钟和引脚，LED低电平有效 注意要打开PD2锁存器 基本写法： 123456void LED(uint8_t dsled)&#123; HAL_GPIO_WritePin(GPIOD, GPIO_PIN_2, GPIO_PIN_SET); //打开锁存器 HAL_GPIO_WritePin(GPIOC, GPIO_PIN_All, GPIO_PIN_SET); //灭掉所有的LED HAL_GPIO_WritePin(GPIOC, dsled&lt;&lt;8, GPIO_PIN_RESET); //选择特定的LED亮起&#125; 其中dsled是8位无符号数，0x_ _。 高位即为左边四个led，低位即为右边四个led。每一位取1即为该led亮。 LED交替闪烁和LED闪烁取反 ~ 左四位和右四位交替闪烁 取异或^该位led闪烁 1234567891011uint8_t ucLed=0x0f; //交替闪烁LED(~ucLed); //闪烁uint8_t ucLed2 = 0x0f;LED(ucLed2);HAL_Delay(1000);ucLed2^=0x0f; LED实现流水灯位运算左移和右移（&lt;&lt;和&gt;&gt;） Systick 滴答计时HAL_Delay()是阻塞赋值，可以使用Systick进行计时，Systick进行了已经设置了1ms的中断。 计时方式 12345678910111213141516171819202122232425262728293031//在文件：stm32g4xx_it.c中/* USER CODE BEGIN PV */extern uint32_t usled;/* USER CODE END PV */void SysTick_Handler(void)&#123;/* USER CODE BEGIN SysTick_IRQn 0 *//* USER CODE END SysTick_IRQn 0 */ HAL_IncTick();/* USER CODE BEGIN SysTick_IRQn 1 */ usled++;//实现usled每隔1ms自增1/* USER CODE END SysTick_IRQn 1 */&#125;//在文件main.c中/* USER CODE BEGIN PV */uint32_t usled;uint8_t ucled=0x01;/* USER CODE END PV *//* USER CODE BEGIN 3 */Led_Disp(ucled);if(usled&gt;=500)//500ms到&#123; usled=0;//重新计数 ucled^=0x01;//反转led1&#125;/* USER CODE END 3 */ 解决LED引脚冲突问题修改PD2引脚为低电平 将LED显示函数改成如下： 12345678910void Led_Disp(uint8_t ucled)&#123; HAL_GPIO_WritePin(GPIOC,0xFF&lt;&lt;8,GPIO_PIN_SET); HAL_GPIO_WritePin(GPIOD,GPIO_PIN_2,GPIO_PIN_SET); HAL_GPIO_WritePin(GPIOD,GPIO_PIN_2,GPIO_PIN_RESET); HAL_GPIO_WritePin(GPIOC,ucled&lt;&lt;8,GPIO_PIN_RESET); HAL_GPIO_WritePin(GPIOD,GPIO_PIN_2,GPIO_PIN_SET); HAL_GPIO_WritePin(GPIOD,GPIO_PIN_2,GPIO_PIN_RESET);&#125; 增加了重写PD2引脚高低电平的函数 如何单独对一个8bit数的一位进行操作参考文章STM32单片机修改寄存器的位操作方法(全网最全)_单片机单独操作位-CSDN博客 把某位清零 123456//定义一个变量 a = 1001 1111 b (二进制数)unsigned char a = 0x9f;//对 bit2 清零a &amp;= ~(1&lt;&lt;2); 把连续几位清零 123456789//若把 a 中的二进制位分成 2 个一组//即 bit0、bit1 为第 0 组，bit2、bit 为第 1 组，// bit4、bit5 为第 2 组，bit6、bit7 为第 3 组//要对第 1 组的 bit2、bit3 清零a &amp;= ~(3&lt;&lt;2*1);//例如对第 2 组 bit4、bit5 清零a &amp;= ~(3&lt;&lt;2*2); 对某几位赋值 12345//a = 1000 0011 b//此时对清零后的第 2 组 bit4、bit5 设置成二进制数“01 b ”a |= (1&lt;&lt;2*2);//a = 1001 0011 b，成功设置了第 2 组的值，其它组不变 对某位取反 12345//a = 1001 0011 b//把 bit7 取反，其它位不变a ^=(1&lt;&lt;6);//a = 1101 0011 b"},{"title":"RTC","path":"/wiki/lanqiao/RTC.html","content":"嵌入式RTCRTC实时时钟用来获取时间和日期 cubemx RTC配置 其中Calendar Time是当前时间，Calendar Date为当前日期 记住General中的异步分频（APV）是125，同步分频（SPV）是6000 接着，在keil中先配置时间结构体 1234/* USER CODE BEGIN PTD */RTC_TimeTypeDef time; //时间结构体RTC_DateTypeDef date; //日期结构体/* USER CODE END PTD */ 然后在主循环中进行实时计时： 12345678910111213 while (1) &#123; /* USER CODE END WHILE */ /* USER CODE BEGIN 3 */HAL_RTC_GetTime(&amp;hrtc,&amp;time,RTC_FORMAT_BIN);HAL_RTC_GetDate(&amp;hrtc,&amp;date,RTC_FORMAT_BIN);sprintf(buf,&quot;Date:%2d-%2d-%2d &quot;,date.Year,date.Month,date.Date);LCD_DisplayStringLine(Line1,(uint8_t*)buf);sprintf(buf,&quot;Time:%2d-%2d-%2d &quot;,time.Hours,time.Minutes,time.Seconds);LCD_DisplayStringLine(Line2,(uint8_t*)buf); &#125; /* USER CODE END 3 */"},{"title":"LCD","path":"/wiki/lanqiao/LCD.html","content":"嵌入式LCD根据原理图在cubemx配置引脚，初始化lcd。 1234LCD_Init();LCD_Clear(Black);//黑色清屏，不然LCD原本颜色还会残存LCD_SetBackColor(Black);//设置背景色为黑色LCD_SetTextColor(White);//设置前景色为白色 记住要在 MX_GPIO_Init() 之后，否则可能初始化失败。 在lcd屏上显示字符，可以使用 void LCD_DisplayStringLine(u8 Line, u8 *ptr) 例如，显示”Hello World“ 1LCD_DisplayStringLine(Line4, (unsigned char *)&quot; Hello,world. &quot;); 或者，可以使用sprintf()函数，前提使用stdio的头文件 12345#include &quot;stdio.h&quot;sprintf(text,&quot; count: %d &quot;,count);LCD_DisplayStringLine(Line4, (uint8_t *)text); 考点1：实现界面切换。以下是一个按键界面切换的基本思路，通过按键来增加界面计数。注意不要将view和count定义成函数的局部变量，否则在每次加载这个函数的时候界面都是第一个界面，无法进行切换。 123456789101112131415161718192021222324252627282930313233343536373839// 全局变量uint8_t view = 0;uint8_t count = 0;void lcd_process(void)&#123; char text[30]; for(uint8_t i = 0;i &lt; 4; i++) &#123; if(key[0].key_isPressed == 1) &#123; view++; key[i].key_isPressed = 0; if(view ==3) &#123; view = 0; &#125; &#125; if(key[1].key_isPressed == 1) &#123; count++; key[1].key_isPressed = 0; &#125; &#125; if(view==0) &#123; LCD_DisplayStringLine(Line4, (unsigned char *)&quot; Hello,world. &quot;); &#125; if(view==1) &#123; sprintf(text,&quot; count: %d &quot;,count); LCD_DisplayStringLine(Line4, (uint8_t *)text); &#125; if(view == 2) &#123; LCD_DisplayStringLine(Line4,(unsigned char*)&quot; END &quot;); &#125;&#125; 考点2：文本高亮没啥技术含量，更改对应行的背景颜色和设置行切换标志。使用按键控制行标志位增减。与屏幕界面切换的思路一样。 12345678910111213141516171819202122232425262728293031323334353637383940414243if(view == 1) &#123; char text2[30]; if(line_flag == 0) &#123; LCD_SetBackColor(Green); sprintf(text2,&quot; count1:%d &quot;,count1); LCD_DisplayStringLine(Line4,(uint8_t *)text2); &#125; else &#123; LCD_SetBackColor(Black); sprintf(text2,&quot; count1:%d &quot;,count1); LCD_DisplayStringLine(Line4,(uint8_t *)text2); &#125; if(line_flag == 1) &#123; LCD_SetBackColor(Green); sprintf(text2,&quot; count2:%d &quot;,count2); LCD_DisplayStringLine(Line5,(uint8_t *)text2); &#125; else &#123; LCD_SetBackColor(Black); sprintf(text2,&quot; count2:%d &quot;,count2); LCD_DisplayStringLine(Line5,(uint8_t *)text2); &#125; if(line_flag == 2) &#123; LCD_SetBackColor(Green); sprintf(text2,&quot; count3:%d &quot;,count3); LCD_DisplayStringLine(Line6,(uint8_t *)text2); &#125; else &#123; LCD_SetBackColor(Black); sprintf(text2,&quot; count3:%d &quot;,count3); LCD_DisplayStringLine(Line6,(uint8_t *)text2); &#125; &#125; 注意，当两个界面所需要的行数不同时，比如，界面1只有一行字符串，界面2有三行字符串，需要给界面1增加三行空字符串，即 123456789if(view == 0) &#123; char text1[30]; sprintf(text1,&quot; Hello,world. &quot;); LCD_SetBackColor(Black); LCD_DisplayStringLine(Line4, (uint8_t *)text1); LCD_DisplayStringLine(Line5, (unsigned char *)&quot; &quot;); LCD_DisplayStringLine(Line6, (unsigned char *)&quot; &quot;); &#125; 否则会出现界面之间的字符串串在界面中。"},{"title":"TIM","path":"/wiki/lanqiao/TIM.html","content":"嵌入式TIM考点1：计算输出频率，占空比 关键概念： ARR：自动重装载值（AutoReloader Register） CCRx：捕获寄存器值 CNT：计数器值 PSC：预分频值（Prescaler） 当CNT小于CCRx时，计时器通道TIMx_CHx输出高电平，反之输出低电平 记住！！！ 频率 $=\\frac{\\text{CLK}}{(\\text{PSC+1})(\\text{ARR+1})}$ 占空比 $= \\frac{\\text{CRRx}}{\\text{ARR+1}}$ 公式中，CLK已经在创建工程时设置成了80MHz，而ARR和PSC可以在cubemx中设置，CCRx在程序中设置。 省赛题： 在cubemx中配置PA6和PA7引脚分别为TIMx_CHx通道。 按照下面的步骤修改寄存器的值： 12TIM3-&gt;ARR= //修改定时器3的ARR值，用于修改频率TIM3-&gt;CCRx= //修改定时器3通道x的CCR值，用于修改占空比 对于这题，在keil5中， 先初始化通道： 123456789//初始化HAL_TIM_PWM_Start(&amp;htim3,TIM_CHANNEL_1); //PA6HAL_TIM_PWM_Start(&amp;htim17,TIM_CHANNEL_1); //PA//根据寄存器中ARR的值配置频率PA6_frq=10000/(TIM3-&gt;ARR+1);PA7_frq=20000/(TIM17-&gt;ARR+1);//配置占空比，在cubemx ARR+1为100，CRR1的值正好就是对应的百分数TIM3-&gt;CCR1=PA6_duty; //PA6TIM17-&gt;CCR1=PA7_duty; //PA7 配置按键操作： 1234567891011121314if(key[1].key_isPressed == 1 &amp;&amp; view == 0) &#123; PA6_duty+=10; if(PA6_duty==100) PA6_duty=10; TIM3-&gt;CCR1=PA6_duty; key[1].key_isPressed =0; &#125;if(key[2].key_isPressed == 1 &amp;&amp; view == 0) &#123; PA7_duty+=10; if(PA7_duty==100) PA7_duty=10; TIM17-&gt;CCR1=PA7_duty; key[2].key_isPressed = 0; &#125; 配置LCD的显示： 123456789101112if(view == 0) &#123; char buf[20]; sprintf(buf,&quot;PA6_frq:%dHz&quot;,PA6_frq); LCD_DisplayStringLine(Line4,(uint8_t*)buf); sprintf(buf,&quot;PA7_frq:%dHz&quot;,PA7_frq); LCD_DisplayStringLine(Line5,(uint8_t*)buf); sprintf(buf,&quot;PA6_duty:%d%%&quot;,PA6_duty); LCD_DisplayStringLine(Line7,(uint8_t*)buf); sprintf(buf,&quot;PA7_duty:%d%%&quot;,PA7_duty); LCD_DisplayStringLine(Line8,(uint8_t*)buf); &#125; 考点2：输入捕获频率原理是调整信号发生器的频率，对应的分别是PA15和PB4，需要在cubemx中配置定时器输入捕获模式。 以TIM2_CH1为例，需要在cubemx中分别配置两个通道为direct 和 indirect。 记得打开NVIC中断使能 首先需要启动定时器： 1234HAL_TIM_IC_Start_IT(&amp;htim2, TIM_CHANNEL_1);HAL_TIM_IC_Start_IT(&amp;htim2, TIM_CHANNEL_2);HAL_TIM_IC_Start_IT(&amp;htim3, TIM_CHANNEL_1);HAL_TIM_IC_Start_IT(&amp;htim3, TIM_CHANNEL_2); 接着，配置输入捕捉回调函数： 123456789101112131415161718192021void HAL_TIM_IC_CaptureCallback(TIM_HandleTypeDef *htim)&#123; if(htim-&gt;Instance == TIM2) &#123; if(htim-&gt;Channel == HAL_TIM_ACTIVE_CHANNEL_1) &#123; tim2_val1 = HAL_TIM_ReadCapturedValue(htim, TIM_CHANNEL_1); /* 读取通道一，上升沿的值 一个完整的周期 */ tim2_val2 = HAL_TIM_ReadCapturedValue(htim, TIM_CHANNEL_2); /* 读取通道二，下降沿的值 一个周期中的高电平 */ __HAL_TIM_SetCounter(htim, 0);/* 清零定时器中的值，继续读取下一周期的脉冲 */ /* 捕获到的频率 = 时钟频率 / 预分频值 / 捕获的值（从0开始直到上升沿产生读的数值） */ tim2_freq = (80000000 / 80) / tim2_val1; /* 捕获的占空比 = 高电平的时间 / 低电平的时间 * 100 */ tim2_duty = ((float)tim2_val2 / tim2_val1) * 100; HAL_TIM_IC_Start(htim, TIM_CHANNEL_1); //重开通道1 HAL_TIM_IC_Start(htim, TIM_CHANNEL_2); //重开通道2 &#125; &#125; &#125; 这里写了TIM2的频率捕获部分，对于TIM3，是一样的。 接下来只需要在LCD中输入显示即可。"},{"title":"USART","path":"/wiki/lanqiao/USART.html","content":"嵌入式USART先在cubemx配置USART中断，调试时配合串口调试助手。 注意字符串操作要使用string库 考点1：串口发送例如，向上位机发送Hello World! 1234567891011121314151617char tx_buf[20]; //字符缓存区uint8_t rx_data; sprintf(tx_buf,&quot;Hello World!\\r &quot;);HAL_UART_Transmit(&amp;huart1,(uint8_t*)tx_buf,strlen(tx_buf),50);HAL_StatusTypeDef HAL_UART_Transmit(UART_HandleTypeDef *huart, const uint8_t *pData, uint16_t Size, uint32_t Timeout)/* * @param huart UART handle. * @param pData Pointer to data buffer (u8 or u16 data elements). * @param Size Amount of data elements (u8 or u16) to be sent. * @param Timeout Timeout duration. * @retval HAL status*/ 考点2：串口接收串口接收函数在HAL库中的定义 1234567891011/** * @brief Recive an amount of data in interrupt mode. * @note When UART parity is not enabled (PCE = 0), and Word Length is configured to 9 bits (M1-M0 = 01), * the received data is handled as a set of u16. In this case, Size must indicate the number * of u16 available through pData. * @param huart UART handle. * @param pData Pointer to data buffer (u8 or u16 data elements). * @param Size Amount of data elements (u8 or u16) to be received. * @retval HAL status */HAL_StatusTypeDef HAL_UART_Receive_IT(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size) 进行串口接收时，我们要编写串口中断函数，函数名和形参不能改，函数本身是空内容，和TIM中断函数一致 1void HAL_UART_RxCpltCallback(UART_HandleTypedef *huart) 串口接收又分为几种，首先是单字符接收，例如，接收不同的单字符来对LED1进行控制： 12345678910111213141516171819202122void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart)&#123; if(rx_data==&#x27;O&#x27;) &#123; ucled=0x01; sprintf(tx_buf,&quot;LED1 Open!\\r &quot;); HAL_UART_Transmit(&amp;huart1,(uint8_t*)tx_buf,strlen(tx_buf),50); &#125; else if(rx_data==&#x27;C&#x27;) &#123; ucled=0x00; sprintf(tx_buf,&quot;LED1 Close!\\r &quot;); HAL_UART_Transmit(&amp;huart1,(uint8_t*)tx_buf,strlen(tx_buf),50); &#125; else &#123; sprintf(tx_buf,&quot;Error!\\r &quot;); HAL_UART_Transmit(&amp;huart1,(uint8_t*)tx_buf,strlen(tx_buf),50); &#125; HAL_UART_Receive_IT(&amp;huart1,&amp;rx_data,1); Led_Disp(ucled);&#125; 要提前打开接收中断 123/* USER CODE BEGIN 2 */HAL_UART_Receive_IT(&amp;huart1,&amp;rx_data,1); //打开接收中断/* USER CODE END 2 */ 只要接收中断就会进入串口中断函数 再例如，接收多字符进行LED控制： 12345678910111213141516171819202122232425262728void Usart_Proc(void)&#123; if(rx_count==4) &#123; if(strcmp(rx_buf,&quot;LEDO&quot;)==0) &#123; ucled=0x01; Led_Disp(ucled); sprintf(tx_buf,&quot;LED Open!\\r &quot;); HAL_UART_Transmit(&amp;huart1,(uint8_t*)tx_buf,strlen(tx_buf),50); &#125; if(strcmp(rx_buf,&quot;LEDC&quot;)==0) &#123; ucled=0x00; Led_Disp(ucled); sprintf(tx_buf,&quot;LED Close!\\r &quot;); HAL_UART_Transmit(&amp;huart1,(uint8_t*)tx_buf,strlen(tx_buf),50); &#125; rx_count=0; memset(rx_buf,0,20); //将缓存清空 &#125; &#125;void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart)&#123; rx_buf[rx_count++]=rx_data; HAL_UART_Receive_IT(&amp;huart1,&amp;rx_data,1);&#125; 在主函数主循环中使用Usart_Proc()函数，同样的，在接收上位机发送的信息后会进入串口中断函数，同样的，要提前打开接收中断。 考点3：sscanf()函数解析字符串12345678int sscanf(const char* str, const char* format, ...);/*参数：str：要解析的输入字符串。format：格式字符串，指定要匹配的格式规则。...：可变参数列表，用于接收解析后的数据。*/ 例如，省赛中解析车牌字符串： 123456789101112131415void Usart_Proc(void)&#123; if(rx_count==22) &#123; sscanf(rx_buf,&quot;%4s:%4s:%12s&quot;,car_type,car_num,car_time); sprintf(tx_buf,&quot;car_type:%4s\\r &quot;,car_type); HAL_UART_Transmit(&amp;huart1,(uint8_t*)tx_buf,strlen(tx_buf),50); sprintf(tx_buf,&quot;car_num:%4s\\r &quot;,car_num); HAL_UART_Transmit(&amp;huart1,(uint8_t*)tx_buf,strlen(tx_buf),50); sprintf(tx_buf,&quot;car_time:%4s\\r &quot;,car_time); HAL_UART_Transmit(&amp;huart1,(uint8_t*)tx_buf,strlen(tx_buf),50); rx_count=0; memset(rx_buf,0,20); &#125;&#125;"}]